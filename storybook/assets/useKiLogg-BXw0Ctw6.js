import{r as u,i as O,gH as U,ae as D,d as W,p as E,W as K,o as P,I as e,a as v,J as b}from"./iframe-DUxtTNxK.js";import{w as _,u as C,a as x,s as N,m as M,g as L,U as k,b as F,I as V}from"./index-BB9gl3jm.js";const I=V?t=>{t()}:O.startTransition,z=t=>{const[,r]=u.useState({}),n=u.useRef(!1),a=u.useRef(t),o=u.useRef({data:!1,error:!1,isValidating:!1}),s=u.useCallback(c=>{let g=!1;const m=a.current;for(const f in c)if(Object.prototype.hasOwnProperty.call(c,f)){const i=f;m[i]!==c[i]&&(m[i]=c[i],o.current[i]&&(g=!0))}g&&!n.current&&r({})},[]);return F(()=>(n.current=!1,()=>{n.current=!0})),[a,o.current,s]},B=()=>(t,r,n={})=>{const{mutate:a}=x(),o=u.useRef(t),s=u.useRef(r),c=u.useRef(n),g=u.useRef(0),[m,f,i]=z({data:k,error:k,isMutating:!1}),d=m.current,S=u.useCallback(async(h,j)=>{const[w,T]=N(o.current);if(!s.current)throw new Error("Can’t trigger the mutation: missing fetcher.");if(!w)throw new Error("Can’t trigger the mutation: missing key.");const l=M(M({populateCache:!1,throwOnError:!0},c.current),j),y=L();g.current=y,i({isMutating:!0});try{const p=await a(w,s.current(T,{arg:h}),M(l,{throwOnError:!0}));return g.current<=y&&(I(()=>i({data:p,isMutating:!1,error:void 0})),l.onSuccess==null||l.onSuccess.call(l,p,w,l)),p}catch(p){if(g.current<=y&&(I(()=>i({error:p,isMutating:!1})),l.onError==null||l.onError.call(l,p,w,l),l.throwOnError))throw p}},[]),$=u.useCallback(()=>{g.current=L(),i({data:k,error:k,isMutating:!1})},[]);return F(()=>{o.current=t,s.current=r,c.current=n}),{trigger:S,reset:$,get data(){return f.data=!0,d.data},get error(){return f.error=!0,d.error},get isMutating(){return f.isMutating=!0,d.isMutating}}},A=_(C,B),H=(t=":rekrutteringstreffId")=>`${U.internUrl}/${t}/ki`,R=(t=":rekrutteringstreffId")=>`${H(t)}/logg`,q=P({id:e(),opprettetTidspunkt:e(),treffId:e(),tittel:e().nullable(),feltType:e(),spørringFraFrontend:e(),spørringFiltrert:e(),systemprompt:e().nullable(),bryterRetningslinjer:b(),begrunnelse:e().nullable(),kiNavn:e(),kiVersjon:e(),svartidMs:v(),lagret:b(),manuellKontrollBryterRetningslinjer:b().nullable(),manuellKontrollUtfortAv:e().nullable(),manuellKontrollTidspunkt:e().nullable(),promptVersjonsnummer:v().nullable(),promptEndretTidspunkt:e().nullable(),promptHash:e().nullable()}),G=W(q),J=async t=>{try{const r=await D(t);return G.parse(r)}catch(r){throw E.logger.error(r,`Feil ved henting av KI-logg fra ${t}`),r}},Y=t=>async(r,{arg:n})=>{const{id:a,bryterRetningslinjer:o}=n;try{await K(`${R(t)}/${a}/manuell`,{bryterRetningslinjer:o})}catch(s){throw E.logger.error(s,`Feil ved oppdatering av manuell vurdering for KI-logg ${a}`),s}},Q=t=>async(r,{arg:n})=>{const{id:a,lagret:o}=n;try{await K(`${R(t)}/${a}/lagret`,{lagret:o})}catch(s){throw E.logger.error(s,`Feil ved oppdatering av lagret-status for KI-logg ${a}`),s}},tt=(t,r)=>{const n=new URLSearchParams;r&&n.set("feltType",r);const a=t?`${R(t)}${n.toString()?`?${n.toString()}`:""}`:null,o=C(a,J,{revalidateOnFocus:!1}),{trigger:s,isMutating:c,error:g}=A(`${R(t??":rekrutteringstreffId")}/manuell`,Y(t??":rekrutteringstreffId")),{trigger:m,isMutating:f,error:i}=A(`${R(t??":rekrutteringstreffId")}/lagret`,Q(t??":rekrutteringstreffId")),d=async()=>await o.mutate();return{...o,setManuell:async h=>{await s(h),await d()},settingManuell:c,manuellError:g,setLagret:async h=>{await m(h),await d()},settingLagret:f,lagretError:i,refresh:d}};export{tt as a,A as u};
