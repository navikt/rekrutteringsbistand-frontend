import{t as v,a as C}from"./utils-B2n0uPAd.js";import{o as F,av as P,h5 as T,hC as S,ak as L,T as p,h2 as b,hD as y,h4 as A,r as h,hA as O,w as R,hE as N,hi as I}from"./iframe-B32qNefX.js";import{o as M}from"./mutations-B4ipInuM.js";const D=F({tittel:p().min(1,"Tittel kan ikke være tom"),htmlContent:p().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:p().nullable().optional(),opprettetAvPersonBeskrivelse:p().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:p().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),E=S,$=t=>`${T.internUrl}/${t}/innlegg`,x=(t,n)=>`${T.internUrl}/${t}/innlegg/${n}`,B=async(t,n)=>{D.parse(n);const s=await L($(t),n);return E.parse(s)},H=async(t,n,s)=>{D.parse(s);const e=await P(x(t,n),s);return E.parse(e)},J=()=>{try{return!1}catch{return!1}},U=t=>{const n=N(t?.hendelser);return n===I.INVITERE||n===I.FULLFØRE},w=(t,n)=>n?!1:U(t)&&J();function q(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=b(),{data:e,mutate:c}=y(t),{getValues:g,trigger:o,formState:i}=A(),f=h.useCallback(()=>{const r=g(),l=v(r.fraDato??null,r.fraTid)??e?.fraTid??null,k=v(r.tilDato??r.fraDato??null,r.tilTid)??e?.tilTid??null,u=v(r.svarfristDato??null,r.svarfristTid)??e?.svarfrist??null,a=typeof r.tittel=="string"?r.tittel.trim():"";return{...!!!i?.errors?.tittel&&(a.length>0||e?.tittel&&e.tittel.trim().length>0)&&{tittel:a.length>0?a:e?.tittel},beskrivelse:r.beskrivelse??e?.beskrivelse??null,fraTid:l,tilTid:k,svarfrist:u,gateadresse:r.gateadresse??e?.gateadresse??null,postnummer:r.postnummer??e?.postnummer??null,poststed:r.poststed??e?.poststed??null}},[g,e,i]);return{save:h.useCallback(async(r,l)=>{if(!t||w(e,l))return;const k=!r||r.length===0;if(!await o(k?void 0:r,{shouldFocus:!1})||i?.errors?.root?.type==="manualPeriod")return;const a=f();try{n("rekrutteringstreff"),await M(t,a),c()}finally{s("rekrutteringstreff")}},[f,t,o,e,c,i?.errors,n,s])}}function z(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=b(),{data:e}=y(t),{data:c,mutate:g}=O(t),o=c?.[0],{getValues:i,trigger:f,setValue:d}=A();return{save:h.useCallback(async(l,k)=>{if(!t||w(e,k)||l&&l.length&&!await f(l,{shouldFocus:!1}))return;const u=(i("htmlContent")??"").toString();if(u.trim())try{const a=o?.opprettetAvPersonNavn||o?.opprettetAvPersonNavident||"Markedskontakt",m={htmlContent:u,tittel:"Om treffet",opprettetAvPersonNavn:a,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:C(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};n("innlegg"),o?.id?await H(t,o.id,m):await B(t,m),g(),d("htmlContent",u,{shouldDirty:!1})}catch(a){new R({message:"Lagring av innlegg feilet.",error:a})}finally{s("innlegg")}},[i,o,g,t,n,s,d,e,f])}}export{J as a,q as b,U as e,z as u};
