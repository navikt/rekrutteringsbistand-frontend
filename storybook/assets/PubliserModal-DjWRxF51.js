import{c4 as C,f as y,dz as w,Y as Z,u as ee,r as i,b4 as se,P as te,bm as ie,au as re,j as e,d as v,H as P,L as le,cO as ne,D as oe}from"./iframe-BaixhwPd.js";import{D as L}from"./DatoVelger-D8ORY4eQ.js";import{U as ae}from"./umamiEvents-4lZbqD_K.js";import{v as de}from"./validerEpost-bkYxvk6k.js";import{M as x}from"./Modal-CYd9NYLN.js";import{B as pe}from"./Box-BgJKnzPJ.js";import{a as ue}from"./Checkbox-BtexqRL5.js";import{T as j}from"./ToggleGroup-CoW3W5Mz.js";import{T as O}from"./TextField-C7E2sMTH.js";const ce=s=>s.replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})(?!:)/,"$1:00").replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\.(\d{3})\d+(.*)$/,"$1.$2$3"),T=s=>{if(!s)return null;if(/^\d{2}\.\d{2}\.\d{4}$/.test(s)){const o=C(s,"dd.MM.yyyy",new Date);return w(o)?y(o,"yyyy-MM-dd'T'00:00:00"):null}const l=Z(ce(s));return w(l)?y(l,"yyyy-MM-dd'T'HH:mm:ss"):null},ge=s=>{const l=T(s.stilling?.published),o=T(s.stilling?.expires);return{...s,stilling:{...s.stilling,properties:{...s.stilling.properties,tags:typeof s.stilling?.properties?.tags=="string"?s.stilling?.properties?.tags:JSON.stringify(s.stilling?.properties?.tags??[]),workday:typeof s.stilling?.properties?.workday=="string"?s.stilling?.properties?.workday:JSON.stringify(s.stilling?.properties?.workday??[]),workhours:typeof s.stilling?.properties?.workhours=="string"?s.stilling?.properties?.workhours:JSON.stringify(s.stilling?.properties?.workhours??[])},published:l,expires:o}}};function me({disabled:s}){const{brukerData:l,valgtNavKontor:o}=ee(),p=i.useRef(null),{watch:a,setValue:n,getValues:h}=se(),{track:H}=te(),A=ie(),V=a("stilling.privacy"),_=a("stilling.published"),$=a("stilling.expires"),z=a("stilling.properties.applicationemail"),S=a("stilling.properties.applicationurl"),[B,N]=i.useState(!1),F=re(h().stilling.uuid),D=t=>{if(t)try{return y(new Date(t),"dd.MM.yyyy")}catch{return}},[u,R]=i.useState(D(_)),[c,U]=i.useState(D($)),[g,J]=i.useState(V==="SHOW_ALL"),K=S?"url":"email",[d,W]=i.useState(K),[b,G]=i.useState(z??""),[q,E]=i.useState(""),[k,Y]=i.useState(S??""),[Q,M]=i.useState(""),I=t=>{if(!t)return null;const r=C(t,"dd.MM.yyyy",new Date);return y(r,"yyyy-MM-dd'T'HH:mm:ss")},f=()=>{E(""),M("")},X=async()=>{N(!0);try{if(n("stilling.published",I(u),{shouldDirty:!0}),n("stilling.expires",I(c),{shouldDirty:!0}),n("stilling.privacy",g?"SHOW_ALL":"INTERNAL_NOT_SHOWN",{shouldDirty:!0}),g)if(d==="email"){const m=de(b);if(m.erGodkjent)n("stilling.properties.applicationemail",b,{shouldDirty:!0}),n("stilling.properties.applicationurl",null,{shouldDirty:!0});else{E(m.feilmelding);return}}else if(k.trim()!=="")n("stilling.properties.applicationurl",k,{shouldDirty:!0}),n("stilling.properties.applicationemail",null,{shouldDirty:!0});else{M("Lenke til søknadsskjema kan ikke være tom");return}const t=ge(h()),r={...t,stillingsinfo:{...t.stillingsinfo},stilling:{...t.stilling,status:"ACTIVE",administration:{...t.stilling.administration,status:"DONE"},firstPublished:!0}};H(ae.Stilling.ny_stilling_info,{yrkestittel:r.stilling.categoryList?.[0]?.name,sektor:r.stilling.properties?.sector,ansettelsesform:r.stilling.properties?.engagementtype,arbeidstidsordning:r.stilling?.properties?.jobarrangement,omfangIProsent:r.stilling.properties?.jobpercentage,arbeidssted:r.stilling.locationList});try{await ne(r,{eierNavident:l.ident,eierNavn:l.navn,eierNavKontorEnhetId:o?.navKontor})}catch(m){alert("Feil ved opprettelse av stilling"),new oe({message:"Feil ved opprettelse av stilling",error:m})}p.current?.close(),F.mutate(),A.push(`/stilling/${h().stilling.uuid}`)}catch{alert("Uventet feil ved publisering")}finally{N(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"small",disabled:s,onClick:()=>{f(),p.current?.showModal()},children:"Publiser"}),e.jsxs(x,{ref:p,header:{heading:"Publiser stillingsoppdraget"},children:[e.jsxs(x.Body,{children:[e.jsxs(pe.New,{background:"neutral-soft",padding:"6",className:"mb-8",children:[e.jsx(P,{size:"small",className:"mb-2",children:"Dette skjer når du publiserer oppdraget"}),e.jsxs("ul",{className:"mb-4 list-disc pl-5 text-sm",children:[e.jsx("li",{children:"Stillingsoppdraget blir synlig for Nav-ansatte i rekrutteringsbistand."}),e.jsx("li",{children:"Ansatte hos arbeidsgiveren på Min Side Arbeidsgiver på nav.no (med Altinn-tilgang)."}),e.jsx("li",{children:"Jobbsøkere som får stillingen delt i aktivitetsplanen."})]}),e.jsx(le,{size:"small",children:"Ikke alt må være helt perfekt! Du kan når som helst endre eller avpublisere oppdraget."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(L,{disablePastDates:!0,label:"Publiseringsdato",valgtDato:u,tilDato:c,setDato:t=>R(t)}),e.jsx(L,{disablePastDates:!0,label:"Siste visningsdato",valgtDato:c,fraDato:u,setDato:t=>U(t)})]}),e.jsx(ue,{checked:g,onChange:t=>J(t.target.checked),children:"Publiser stillingsoppdraget offentlig på arbeidsplassen.no også"}),g&&e.jsxs("div",{children:[e.jsx(P,{size:"small",className:"mb-4",children:"Hvordan skal jobbsøker søke?"}),e.jsxs(j,{fill:!0,defaultValue:d,onChange:t=>W(t),children:[e.jsx(j.Item,{value:"email",label:"E-post"}),e.jsx(j.Item,{value:"url",label:"Søknadsskjema"})]}),d==="email"&&e.jsx("div",{className:"mt-4",children:e.jsx(O,{label:"E-post",value:b,error:q,onInput:()=>f(),onChange:t=>G(t.target.value)})}),d==="url"&&e.jsx("div",{className:"mt-4",children:e.jsx(O,{label:"Lenke til søknadsskjema",value:k,error:Q,onInput:()=>f(),onChange:t=>Y(t.target.value)})})]})]})]}),e.jsxs(x.Footer,{children:[e.jsx(v,{loading:B,type:"button",onClick:X,children:"Publiser oppdraget"}),e.jsx(v,{type:"button",variant:"secondary",onClick:()=>p.current?.close(),children:"Avbryt"})]})]})]})}me.__docgenInfo={description:"",methods:[],displayName:"PubliserModal",props:{disabled:{required:!0,tsType:{name:"boolean"},description:""}}};export{me as P,ge as m};
