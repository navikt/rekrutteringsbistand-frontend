import{t as A,a as N}from"./utils-DBcRg3ga.js";import{o as x,av as M,h5 as P,hB as $,ak as H,T as I,h2 as w,hC as L,h4 as O,r as y,hA as K,w as J,hD as U,hi as D}from"./iframe-CgpsV_Wu.js";import{o as V}from"./mutations-B4j5MeqE.js";const E=x({tittel:I().min(1,"Tittel kan ikke være tom"),htmlContent:I().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:I().nullable().optional(),opprettetAvPersonBeskrivelse:I().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:I().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),F=$,X=t=>`${P.internUrl}/${t}/innlegg`,Z=(t,r)=>`${P.internUrl}/${t}/innlegg/${r}`,q=async(t,r)=>{E.parse(r);const s=await H(X(t),r);return F.parse(s)},z=async(t,r,s)=>{E.parse(s);const e=await M(Z(t,r),s);return F.parse(e)},G=()=>{try{return!1}catch{return!1}},C=t=>{const r=U(t?.hendelser);return r===D.INVITERE||r===D.FULLFØRE},R=(t,r)=>r?!1:C(t)&&G(),j=(t,r,s,e)=>t||r&&!e?!1:s;function _(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e,mutate:T}=L(t),{getValues:v,trigger:f,formState:c}=O(),d=y.useCallback(g=>{const n=v(),a=A(n.fraDato??null,n.fraTid)??e?.fraTid??null,o=A(n.tilDato??n.fraDato??null,n.tilTid)??e?.tilTid??null,i=A(n.svarfristDato??null,n.svarfristTid)??e?.svarfrist??null,k=typeof n.tittel=="string"?n.tittel.trim():"",u=!!c?.errors?.tittel,m=!!n.tittelKiFeil,h=!!n?.tittelKiSjekket,p=!!(k.length>0||e?.tittel&&e.tittel.trim().length>0);let l=j(u,m,p,g);return!C(e)&&!g&&(l=l&&h&&!m),{...l&&{tittel:k.length>0?k:e?.tittel},beskrivelse:n.beskrivelse??e?.beskrivelse??null,fraTid:a,tilTid:o,svarfrist:i,gateadresse:n.gateadresse??e?.gateadresse??null,postnummer:n.postnummer??e?.postnummer??null,poststed:n.poststed??e?.poststed??null}},[v,e,c]);return{save:y.useCallback(async(g,n)=>{if(!t||R(e,n))return;const a=d(n),o=new Set(Object.keys(a??{})),i=g&&g.length>0?g:Array.from(o);if(!o.has("tittel")){const u=i?.indexOf("tittel")??-1;u>=0&&i.splice(u,1)}if(!n&&!await f(i?.length?i:void 0,{shouldFocus:!1})){const m=c?.errors||{},p=Object.keys(m).filter(l=>l!=="root").filter(l=>o.has(l));if(!(p.length===0||p.length===1&&p[0]==="tittel"&&!o.has("tittel")))return}if(c?.errors?.root?.type==="manualPeriod"&&((a?.fraTid??null)!==(e?.fraTid??null)||(a?.tilTid??null)!==(e?.tilTid??null)))return;const k=a??d(n);try{r("rekrutteringstreff"),await V(t,k),T()}finally{s("rekrutteringstreff")}},[d,t,f,e,T,c?.errors,r,s])}}function tt(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e}=L(t),{data:T,mutate:v}=K(t),f=T?.[0],{getValues:c,trigger:d,setValue:S,formState:g}=O();return{save:y.useCallback(async(a,o)=>{if(!t||R(e,o)||a&&a.length&&!o&&!await d(a,{shouldFocus:!1}))return;const i=c(),k=!!g?.errors?.htmlContent,u=!!i?.htmlContentKiFeil,m=!!i?.htmlContentKiSjekket,h=(i.htmlContent??"").toString(),p=h.trim().length>0;let l=j(k,u,p,o);if(!C(e)&&!o&&(l=l&&m&&!u),!!l)try{const b=f?.opprettetAvPersonNavn||f?.opprettetAvPersonNavident||"Markedskontakt",B={htmlContent:h,tittel:"Om treffet",opprettetAvPersonNavn:b,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:N(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),f?.id?await z(t,f.id,B):await q(t,B),v(),S("htmlContent",h,{shouldDirty:!1})}catch(b){new J({message:"Lagring av innlegg feilet.",error:b})}finally{s("innlegg")}},[c,f,v,t,r,s,S,e,d,g?.errors])}}export{G as a,_ as b,C as e,tt as u};
