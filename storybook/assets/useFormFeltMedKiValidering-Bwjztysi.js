import{b8 as O,r as s,b3 as Q,b7 as U,b5 as X,bL as Y,bM as Z,bN as N,i as E}from"./iframe-BYISswbs.js";import"./AutoLagre-BuBtsJ-8.js";const tt=()=>{try{return!1}catch{return!1}},et=r=>r===O.PUBLISERT||r===O.FULLFØRT,rt=s.createContext(null),st={lagreNaa:async()=>{},lagrer:!1,venterPåLagring:!1,feil:null,sisteLagret:null,harUlagredeEndringer:!1,statusTekst:"Autolagring utilgjengelig",skjemaVerdier:()=>({}),kiSjekket:!0,autoLagringAktiv:!1,harKiFeil:!1},nt=()=>s.useContext(rt)??st,b=r=>r==null?"":String(r).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),a={shouldDirty:!1,shouldValidate:!1,shouldTouch:!1};function ot({feltType:r,fieldName:t,savedValue:u,onUpdated:l}){const{rekrutteringstreffId:F}=Q(),{treff:m}=U(),{lagreNaa:w,autoLagringAktiv:i}=nt(),{control:C,setValue:e,getValues:h,trigger:A}=X(),{setLagret:y}=Y(F),{trigger:$,data:R,reset:v,error:x,isMutating:D}=Z(F),[c,V]=s.useState(null),[g,S]=s.useState(!1),[p,f]=s.useState(!1),I=N({control:C,name:t}),H=b(I),B=b(u),G=H!==B,z=et(m)&&tt(),k=!!R&&!x&&!!R?.bryterRetningslinjer,W=k&&!g,_=p&&k&&!g;s.useEffect(()=>{G&&(f(!1),S(!1),V(null),v(),e(`${t}KiSjekket`,!1,a))},[G,v,t,e]),s.useEffect(()=>{const n=k&&!g;e(`${t}KiFeil`,n,a)},[k,g,e,t]);const d=s.useCallback(async()=>{if(!i){l?.();return}try{await w()}catch(n){new E({message:`Lagring av ${r} feilet.`,error:n})}finally{l?.()}},[i,w,r,l]),L=s.useCallback(async n=>{if(y)try{await y({id:n,lagret:!0})}catch(o){new E({message:`Feil ved oppdatering av /lagret for logg ${n}.`,error:o})}},[y]),M=s.useCallback((n,o)=>{V(n),f(!0),n&&e(`${t}KiLoggId`,n,a),e(`${t}KiSjekket`,!0,a),e(`${t}KiFeil`,o,a)},[e,t]),q=s.useCallback(async()=>{if(!await A(t))return;const o=String(h(t)??"").trim(),P=b(o);if(P&&!(u!==void 0&&P===b(u)))try{const K=await $({feltType:r,tekst:o}),j=K?.loggId??null,T=!!K?.bryterRetningslinjer;M(j,T),!T&&i&&(await d(),j&&await L(j))}catch(K){new E({message:"KI-validering feilet",error:K}),f(!0),e(`${t}KiSjekket`,!0,a)}},[A,t,h,$,r,M,d,L,e,u,i]),J=s.useCallback(async()=>{if(S(!0),f(!0),e(`${t}KiSjekket`,!0,a),e(`${t}KiFeil`,!1,a),!i){l?.();return}await d(),c&&await L(c)},[i,d,c,L,t,e,l]);return{analyse:R,analyseError:x,validating:D,kiErrorBorder:W,harGodkjentKiFeil:g,setHarGodkjentKiFeil:S,loggId:c,hasChecked:p,showAnalysis:_,erRedigeringAvPublisertTreff:z,validerMedKiOgLagreVedGodkjenning:q,onGodkjennKiFeil:J,watchedValue:I,control:C,setValue:e,getValues:h}}export{ot as u};
