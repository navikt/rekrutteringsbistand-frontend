import{e as B,a as O}from"./useAutosave-JnKwMHHX.js";import{h5 as J,o as G,ak as Q,T as w,U as X,h2 as Y,hC as Z,h4 as _,hE as U,r as a,w as p}from"./iframe-BAewwkeG.js";import{a as N,u as ee}from"./useKiLogg-BNivomcm.js";const te=(t=":id")=>`${J.internUrl}/${t}/ki/valider`,re=G({feltType:w(),tekst:w()}),se=G({loggId:w(),bryterRetningslinjer:X(),begrunnelse:w()}),ae=async(t,{arg:e})=>{const u=e.tekst.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),h={...e,tekst:u};re.parse(e);const n=await Q(t,h);return se.parse(n)},ne=t=>N(te(t??":id"),ae),D=t=>t==null?"":String(t).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function ce({feltType:t,fieldName:e,savedValue:u,saveCallback:h,onUpdated:n,requireHasCheckedToShow:T=!1}){const{rekrutteringstreffId:K}=Y(),{data:M}=Z(K),{control:F,setValue:r,getValues:V,trigger:S}=_(),{setLagret:i,isLoading:x}=ee(K,t),E=U({control:F,name:e}),g=B(M)&&O(),{trigger:$,data:s,reset:L,error:c,isMutating:H}=ne(K),[d,v]=a.useState(null),[k,y]=a.useState(!1),[C,R]=a.useState(!1);a.useEffect(()=>{R(!1),y(!1),v(null),L(),r(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[E,L,e,r]);const P=!!s&&!c&&s?.bryterRetningslinjer&&!k;a.useEffect(()=>{const o=!!s&&!c&&!!s?.bryterRetningslinjer&&!k;r(`${e}KiFeil`,o,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[s,c,k,e,r]);const b=a.useCallback(async o=>{try{await h([e],o)}catch(f){new p({message:`Lagring av ${t} feilet.`,error:f})}finally{n?.()}},[h,e,t,n]),W=a.useCallback(async()=>{if(!await S(e))return;const f=V(e),m=(typeof f=="string"?f:String(f??"")).trim(),A=D(m);if(A){if(u!==void 0){const l=D(u);if(A===l)return}try{const l=await $({feltType:t,tekst:m});R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const j=l?.loggId??s?.loggId??null;if(v(j),!(l?.bryterRetningslinjer??s?.bryterRetningslinjer)&&!g&&(await b(),j&&i))try{await i({id:j,lagret:!0})}catch(z){new p({message:`Feil ved oppdatering av /lagret for logg ${j}.`,error:z})}}catch(l){new p({message:"Validation failed:",error:l}),R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[S,e,V,$,t,g,b,i,s,r,u]),q=a.useCallback(async()=>{if(g){y(!0),R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),r(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),n?.();return}if(y(!0),await b(!0),d&&i)try{await i({id:d,lagret:!0})}catch(o){new p({message:`Feil ved oppdatering av /lagret for logg ${d}.`,error:o})}},[g,b,d,i,e,r,n]),I=!!s&&!c&&!!s?.bryterRetningslinjer;return{analyse:s,analyseError:c,validating:H,kiErrorBorder:P,harGodkjentKiFeil:k,setHarGodkjentKiFeil:y,loggId:d,hasChecked:C,showAnalysis:T?C&&I:I,erRedigeringAvPublisertTreff:g,validerMedKiOgLagreVedGodkjenning:W,onGodkjennKiFeil:q,watchedValue:E,control:F,setValue:r,getValues:V,kiLoggLoading:x}}export{ce as u};
