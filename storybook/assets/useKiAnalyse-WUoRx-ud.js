import{e as G,a as z}from"./useAutosave-CFxYr6wF.js";import{h5 as B,o as M,ak as W,T as R,U as J,h2 as O,hD as Q,r as a,w as S}from"./iframe-BELOvKNN.js";import{a as X}from"./useKiLogg-CLlBb6P9.js";const Y=(e=":id")=>`${B.internUrl}/${e}/ki/valider`,Z=M({feltType:R(),tekst:R()}),_=M({loggId:R(),bryterRetningslinjer:J(),begrunnelse:R()}),ee=async(e,{arg:n})=>{const c=n.tekst.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),m={...n,tekst:c};Z.parse(n);const h=await W(e,m);return _.parse(h)},te=e=>X(Y(e??":id"),ee),L=e=>e==null?"":String(e).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function oe(e){const{feltType:n,fieldName:c,watchedValue:m,triggerRHF:h,getValues:V,setValue:s,setKiFeilFieldName:E,saveCallback:y,setKiLagret:i,requireHasCheckedToShow:U,setKiSjekketFieldName:r,savedValue:b}=e,{rekrutteringstreffId:j}=O(),{data:$}=Q(j),u=G($)&&z(),{trigger:F,data:t,reset:T,error:d,isMutating:x}=te(j),[f,I]=a.useState(null),[l,k]=a.useState(!1),[A,v]=a.useState(!1);a.useEffect(()=>{v(!1),k(!1),I(null),T(),r&&s(r,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[m,T,r,s]);const H=!!t&&!d&&t?.bryterRetningslinjer&&!l;a.useEffect(()=>{const p=!!t&&!d&&!!t?.bryterRetningslinjer&&!l;s(E,p,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[t,d,l,E,s]);const N=a.useCallback(async()=>{if(!await h(c))return;const w=V(c),D=(typeof w=="string"?w:String(w??"")).trim(),K=L(D);if(K){if(b!==void 0){const o=L(b);if(K===o)return}try{const o=await F({feltType:n,tekst:D});v(!0),r&&s(r,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const g=o?.loggId??t?.loggId??null;if(I(g),(!(o?.bryterRetningslinjer??t?.bryterRetningslinjer)||l)&&!u&&(await y(!1),g&&i))try{await i({id:g,lagret:!0})}catch(q){new S({message:`Feil ved oppdatering av /lagret for logg ${g}.`,error:q})}}catch(o){new S({message:"Validation failed:",error:o}),v(!0),r&&s(r,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[h,c,V,F,n,l,u,y,i,t,r,s,b]),P=a.useCallback(async()=>{if(u){k(!0);return}if(k(!0),await y(!0),f&&i)try{await i({id:f,lagret:!0})}catch(p){new S({message:`Feil ved oppdatering av /lagret for logg ${f}.`,error:p})}},[u,y,f,i]),C=!!t&&!d&&!!t?.bryterRetningslinjer;return{analyse:t,analyseError:d,validating:x,kiErrorBorder:H,forceSave:l,setForceSave:k,loggId:f,hasChecked:A,showAnalysis:U?A&&C:C,erRedigeringAvPublisertTreff:u,runValidationAndMaybeSave:N,onForceSave:P}}export{oe as u};
