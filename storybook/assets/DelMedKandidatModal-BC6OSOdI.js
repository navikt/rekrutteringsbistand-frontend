import{r as j,j as e,L as z,B as R,n as B,W as M,cE as I,T as q,av as J,u as Y,cD as Z,d as C,D,E as W,w as Q}from"./iframe-Dc4kNGne.js";import{u as X,a as ee,D as T}from"./useDatepicker-CNrp0NFK.js";import"./Date.Input-BWsdgrzB.js";import{R as te,a as se}from"./Radio-D54bZV1W.js";import{a as f}from"./parse-BVEnNKgt.js";import{f as H}from"./format-Dy54t0JC.js";import{u as re}from"./KandidatlisteContext-BD9hT32I.js";import{a as u}from"./KandidatHendelseTag-PnBwwGp6.js";import{U as F}from"./umamiEvents-DmzFNrn7.js";import{S as ne}from"./Tasklist-LaN6yHsI.js";import{M as A}from"./Modal-CqqD7Geb.js";import{A as E}from"./Accordion-TSzVOQQa.js";import{T as p}from"./Table-0336QaRB.js";import{e as G}from"./endOfDay-pN2PnwvR.js";var ae=(function(t){return t.ToDager="TO_DAGER",t.TreDager="TRE_DAGER",t.SyvDager="SYV_DAGER",t.Egenvalgt="EGENVALGT",t})({});const ie={TO_DAGER:"2 dager",TRE_DAGER:"3 dager",SYV_DAGER:"7 dager",EGENVALGT:"Egenvalgt"},K=({tittel:t,setValgtSvarfrist:n})=>{const[s,l]=j.useState(void 0),[o,m]=j.useState(null),{datepickerProps:g,inputProps:a}=X({fromDate:f(new Date,2),toDate:ee(new Date,1),onDateChange:d=>l(d),defaultSelected:s,inputFormat:"dd.MM.yyyy",allowTwoDigitYear:!1});return j.useEffect(()=>{s&&n(s)},[s,n]),e.jsxs("div",{className:"my-4",children:[e.jsx(te,{legend:e.jsxs(e.Fragment,{children:[e.jsx(z,{as:"span",children:t||"Frist for svar"}),e.jsx(R,{as:"span",children:" (må fylles ut)"})]}),description:"Kandidatene kan ikke svare etter denne fristen",defaultValue:null,children:Object.values(ae).map(d=>e.jsx(se,{name:"svarfrist",value:d,onChange:b=>{const v=b.target.value;m(v),l(v==="EGENVALGT"?void 0:oe(v))},children:e.jsx("span",{id:`svarfrist-label_${d}`,children:`${ie[d]} ${le(d)}`})},d))}),e.jsx(T,{...g,children:e.jsx(T.Input,{...a,label:"Velg frist for svar (frist ut valgt dato)",placeholder:"dd.mm.yyyy",disabled:o!=="EGENVALGT"})})]})},le=t=>{let n=new Date;if(t==="TO_DAGER")n=f(n,2);else if(t==="TRE_DAGER")n=f(n,3);else if(t==="SYV_DAGER")n=f(n,7);else return"";return`(frist ut ${H(n,"EEEE d. MMMM",{locale:B})})`},oe=t=>{switch(t){case"TO_DAGER":return f(new Date,2);case"TRE_DAGER":return f(new Date,3);case"SYV_DAGER":return f(new Date,7)}};K.__docgenInfo={description:"",methods:[],displayName:"VelgSvarfrist",props:{tittel:{required:!1,tsType:{name:"string"},description:""},setValgtSvarfrist:{required:!0,tsType:{name:"signature",type:"function",raw:"(dato?: Date) => void",signature:{arguments:[{type:{name:"Date"},name:"dato"}],return:{name:"void"}}},description:""}}};const de=async t=>M(`${I.internUrl}/foresporsler`,t),ce=async(t,n)=>M(`${I.internUrl}/foresporsler/kandidat/${t}`,n),pe=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;return!s||s.length===0?!1:!!s.some(l=>l.type===u.Deling_av_CV_JA)}),me=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;if(!s||s.length===0)return!1;const l=s.filter(a=>a.type===u.Deling_av_CV_NEI);if(l.length===0)return!1;const o=l[0],m=new Date(o.dato||"");return!s.some(a=>a.type===u.Spurt_om_å_dele_CV||a.type===u.Deling_av_CV_JA||a.type===u.Spurt_om_å_dele_CV_IKKE_DIGITAL?new Date(a.dato||"")>m:!1)}),ue=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;if(!s||s.length===0)return!1;const l=s?.filter(a=>a.type===u.Frist_for_deling_av_cv_utløpt);if(l.length===0)return!1;const o=l[0],m=new Date(o.dato||"");return!s.some(a=>a.type===u.Spurt_om_å_dele_CV||a.type===u.Spurt_om_å_dele_CV_IKKE_DIGITAL?new Date(a.dato||"")>m:!1)}),ge=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;return!s||s.length===0?!1:s.some(o=>{if(o.type===u.Spurt_om_å_dele_CV||o.type===u.Spurt_om_å_dele_CV_IKKE_DIGITAL){const m=o.raw&&"svarfrist"in o.raw?new Date(o.raw.svarfrist||""):null;return m&&m>new Date}return!1})}),fe=({markerteKandidater:t,fjernAllMarkering:n,sidebar:s})=>{const{track:l}=q(),{stillingsId:o}=J(),[m,g]=j.useState(!1),[a,d]=j.useState(void 0),{valgtNavKontor:b,visVarsel:v}=Y(),{reFetchKandidatliste:$}=re(),[w,N]=j.useState(!1),L=Z(o),h=me(t),k=ue(t),y=ge(t),_=pe(t),S=[...h,...k].filter(i=>!_.some(r=>r.aktørid===i.aktørid)),x=t.filter(i=>!_.some(r=>r.aktørid===i.aktørid)&&!h.some(r=>r.aktørid===i.aktørid)&&!k.some(r=>r.aktørid===i.aktørid)&&!y.some(r=>r.aktørid===i.aktørid)),P=async()=>{const i=x.map(c=>c.aktørid).filter(c=>c!==null),r=S.filter(c=>c.aktørid);if(a){N(!0);try{if(i.length>0&&(await de({stillingsId:o,svarfrist:H(G(a),"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),aktorIder:i,navKontor:b?.navKontor??""}),l(F.Stilling.del_stilling_med_kandidat,{antall:i.length})),r.length>0){const c=r.map(V=>ce(V.aktørid,{stillingsId:o,svarfrist:H(G(a),"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),navKontor:b?.navKontor??""}));l(F.Stilling.del_stilling_med_kandidat_påNytt,{antall:r.length}),await Promise.all(c)}v({tekst:"Stillingen er delt med kandidatene",type:"info"})}catch(c){new Q({message:"Feil ved deling av CV for kandidater",error:c}),v({tekst:"Det oppstod en feil ved deling av stilling til alle markerte kandidater",type:"error"})}finally{n(),g(!1),N(!1),setTimeout(()=>{L.mutate(),$()},5e3)}}},O=i=>{if(i===null)return"Kan ikke spørre";switch(!0){case _.some(r=>r.aktørid===i):return"Har allerede svart ja";case y.some(r=>r.aktørid===i):return"Venter på svar";case h.some(r=>r.aktørid===i):return"Har tidligere svart nei";case k.some(r=>r.aktørid===i):return"Frist utløpt";default:return"Ikke spurt"}};return e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-nowrap",disabled:t.length===0,onClick:()=>g(!0),variant:s?"primary":"tertiary",icon:e.jsx(ne,{title:"Del med jobbsøker"}),children:"Spør om å dele CV"}),e.jsxs(A,{open:m,"aria-label":"Del stillingen med de markerte jobbsøkere",onClose:()=>g(!1),header:{heading:`Del med ${t.length} ${t.length===1?"jobbsøker ":"jobbsøkere"} i aktivitetsplanen`},children:[e.jsxs(A.Body,{children:[y.length>0&&e.jsxs(D,{variant:"info",size:"small",className:"mb-1",children:[y.length," ",y.length===1?"jobbsøker ":"jobbsøkere","har ikke svart på forespørselen."]}),h.length>0&&e.jsxs(D,{variant:"error",size:"small",className:"mb-1",children:[h.length," ",h.length===1?"jobbsøker ":"jobbsøkere","har tidliger svart nei til å dele CV-en."]}),k.length>0&&e.jsxs(D,{variant:"warning",size:"small",className:"mb-1",children:[k.length," ",k.length===1?"jobbsøker ":"jobbsøkere","har tidligere fått spørsmål, men ikke svart innen fristen."]}),_.length>0&&e.jsxs(D,{variant:"success",size:"small",className:"mb-1",children:[_.length," ",_.length===1?"jobbsøker ":"jobbsøkere","har allerede svart ja."]}),e.jsx(E,{size:"small",headingSize:"xsmall",className:"my-4",children:e.jsxs(E.Item,{children:[e.jsx(E.Header,{children:"Vis jobbsøkere"}),e.jsx(E.Content,{children:e.jsxs(p,{size:"small",children:[e.jsx(p.Header,{children:e.jsxs(p.Row,{children:[e.jsx(p.HeaderCell,{scope:"col",children:"Navn"}),e.jsx(p.HeaderCell,{scope:"col",children:"Fødselsnr."}),e.jsx(p.HeaderCell,{scope:"col",children:"Status"})]})}),e.jsx(p.Body,{children:t?.map(({fornavn:i,etternavn:r,fodselsnr:c,aktørid:V},U)=>e.jsxs(p.Row,{children:[e.jsxs(p.HeaderCell,{scope:"row",children:[i," ",r]}),e.jsx(p.DataCell,{children:c}),e.jsx(p.DataCell,{children:O(V)})]},U))})]})})]})}),e.jsx(R,{className:"my-8",children:e.jsxs(e.Fragment,{children:[x.length>0&&`Deler for første gang stillingen med ${x.length} ${x.length===1?"jobbsøker":"jobbsøkere"}.`,S.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),`Spør om deling på nytt for ${S.length} ${S.length===1?"jobbsøker":"jobbsøkere"}.`]})]})}),e.jsx(W,{className:"my-8",children:`Det opprettes et stillingskort i Aktivitetsplanen. Jobbsøkere
                  vil bli varslet på SMS, og kan svare "ja" eller "nei" til at
                  CV-en skal bli delt med arbeidsgiver. Du vil se svaret i
                  kandidatlisten.`}),e.jsx(K,{setValgtSvarfrist:d}),e.jsxs(D,{variant:"info",className:"mt-8",children:["Stillingsoppdraget vil bli delt med jobbsøker.",e.jsx("br",{})," Det er viktig at annonseteksten er informativ og lett å forstå."]})]}),e.jsxs(A.Footer,{children:[e.jsx(C,{disabled:!a||t.length===0,onClick:P,variant:"primary",loading:w,children:"Del stilling"}),e.jsx(C,{disabled:w,variant:"secondary",onClick:()=>g(!1),children:"Avbryt"})]})]})]})};fe.__docgenInfo={description:"",methods:[],displayName:"DelMedKandidatModal",props:{markerteKandidater:{required:!0,tsType:{name:"Array",elements:[{name:"KandidatVisningProps"}],raw:"KandidatVisningProps[]"},description:""},fjernAllMarkering:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},sidebar:{required:!1,tsType:{name:"boolean"},description:""}}};export{fe as D,K as V};
