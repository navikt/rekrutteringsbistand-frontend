import{r as g,j as e,e as m,w as E,bg as O,h as z,b7 as L,L as D,B as k}from"./iframe-B7Dvl8Jj.js";import{M as p}from"./Modal-C4YlaOo0.js";import{t as _,f as q}from"./utils-DI_JEJrr.js";const P=({rekrutteringstreffId:t,oppdaterData:s})=>{const[a,n]=g.useState(!1),r=g.useRef(null),i=()=>r.current?.showModal(),l=()=>{a||r.current?.close()},d=async()=>{if(a)return;n(!0);let c=!1;try{await O(t),s(),c=!0}catch(f){new z({message:"Gjenåpning av rekrutteringstreff feilet",error:f})}finally{n(!1),c&&r.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"button",size:"small",variant:"primary",loading:a,onClick:i,children:"Gjenåpne"}),e.jsxs(p,{ref:r,onClose:()=>{a&&r.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(p.Body,{children:e.jsx(E,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(p.Footer,{children:[e.jsx(m,{type:"button",size:"small",loading:a,onClick:()=>void d(),children:"Gjenåpne"}),e.jsx(m,{type:"button",size:"small",variant:"secondary",disabled:a,onClick:l,children:"Avbryt"})]})]})]})};P.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const b=(t,s)=>{if(!t)return null;const a=s?.trim()||"00:00";return _(t,a)},y=t=>t?q(t):"",u=(t,s,a,n,r)=>{const i=c=>r?r(c):c??"",l=i(a),d=i(n);l!==d&&t.push({etikett:s,gammelVerdi:l,nyVerdi:d})},A=(t,s,a)=>{const n=[],r=b(t.fraDato,t.fraTid)??s?.fraTid,i=b(t.tilDato??t.fraDato,t.tilTid)??s?.tilTid,l=b(t.svarfristDato,t.svarfristTid)??s?.svarfrist,d=t.tittel?.trim()||s?.tittel||"";return u(n,"Tittel",s?.tittel,d),u(n,"Beskrivelse",s?.beskrivelse,t.beskrivelse??s?.beskrivelse),u(n,"Fra",s?.fraTid,r,y),u(n,"Til",s?.tilTid,i,y),u(n,"Svarfrist",s?.svarfrist,l,y),u(n,"Gateadresse",s?.gateadresse,t.gateadresse??s?.gateadresse),u(n,"Postnummer",s?.postnummer,t.postnummer??s?.postnummer),u(n,"Poststed",s?.poststed,t.poststed??s?.poststed),(a||"")!==(t.htmlContent||"")&&n.push({etikett:"Innlegg",gammelVerdi:"Innhold endret",nyVerdi:"Innhold endret"}),n},J=({treff:t,innleggHtmlFraBackend:s})=>{const a=g.useRef(null),{getValues:n,watch:r,formState:i}=L(),[l,d]=g.useState([]),[c,f]=g.useState(!1);g.useEffect(()=>{if(!t){d([]);return}const o=()=>{const G=n(),N=A(G,t,s||"");d(B=>JSON.stringify(B)===JSON.stringify(N)?B:N)};o();const h=r(()=>{o()});return()=>h.unsubscribe()},[t,r,n,s]),g.useEffect(()=>{c&&!i.isSubmitting?((!i.errors||Object.keys(i.errors).length===0)&&R(),f(!1)):i.isSubmitting&&!c&&f(!0)},[i.isSubmitting,i.errors,c]);const x=r("tittelKiSjekket")??!1,v=r("htmlContentKiSjekket")??!1,w=r("tittelKiFeil")??!1,C=r("htmlContentKiFeil")??!1,K=w||C,M=!!(i.errors&&Object.keys(i.errors).some(o=>o!=="root")),S=K||M,T=t?.tittel?.trim()==="Treff uten navn",F=l.some(o=>o.etikett==="Tittel"),I=l.some(o=>o.etikett==="Innlegg"),j=g.useMemo(()=>l.length===0||S||!((!F||x)&&(!I||v))||T,[l.length,S,F,I,x,v,T]),V=()=>!j&&a.current?.showModal(),R=()=>a.current?.close();return e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"button",variant:"primary",size:"small",disabled:j,onClick:V,children:"Publiser på nytt"}),e.jsxs(p,{ref:a,header:{heading:"Følgende endringer vil bli publisert"},children:[e.jsx(p.Body,{children:e.jsxs("div",{className:"space-y-3",children:[l.length===0?e.jsx(E,{children:"Ingen endringer oppdaget."}):e.jsx("div",{className:"space-y-3",children:l.map((o,h)=>e.jsxs("div",{className:"border-b pb-2",children:[e.jsx(D,{size:"small",children:o.etikett}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Fra:"}),e.jsx(k,{className:"text-gray-400",children:o.gammelVerdi||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Til:"}),e.jsx(k,{className:"text-gray-400",children:o.nyVerdi||"—"})]})]},h))}),e.jsx(k,{className:"text-gray-600",children:"Inviterte deltakere vil ikke bli informert om endringene på nytt av republiseringen"})]})}),e.jsxs(p.Footer,{children:[e.jsx(m,{type:"submit",form:"rekrutteringstreff-form",variant:"primary",size:"small",disabled:j,loading:i.isSubmitting,children:"Publiser på nytt"}),e.jsx(m,{type:"button",variant:"secondary",size:"small",onClick:R,disabled:i.isSubmitting,children:"Avbryt"})]})]})]})};J.__docgenInfo={description:`Komponent for å republisere et rekrutteringstreff.
Viser en knapp som åpner en modal for bekreftelse av endringer før republisering.`,methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{treff:{required:!0,tsType:{name:"any"},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{P as G,J as R};
