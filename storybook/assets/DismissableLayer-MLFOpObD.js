import{r as a,aH as A,R as D,_ as V,q as Z}from"./iframe-uCi_mQk4.js";import{c as q}from"./useDescendant-CFdznkdX.js";import{a as w}from"./useControllableState-CTHa6vAV.js";function z(o,e=globalThis?.document){const r=w(o);a.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return e.addEventListener("keydown",n,!0),()=>e.removeEventListener("keydown",n,!0)},[r,e])}const U={FOCUS_OUTSIDE:"AKSEL_FOCUS_OUTSIDE",POINTER_DOWN_OUTSIDE:"AKSEL_POINTER_DOWN_OUTSIDE"};function k(o,e,r,{discrete:n}={discrete:!1}){if(!e)return;const s=r.originalEvent.target,l=new CustomEvent(o,{bubbles:!1,cancelable:!0,detail:r});s.addEventListener(o,e,{once:!0}),n&&s?A.flushSync(()=>s.dispatchEvent(l)):s.dispatchEvent(l)}function G(o,e=globalThis?.document){const r=w(o),n=a.useRef(!1);return a.useEffect(()=>{const s=l=>{if(l.target&&!n.current){const u={originalEvent:l};k(U.FOCUS_OUTSIDE,r,u)}};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,r]),{onFocusCapture:()=>{n.current=!0},onBlurCapture:()=>{n.current=!1}}}function J(o,e=globalThis?.document){const r=w(o),n=a.useRef(!1),s=a.useRef(()=>{});return a.useEffect(()=>{const l=c=>{function d(){k(U.POINTER_DOWN_OUTSIDE,r,{originalEvent:c},{discrete:!0})}c.target&&!n.current?c.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=d,e.addEventListener("click",s.current,{once:!0})):d():e.removeEventListener("click",s.current),n.current=!1},u=window.setTimeout(()=>{e.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(u),e.removeEventListener("pointerdown",l),e.removeEventListener("click",s.current)}},[e,r]),{onPointerDownCapture:()=>{n.current=!0}}}var Q=function(o,e){var r={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&e.indexOf(n)<0&&(r[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(r[n[s]]=o[n[s]]);return r};const[X,Y,$,ee]=q();let g=0,F;const ie=a.forwardRef((o,e)=>Y(!1)?D.createElement(N,Object.assign({ref:e},o)):D.createElement(te,null,D.createElement(N,Object.assign({ref:e},o)))),te=({children:o})=>{const e=$();return D.createElement(X,{value:e},o)},N=a.forwardRef((o,e)=>{var r,{children:n,asChild:s,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:c,onInteractOutside:d,onDismiss:b,safeZone:i,disableOutsidePointerEvents:m=!1,enabled:f=!0}=o,R=Q(o,["children","asChild","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","safeZone","disableOutsidePointerEvents","enabled"]);const[,x]=a.useState({}),{register:j,index:T,descendants:O}=ee({disableOutsidePointerEvents:m,disabled:!f,forceUpdate:()=>x({})}),[p,K]=a.useState(null),B=V(K,j,e),v=(r=p?.ownerDocument)!==null&&r!==void 0?r:globalThis?.document,S=a.useRef(!1),P=a.useRef(!1),I=(()=>{let t=-1;return O.enabledValues().forEach((y,E)=>{y.disableOutsidePointerEvents&&(t=E)}),{isPointerEventsEnabled:T>=t,isBodyPointerEventsDisabled:g>0,pointerStyle:T>=t&&g>0?"auto":void 0}})();function L(t){var h,y;if(!i?.anchor&&!i?.dismissable||!f)return;t.defaultPrevented||(S.current=!0,t.detail.originalEvent.type==="pointerdown"&&(P.current=!0));const E=t.target;t.detail.originalEvent.type==="pointerdown"?(!((h=i?.anchor)===null||h===void 0)&&h.contains(E)||E===i?.anchor)&&t.preventDefault():!(E instanceof HTMLElement&&![i?.anchor,i?.dismissable].some(C=>C?.contains(E))&&!E.contains((y=i?.dismissable)!==null&&y!==void 0?y:null))&&t.preventDefault(),t.detail.originalEvent.type==="focusin"&&P.current&&t.preventDefault(),P.current=!1,S.current=!1}const H=J(t=>{!I.isPointerEventsEnabled||!f||(u?.(t),d?.(t),i&&L(t),!t.defaultPrevented&&b&&b())},v),_=G(t=>{f&&(c?.(t),d?.(t),i&&L(t),!t.defaultPrevented&&b&&b())},v);z(t=>{!f||!(T===O.enabledCount()-1)||(l?.(t),!t.defaultPrevented&&b&&(t.preventDefault(),b()))},v),a.useEffect(()=>{if(!(!p||!f||!m))return g===0&&(F=v.body.style.pointerEvents,v.body.style.pointerEvents="none"),g++,()=>{g===1&&(v.body.style.pointerEvents=F),g--}},[p,v,m,O,f]),a.useEffect(()=>()=>O.values().forEach(t=>t.forceUpdate()),[O,p]);const M=s?Z:"div";return D.createElement(M,Object.assign({ref:B},R,{onFocusCapture:_.onFocusCapture,onBlurCapture:_.onBlurCapture,onPointerDownCapture:H.onPointerDownCapture,style:Object.assign({pointerEvents:I.pointerStyle},R.style)}),n)});export{ie as D};
