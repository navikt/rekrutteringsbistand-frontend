import{r as f}from"./iframe-qbxWu-tL.js";const G=ue();function c(e,...t){if(!G)return;const r=oe(e,...t);performance.mark(r);try{console.log(e,...t)}catch{console.log(r)}}function ne(e,...t){G&&console.warn(e,...t)}function oe(e,...t){return e.replace(/%[sfdO]/g,r=>{const s=t.shift();return r==="%O"&&s?JSON.stringify(s).replace(/"([^"]+)":/g,"$1:"):String(s)})}function ue(){try{const e="nuqs-localStorage-test";if(typeof localStorage>"u")return!1;localStorage.setItem(e,e);const t=localStorage.getItem(e)===e;return localStorage.removeItem(e),t&&(localStorage.getItem("debug")||"").includes("nuqs")}catch{return!1}}const ie={303:"Multiple adapter contexts detected. This might happen in monorepos.",404:"nuqs requires an adapter to work with your framework.",409:"Multiple versions of the library are loaded. This may lead to unexpected behavior. Currently using `%s`, but `%s` (via the %s adapter) was about to load on top.",414:"Max safe URL length exceeded. Some browsers may not be able to accept this URL. Consider limiting the amount of state stored in the URL.",429:"URL update rate-limited by the browser. Consider increasing `throttleMs` for key(s) `%s`. %O",500:"Empty search params cache. Search params can't be accessed in Layouts.",501:"Search params cache already populated. Have you called `parse` twice?"};function z(e){return`[nuqs] ${ie[e]}
  See https://err.47ng.com/NUQS-${e}`}const P=f.createContext({useAdapter(){throw new Error(z(404))}});P.displayName="NuqsAdapterContext";G&&typeof window<"u"&&(window.__NuqsAdapterContext&&window.__NuqsAdapterContext!==P&&console.error(z(303)),window.__NuqsAdapterContext=P);function le(e){const t=f.useContext(P);if(!("useAdapter"in t))throw new Error(z(404));return t.useAdapter(e)}const ae=()=>f.useContext(P).defaultOptions;function ce(){if(typeof window>"u"||!!!window.GestureEvent)return 50;try{const t=navigator.userAgent?.match(/version\/([\d\.]+) safari/i);return parseFloat(t[1])>=17?120:320}catch{return 320}}function he(e){return{method:"throttle",timeMs:e}}const x=he(ce());function ee(){const e=new Map;return{all:e,on(t,r){const s=e.get(t)||[];return s.push(r),e.set(t,s),()=>this.off(t,r)},off(t,r){const s=e.get(t);s&&e.set(t,s.filter(n=>n!==r))},emit(t,r){e.get(t)?.forEach(n=>n(r))}}}function J(e,t,r){function s(){e(),r.removeEventListener("abort",o)}const n=setTimeout(s,t);function o(){clearTimeout(n),r.removeEventListener("abort",o)}r.addEventListener("abort",o)}function $(){const e=Promise;if(Promise.hasOwnProperty("withResolvers"))return Promise.withResolvers();let t=()=>{},r=()=>{};return{promise:new e((n,o)=>{t=n,r=o}),resolve:t,reject:r}}function fe(e,t){let r=t;for(let s=e.length-1;s>=0;s--){const n=e[s];if(!n)continue;const o=r;r=()=>n(o)}r()}function te(){return new URLSearchParams(location.search)}var re=class{updateMap=new Map;options={history:"replace",scroll:!1,shallow:!0};timeMs=x.timeMs;transitions=new Set;resolvers=null;controller=new AbortController;lastFlushedAt=0;push({key:e,query:t,options:r},s=x.timeMs){c("[nuqs gtq] Enqueueing %s=%s %O",e,t,r),this.updateMap.set(e,t),r.history==="push"&&(this.options.history="push"),r.scroll&&(this.options.scroll=!0),r.shallow===!1&&(this.options.shallow=!1),r.startTransition&&this.transitions.add(r.startTransition),(!Number.isFinite(this.timeMs)||s>this.timeMs)&&(this.timeMs=s)}getQueuedQuery(e){return this.updateMap.get(e)}flush({getSearchParamsSnapshot:e=te,rateLimitFactor:t=1,...r}){if(!Number.isFinite(this.timeMs))return c("[nuqs gtq] Skipping flush due to throttleMs=Infinity"),Promise.resolve(e());if(this.resolvers)return this.resolvers.promise;this.resolvers=$();const s=()=>{this.lastFlushedAt=performance.now();const[o,u]=this.applyPendingUpdates({...r,autoResetQueueOnUpdate:r.autoResetQueueOnUpdate??!0,getSearchParamsSnapshot:e});u===null?this.resolvers.resolve(o):this.resolvers.reject(o),this.resolvers=null};return J(()=>{const u=performance.now()-this.lastFlushedAt,a=this.timeMs,i=t*Math.max(0,a-u);c("[nuqs gtq] Scheduling flush in %f ms. Throttled at %f ms (x%f)",i,a,t),i===0?s():J(s,i,this.controller.signal)},0,this.controller.signal),this.resolvers.promise}abort(){return this.controller.abort(),this.controller=new AbortController,this.resolvers?.resolve(new URLSearchParams),this.resolvers=null,this.reset()}reset(){const e=Array.from(this.updateMap.keys());return c("[nuqs gtq] Resetting queue %s",JSON.stringify(Object.fromEntries(this.updateMap))),this.updateMap.clear(),this.transitions.clear(),this.options={history:"replace",scroll:!1,shallow:!0},this.timeMs=x.timeMs,e}applyPendingUpdates(e){const{updateUrl:t,getSearchParamsSnapshot:r}=e,s=r();if(c("[nuqs gtq] Applying %d pending update(s) on top of %s",this.updateMap.size,s.toString()),this.updateMap.size===0)return[s,null];const n=Array.from(this.updateMap.entries()),o={...this.options},u=Array.from(this.transitions);e.autoResetQueueOnUpdate&&this.reset(),c("[nuqs gtq] Flushing queue %O with options %O",n,o);for(const[a,i]of n)i===null?s.delete(a):s.set(a,i);try{return fe(u,()=>{t(s,o)}),[s,null]}catch(a){return console.error(z(429),n.map(([i])=>i).join(),a),[s,a]}}};const B=new re;function de(e,t,r){const s=f.useCallback(()=>{const u=Object.fromEntries(e.map(i=>[i,r(i)]));return[JSON.stringify(u),u]},[e.join(","),r]),n=f.useRef(null);n.current===null&&(n.current=s());const o=f.useCallback(u=>{const a=e.map(i=>t(i,u));return()=>a.forEach(i=>i())},[e.join(","),t]);return f.useSyncExternalStore(o,()=>{const[u,a]=s();return n.current[0]===u?n.current[1]:(n.current=[u,a],a)},()=>n.current[1])}var pe=class{callback;resolvers=$();controller=new AbortController;queuedValue=void 0;constructor(e){this.callback=e}abort(){this.controller.abort(),this.queuedValue=void 0}push(e,t){return this.queuedValue=e,this.controller.abort(),this.controller=new AbortController,J(()=>{const r=this.resolvers;try{c("[nuqs dq] Flushing debounce queue",e);const s=this.callback(e);c("[nuqs dq] Reset debounce queue %O",this.queuedValue),this.queuedValue=void 0,this.resolvers=$(),s.then(n=>r.resolve(n)).catch(n=>r.reject(n))}catch(s){this.queuedValue=void 0,r.reject(s)}},t,this.controller.signal),this.resolvers.promise}},me=class{throttleQueue;queues=new Map;queuedQuerySync=ee();constructor(e=new re){this.throttleQueue=e}useQueuedQueries(e){return de(e,(t,r)=>this.queuedQuerySync.on(t,r),t=>this.getQueuedQuery(t))}push(e,t,r){if(!Number.isFinite(t)){const o=r.getSearchParamsSnapshot??te;return Promise.resolve(o())}const s=e.key;if(!this.queues.has(s)){c("[nuqs dqc] Creating debounce queue for `%s`",s);const o=new pe(u=>(this.throttleQueue.push(u),this.throttleQueue.flush(r).finally(()=>{this.queues.get(u.key)?.queuedValue===void 0&&(c("[nuqs dqc] Cleaning up empty queue for `%s`",u.key),this.queues.delete(u.key)),this.queuedQuerySync.emit(u.key)})));this.queues.set(s,o)}c("[nuqs dqc] Enqueueing debounce update %O",e);const n=this.queues.get(s).push(e,t);return this.queuedQuerySync.emit(s),n}abort(e){const t=this.queues.get(e);return t?(c("[nuqs dqc] Aborting debounce queue %s=%s",e,t.queuedValue?.query),this.queues.delete(e),t.abort(),this.queuedQuerySync.emit(e),r=>(r.then(t.resolvers.resolve,t.resolvers.reject),r)):r=>r}abortAll(){for(const[e,t]of this.queues.entries())c("[nuqs dqc] Aborting debounce queue %s=%s",e,t.queuedValue?.query),t.abort(),t.resolvers.resolve(new URLSearchParams),this.queuedQuerySync.emit(e);this.queues.clear()}getQueuedQuery(e){const t=this.queues.get(e)?.queuedValue?.query;return t!==void 0?t:this.throttleQueue.getQueuedQuery(e)}};const k=new me(B);function H(e,t,r){try{return e(t)}catch(s){return ne("[nuqs] Error while parsing value `%s`: %O"+(r?" (for key `%s`)":""),t,s,r),null}}function v(e){function t(r){if(typeof r>"u")return null;let s="";if(Array.isArray(r)){if(r[0]===void 0)return null;s=r[0]}return typeof r=="string"&&(s=r),H(e.parse,s)}return{eq:(r,s)=>r===s,...e,parseServerSide:t,withDefault(r){return{...this,defaultValue:r,parseServerSide(s){return t(s)??r}}},withOptions(r){return{...this,...r}}}}const ye=v({parse:e=>e,serialize:String}),ve=v({parse:e=>{const t=parseInt(e);return t==t?t:null},serialize:e=>""+Math.round(e)});v({parse:e=>{const t=parseInt(e);return t==t?t-1:null},serialize:e=>""+Math.round(e+1)});v({parse:e=>{const t=parseInt(e,16);return t==t?t:null},serialize:e=>{const t=Math.round(e).toString(16);return(t.length&1?"0":"")+t}});v({parse:e=>{const t=parseFloat(e);return t==t?t:null},serialize:String});v({parse:e=>e==="true",serialize:String});function W(e,t){return e.valueOf()===t.valueOf()}v({parse:e=>{const t=parseInt(e);return t==t?new Date(t):null},serialize:e=>""+e.valueOf(),eq:W});v({parse:e=>{const t=new Date(e);return t.valueOf()==t.valueOf()?t:null},serialize:e=>e.toISOString(),eq:W});v({parse:e=>{const t=new Date(e.slice(0,10));return t.valueOf()==t.valueOf()?t:null},serialize:e=>e.toISOString().slice(0,10),eq:W});function we(e,t=","){const r=e.eq??((n,o)=>n===o),s=encodeURIComponent(t);return v({parse:n=>n===""?[]:n.split(t).map((o,u)=>H(e.parse,o.replaceAll(s,t),`[${u}]`)).filter(o=>o!=null),serialize:n=>n.map(o=>(e.serialize?e.serialize(o):String(o)).replaceAll(t,s)).join(t),eq(n,o){return n===o?!0:n.length!==o.length?!1:n.every((u,a)=>r(u,o[a]))}})}const K=ee(),qe={};function ge(e,t={}){const r=f.useId(),s=ae(),{history:n="replace",scroll:o=s?.scroll??!1,shallow:u=s?.shallow??!0,throttleMs:a=x.timeMs,limitUrlUpdates:i=s?.limitUrlUpdates,clearOnDefault:g=s?.clearOnDefault??!0,startTransition:q,urlKeys:w=qe}=t,d=Object.keys(e).join(","),p=f.useMemo(()=>Object.fromEntries(Object.keys(e).map(l=>[l,w[l]??l])),[d,JSON.stringify(w)]),O=le(Object.values(p)),j=O.searchParams,A=f.useRef({}),I=f.useMemo(()=>Object.fromEntries(Object.keys(e).map(l=>[l,e[l].defaultValue??null])),[Object.values(e).map(({defaultValue:l})=>l).join(",")]),U=k.useQueuedQueries(Object.values(p)),[T,D]=f.useState(()=>{const l=j??new URLSearchParams;return _(e,w,l,U).state}),y=f.useRef(T);if(c("[nuq+ %s `%s`] render - state: %O, iSP: %s",r,d,T,j),Object.keys(A.current).join("&")!==Object.values(p).join("&")){const{state:l,hasChanged:m}=_(e,w,j,U,A.current,y.current);m&&(c("[nuq+ %s `%s`] State changed: %O",r,d,{state:l,initialSearchParams:j,queuedQueries:U,queryRef:A.current,stateRef:y.current}),y.current=l,D(l)),A.current=Object.fromEntries(Object.values(p).map(h=>[h,j?.get(h)??null]))}f.useEffect(()=>{const{state:l,hasChanged:m}=_(e,w,j,U,A.current,y.current);m&&(c("[nuq+ %s `%s`] State changed: %O",r,d,{state:l,initialSearchParams:j,queuedQueries:U,queryRef:A.current,stateRef:y.current}),y.current=l,D(l))},[Object.values(p).map(l=>`${l}=${j?.get(l)}`).join("&"),JSON.stringify(U)]),f.useEffect(()=>{function l(h){c("[nuq+ %s `%s`] updateInternalState %O",r,d,h),y.current=h,D(h)}const m=Object.keys(e).reduce((h,S)=>(h[S]=({state:E,query:N})=>{const{defaultValue:C}=e[S],V=p[S];y.current={...y.current,[S]:E??C??null},A.current[V]=N,c("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). Resolved: %O",r,d,V,E,C,y.current),l(y.current)},h),{});for(const h of Object.keys(e)){const S=p[h];c("[nuq+ %s `%s`] Subscribing to sync for `%s`",r,S,d),K.on(S,m[h])}return()=>{for(const h of Object.keys(e)){const S=p[h];c("[nuq+ %s `%s`] Unsubscribing to sync for `%s`",r,S,d),K.off(S,m[h])}}},[d,p]);const se=f.useCallback((l,m={})=>{const h=Object.fromEntries(Object.keys(e).map(R=>[R,null])),S=typeof l=="function"?l(Z(y.current,I))??h:l??h;c("[nuq+ %s `%s`] setState: %O",r,d,S);let E,N=0;const C=[];for(let[R,M]of Object.entries(S)){const b=e[R],L=p[R];if(!b)continue;(m.clearOnDefault??b.clearOnDefault??g)&&M!==null&&b.defaultValue!==void 0&&(b.eq??((Q,F)=>Q===F))(M,b.defaultValue)&&(M=null);const X=M===null?null:(b.serialize??String)(M);K.emit(L,{state:M,query:X});const Y={key:L,query:X,options:{history:m.history??b.history??n,shallow:m.shallow??b.shallow??u,scroll:m.scroll??b.scroll??o,startTransition:m.startTransition??b.startTransition??q}};if(m?.limitUrlUpdates?.method==="debounce"||i?.method==="debounce"||b.limitUrlUpdates?.method==="debounce"){const Q=m?.limitUrlUpdates?.timeMs??i?.timeMs??b.limitUrlUpdates?.timeMs??x.timeMs,F=k.push(Y,Q,O);N<Q&&(E=F,N=Q)}else{const Q=m?.limitUrlUpdates?.timeMs??b?.limitUrlUpdates?.timeMs??i?.timeMs??m.throttleMs??b.throttleMs??a;C.push(k.abort(L)),B.push(Y,Q)}}const V=C.reduce((R,M)=>M(R),B.flush(O));return E??V},[d,n,u,o,a,i?.method,i?.timeMs,q,p,O.updateUrl,O.getSearchParamsSnapshot,O.rateLimitFactor,I]);return[f.useMemo(()=>Z(T,I),[T,I]),se]}function _(e,t,r,s,n,o){let u=!1;const a=Object.keys(e).reduce((i,g)=>{const q=t?.[g]??g,{parse:w}=e[g],d=s[q],p=d===void 0?r?.get(q)??null:d;if(n&&o&&(n[q]??null)===p)return i[g]=o[g]??null,i;u=!0;const O=p===null?null:H(w,p,g);return i[g]=O??null,n&&(n[q]=p),i},{});if(!u){const i=Object.keys(e),g=Object.keys(o??{});u=i.length!==g.length||i.some(q=>!g.includes(q))}return{state:a,hasChanged:u}}function Z(e,t){return Object.fromEntries(Object.keys(e).map(r=>[r,e[r]??t[r]??null]))}function Oe(e,t={}){const{parse:r=q=>q,serialize:s,eq:n,defaultValue:o,...u}=t,[{[e]:a},i]=ge({[e]:{parse:r,serialize:s,eq:n,defaultValue:o}},u),g=f.useCallback((q,w={})=>i(d=>({[e]:typeof q=="function"?q(d[e]):q}),w),[e,i]);return[a,g]}export{we as a,ye as b,ve as p,Oe as u};
