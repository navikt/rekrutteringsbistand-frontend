import{j as r,r as K,w as V,h as D}from"./iframe-Dbv-ZY6m.js";import{O as R}from"./OrganisasjonsnummerAlert-CMN6RSC3.js";import{K as d,a as s}from"./KandidatHendelseTag-BtPcl_FJ.js";import{T as g,K as f}from"./KandidatTyper-CkRsvxsW.js";import{f as p}from"./util-BzjSVB_a.js";import{n as I,m as h}from"./format-Bjj9PWS-.js";import{a as w}from"./util-zb_msfsb.js";function F(t,e,n){const[a,l]=I(n?.in,t,e),u=k(a,l),_=Math.abs(h(a,l));a.setDate(a.getDate()-u*_);const o=+(k(a,l)===-u),c=u*(_-o);return c===0?0:c}function k(t,e){const n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}const j=t=>{const e=p({dato:t.svarfrist,visning:"tall"}),n=t.svarfrist?F(new Date(t.svarfrist),new Date):null,a={dato:new Date(t.deltTidspunkt),raw:t};switch(t.tilstand){case g.IKKE_SENDT:case g.PROVER_VARSLING:return{tag:r.jsx(d,{type:s.Spurt_om_å_dele_CV,dato:e}),type:s.Spurt_om_å_dele_CV,tekst:"Prøver varsling",...a};case g.HAR_VARSLET:return{tag:r.jsx(d,{type:s.Spurt_om_å_dele_CV,dato:e}),type:s.Spurt_om_å_dele_CV,dato:new Date(t.deltTidspunkt),tekst:`av ${t.deltAv}`,raw:t};case g.KAN_IKKE_VARSLE:return{tag:r.jsx(d,{type:s.Spurt_om_å_dele_CV_IKKE_DIGITAL,dato:e}),type:s.Spurt_om_å_dele_CV_IKKE_DIGITAL,tekst:"Kandidaten bruker ikke digitale tjenester fra Nav. Du må ringe og registrere svaret i stillingskortet i Aktivitetsplanen.",...a};case g.KAN_IKKE_OPPRETTE:return{tag:r.jsx(d,{type:s.Deling_Av_CV_Feilet,dato:e}),type:s.Deling_Av_CV_Feilet,tekst:"Kan ikke opprette forespørsel",...a};case g.AVBRUTT:return t.deltStatus==="SENDT"&&n!==null&&n<0?{tag:r.jsx(d,{type:s.Frist_for_deling_av_cv_utløpt,dato:e}),type:s.Frist_for_deling_av_cv_utløpt,tekst:`Frist for deling av CV utløpt ${t.svarfrist&&p({dato:t.svarfrist})}`,...a}:{type:s.Avbrutt_i_aktivitetsplanen,tag:r.jsx(d,{type:s.Avbrutt_i_aktivitetsplanen}),...a};case g.HAR_SVART:return t.svar?.harSvartJa?{tag:r.jsx(d,{type:s.Deling_av_CV_JA,dato:e}),type:s.Deling_av_CV_JA,tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&p({dato:t.svar?.svarTidspunkt})}`,...a}:{type:s.Deling_av_CV_NEI,tag:r.jsx(d,{type:s.Deling_av_CV_NEI,dato:e}),tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&p({dato:t.svar?.svarTidspunkt})}`,...a};default:return{type:null,tag:r.jsx(d,{type:null}),...a}}},N=(t,e=!1)=>{const n={dato:new Date(t.tidspunkt),raw:t};switch(t.utfall){case f.FATT_JOBBEN:return{type:s.Fått_jobben,...n,tag:r.jsx(d,{type:s.Fått_jobben})};case f.IKKE_PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste===!1&&e?{...n,tag:r.jsx(d,{type:s.CV_slettet_hos_arbeidsgiver}),type:s.CV_slettet_hos_arbeidsgiver,tekst:s.CV_slettet_hos_arbeidsgiver}:{type:null,...n};case f.PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste?{...n,type:s.CV_delt_med_arbeidsgiver,tag:r.jsx(d,{type:s.CV_delt_med_arbeidsgiver})}:{...n,type:null};default:return{...n,type:null,tag:r.jsx(d,{type:null})}}},L=({kandidat:t,forespørselCvForKandidat:e,beskjedForKandidat:n})=>{const a=t.utfallsendringer?.some(i=>i.utfall===f.PRESENTERT&&i.sendtTilArbeidsgiversKandidatliste),l=t.utfallsendringer?.map(i=>N(i,a)),u=e?.map(i=>j(i));let _=null;n!==null&&n?.opprettet&&(_={type:n?.eksternStatus?.includes("FEIL")?s.SMS_FEIL:s.SMS_OK,tag:r.jsx(d,{type:n?.eksternStatus?.includes("FEIL")?s.SMS_FEIL:s.SMS_OK}),tekst:w((n?.eksternFeilmelding||"").replace(/[_-]/g," ")),dato:new Date(n?.opprettet),raw:n});const o=_?[_]:[],c=[...u??[],...l??[]].filter(i=>i.type!==null).sort((i,m)=>(m.dato?.getTime()||0)-(i.dato?.getTime()||0))[0],y=o?o.sort((i,m)=>(m.dato?.getTime()||0)-(i.dato?.getTime()||0))[0]:null;return{utfallsendringer:l,cvHendelser:u,varsler:o,sisteSms:y,sisteHendelse:c}},M=(t,e,n)=>{const a=t.aktørid&&e?e[t.aktørid]:null,l=n&&n[t.fodselsnr??""],u=L({kandidat:t,forespørselCvForKandidat:a,beskjedForKandidat:l});return{...t,kandidatHendelser:u}},E=K.createContext(void 0),b=({children:t,kandidatliste:e,forespurteKandidater:n,beskjeder:a,reFetchKandidatliste:l})=>{const{stillingsData:u,kandidatlisteInfo:_}=D(),[o,c]=K.useState([]),y=_?.kandidatlisteStatus==="LUKKET",S=e?.organisasjonReferanse,i=u?.stilling?.employer?.orgnr,m=!!(S&&i&&S!==i),A=v=>{if(c&&o){const x=o.some(T=>T.fodselsnr===v.fodselsnr)?o.filter(T=>T.fodselsnr!==v.fodselsnr):[...o,v];c(x)}},C=e.kandidater?e.kandidater.map(v=>M(v,n,a)):[];return r.jsxs(E.Provider,{value:{forespurteKandidater:n,beskjeder:a,markerteKandidater:o,setMarkerteKandidater:c,lukketKandidatliste:y,reFetchKandidatliste:l,toggleMarkerKandidat:A,kandidatlisteId:e.kandidatlisteId,usynligeKandidater:e.formidlingerAvUsynligKandidat,kandidater:C,kandidatlisteRawData:e},children:[m&&r.jsx(R,{}),t]})},J=()=>{const t=K.useContext(E);if(t===void 0)throw new V({message:"Context er undefined, må være children av KandidatlisteContextProvider."});return t};b.__docgenInfo={description:"",methods:[],displayName:"KandidatlisteContextProvider",props:{children:{required:!1,tsType:{name:"union",raw:"ReactNode | undefined",elements:[{name:"ReactNode"},{name:"undefined"}]},description:""},kandidatliste:{required:!0,tsType:{name:"z.infer",elements:[{name:"kandidatlisteSchema"}],raw:"z.infer<typeof kandidatlisteSchema>"},description:""},forespurteKandidater:{required:!0,tsType:{name:"z.infer",elements:[{name:"ForespurteOmDelingAvCvSchema"}],raw:`z.infer<
  typeof ForespurteOmDelingAvCvSchema
>`},description:""},beskjeder:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"z.infer",elements:[{name:"SmsSchema"}],raw:"z.infer<typeof SmsSchema>"}],raw:"Record<string, Sms>"},description:""},reFetchKandidatliste:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{b as K,J as u};
