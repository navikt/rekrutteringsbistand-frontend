import{e as z,a as B}from"./useAutosave-Bs2SQSm2.js";import{h5 as J,o as M,ak as O,T as w,U as Q,h2 as X,hC as Y,h4 as Z,hE as _,r as n,w as b}from"./iframe-DLBscwX4.js";import{a as N,u as ee}from"./useKiLogg-CcMDyxpN.js";const te=(t=":id")=>`${J.internUrl}/${t}/ki/valider`,re=M({feltType:w(),tekst:w()}),se=M({loggId:w(),bryterRetningslinjer:Q(),begrunnelse:w()}),ne=async(t,{arg:e})=>{const l=e.tekst.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),h={...e,tekst:l};re.parse(e);const k=await O(t,h);return se.parse(k)},ae=t=>N(te(t??":id"),ne),G=t=>t==null?"":String(t).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function ue({feltType:t,fieldName:e,savedValue:l,saveCallback:h,onUpdated:k,requireHasCheckedToShow:x=!1}){const{rekrutteringstreffId:j}=X(),{data:D}=Y(j),{control:F,setValue:s,getValues:E,trigger:V}=Z(),{setLagret:a,isLoading:T}=ee(j,t),K=_({control:F,name:e}),g=z(D)&&B(),{trigger:m,data:r,reset:v,error:c,isMutating:H}=ae(j),[u,C]=n.useState(null),[y,R]=n.useState(!1),[I,S]=n.useState(!1);n.useEffect(()=>{S(!1),R(!1),C(null),v(),s(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[K,v,e,s]);const P=!!r&&!c&&r?.bryterRetningslinjer&&!y;n.useEffect(()=>{const i=!!r&&!c&&!!r?.bryterRetningslinjer&&!y;s(`${e}KiFeil`,i,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[r,c,y,e,s]);const p=n.useCallback(async i=>{try{await h([e],i)}catch(d){new b({message:`Lagring av ${t} feilet.`,error:d})}finally{k?.()}},[h,e,t,k]),U=n.useCallback(async()=>{if(!await V(e))return;const d=E(e),$=(typeof d=="string"?d:String(d??"")).trim(),A=G($);if(A){if(l!==void 0){const o=G(l);if(A===o)return}try{const o=await m({feltType:t,tekst:$});S(!0),s(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const f=o?.loggId??r?.loggId??null;if(C(f),!(o?.bryterRetningslinjer??r?.bryterRetningslinjer)&&!g&&(await p(),f&&a))try{await a({id:f,lagret:!0})}catch(q){new b({message:`Feil ved oppdatering av /lagret for logg ${f}.`,error:q})}}catch(o){new b({message:"Validation failed:",error:o}),S(!0),s(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[V,e,E,m,t,g,p,a,r,s,l]),W=n.useCallback(async()=>{if(g){R(!0);return}if(R(!0),await p(!0),u&&a)try{await a({id:u,lagret:!0})}catch(i){new b({message:`Feil ved oppdatering av /lagret for logg ${u}.`,error:i})}},[g,p,u,a]),L=!!r&&!c&&!!r?.bryterRetningslinjer;return{analyse:r,analyseError:c,validating:H,kiErrorBorder:P,harGodkjentKiFeil:y,setHarGodkjentKiFeil:R,loggId:u,hasChecked:I,showAnalysis:x?I&&L:L,erRedigeringAvPublisertTreff:g,runValidationAndMaybeSave:U,onGodkjennKiFeil:W,watchedValue:K,control:F,setValue:s,getValues:E,kiLoggLoading:T}}export{ue as u};
