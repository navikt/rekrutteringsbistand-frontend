import{be as h,bP as L,bg as p,r as d,bQ as w,bR as D,x as P,bS as C,bj as K,bT as j,bU as B,bC as F}from"./iframe-D_5AEIMH.js";import{f as E}from"./index-ZbxCKysi.js";import{t as I}from"./utils-CW2JO-Xp.js";function M(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:o}=h(),{data:i,mutate:n}=L(t),s=i?.[0],{getValues:a,setValue:u}=p();return{lagre:d.useCallback(async()=>{if(!t)return;const l=(a().htmlContent??"").toString();if(l.trim().length!==0)try{const g=s?.opprettetAvPersonNavn||s?.opprettetAvPersonNavident||"Markedskontakt",f={htmlContent:l,tittel:"Om treffet",opprettetAvPersonNavn:g,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:E(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};e("innlegg"),s?.id?await w(t,s.id,f):await D(t,f),n(),u("htmlContent",l,{shouldDirty:!1})}catch(g){new P({message:"Lagring av innlegg feilet.",error:g})}finally{o("innlegg")}},[a,s,n,t,e,o,u]),innlegg:s}}function O(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:o}=h(),{mutate:i}=C(t),{treff:n}=K(),{getValues:s}=p(),a=d.useCallback(()=>{const r=s(),c=I(r.fraDato??null,r.fraTid)??n?.fraTid??null,l=I(r.tilDato??r.fraDato??null,r.tilTid)??n?.tilTid??null,g=I(r.svarfristDato??null,r.svarfristTid)??n?.svarfrist??null,f=typeof r.tittel=="string"?r.tittel.trim():"";return{tittel:f.length>0?f:n?.tittel??"Treff uten navn",beskrivelse:r.beskrivelse??n?.beskrivelse??null,fraTid:c,tilTid:l,svarfrist:g,gateadresse:r.gateadresse??n?.gateadresse??null,postnummer:r.postnummer??n?.postnummer??null,poststed:r.poststed??n?.poststed??null}},[s,n]);return{lagre:d.useCallback(async()=>{if(!t)return;const r=a();try{e("rekrutteringstreff"),await j(t,r),i()}finally{o("rekrutteringstreff")}},[a,t,i,e,o]),byggRekrutteringstreffDto:a}}const x=()=>{try{return!1}catch{return!1}},N=t=>{const e=B(t?.hendelser);return e===F.INVITERE||e===F.FULLFÃ˜RE};function A(){const{watch:t,formState:e}=p(),o=t("tittelKiFeil")??!1,i=t("htmlContentKiFeil")??!1,n=!!o||!!i,s=!!(e.errors&&Object.keys(e.errors).some(g=>g!=="root")),a=n||s,u=!!e?.errors?.tittel,r=!!e?.errors?.htmlContent,c=!!t("tittelKiSjekket"),l=!!t("htmlContentKiSjekket");return{harFeil:a,harKiFeil:n,harAndreSkjemafeil:s,tittelKiFeil:o,innleggKiFeil:i,harTittelFeil:u,harInnleggFeil:r,tittelKiSjekket:c,innleggKiSjekket:l}}const R=(t,e,o,i)=>t||!e?!1:!i||o;function J(){const{rekrutteringstreffId:t}=h(),{treff:e}=K(),{getValues:o,trigger:i,formState:n}=p(),{lagre:s,byggRekrutteringstreffDto:a}=O(),{tittelKiFeil:u,tittelKiSjekket:r}=A(),c=d.useCallback(async(f,k)=>{if(!t||!await i(f&&f.length>0?f:void 0,{shouldFocus:!1}))return;if(n?.errors?.root?.type==="manualPeriod"){const v=a();if((v?.fraTid??null)!==(e?.fraTid??null)||(v?.tilTid??null)!==(e?.tilTid??null))return}const y=o(),m=typeof y.tittel=="string"?y.tittel.trim():"",S=m.length>0&&m!==(e?.tittel??"");R(k??!1,S,u,r)||await s()},[t,e,a,i,n,o,s,r,u]),l=d.useCallback(async(f,k)=>{},[]);return{autosave:d.useMemo(()=>V(e)?l:c,[e,l,c])}}function Q(){const{rekrutteringstreffId:t}=h(),{data:e}=C(t),{getValues:o,trigger:i,formState:n}=p(),{lagre:s,innlegg:a}=M(),{harInnleggFeil:u,innleggKiFeil:r,innleggKiSjekket:c}=A(),l=d.useCallback(async(k,b)=>{if(!t||k&&k.length&&!await i(k,{shouldFocus:!1}))return;const m=(o().htmlContent??"").toString();if(!(m.trim().length>0)||u)return;const v=a?.htmlContent??"",T=m.trim().length>0&&m!==v;R(b??!1,T,r,c)||await s()},[t,e,i,n,o,s,a,u,r,c]),g=d.useCallback(async(k,b)=>{},[]);return{autosave:d.useMemo(()=>V(e)?g:l,[e,g,l])}}const V=t=>N(t)&&x();export{x as a,J as b,N as e,Q as u};
