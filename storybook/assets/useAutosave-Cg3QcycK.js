import{t as v,a as C}from"./utils-D0PS3ret.js";import{o as P,av as S,h5 as b,hC as L,ak as F,T as p,h2 as y,hD as A,h4 as T,r as h,hA as O,w as R,hE as N,hi as I}from"./iframe-Cj10hJN9.js";import{o as M}from"./mutations-CRE7wREE.js";const D=P({tittel:p().min(1,"Tittel kan ikke være tom"),htmlContent:p().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:p().nullable().optional(),opprettetAvPersonBeskrivelse:p().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:p().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),E=L,$=t=>`${b.internUrl}/${t}/innlegg`,x=(t,n)=>`${b.internUrl}/${t}/innlegg/${n}`,H=async(t,n)=>{D.parse(n);const s=await F($(t),n);return E.parse(s)},B=async(t,n,s)=>{D.parse(s);const e=await S(x(t,n),s);return E.parse(e)},J=()=>{try{return!1}catch{return!1}},U=t=>{const n=N(t?.hendelser);return n===I.INVITERE||n===I.FULLFØRE},w=(t,n)=>n?!1:U(t)&&J();function Z(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=y(),{data:e,mutate:c}=A(t),{getValues:u,trigger:o,formState:g}=T(),f=h.useCallback(()=>{const r=u(),i=v(r.fraDato??null,r.fraTid)??e?.fraTid??null,k=v(r.tilDato??r.fraDato??null,r.tilTid)??e?.tilTid??null,l=v(r.svarfristDato??null,r.svarfristTid)??e?.svarfrist??null,a=typeof r.tittel=="string"?r.tittel.trim():"";return{...(a.length>0||e?.tittel&&e.tittel.trim().length>0)&&{tittel:a.length>0?a:e?.tittel},beskrivelse:r.beskrivelse??e?.beskrivelse??null,fraTid:i,tilTid:k,svarfrist:l,gateadresse:r.gateadresse??e?.gateadresse??null,postnummer:r.postnummer??e?.postnummer??null,poststed:r.poststed??e?.poststed??null}},[u,e]);return{save:h.useCallback(async(r,i)=>{if(!t||w(e,i))return;const k=!r||r.length===0;if(!await o(k?void 0:r,{shouldFocus:!1})||g?.errors?.root?.type==="manualPeriod")return;const a=f();try{n("rekrutteringstreff"),await M(t,a),c()}finally{s("rekrutteringstreff")}},[f,t,o,e,c,g?.errors,n,s])}}function q(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=y(),{data:e}=A(t),{data:c,mutate:u}=O(t),o=c?.[0],{getValues:g,trigger:f,setValue:d}=T();return{save:h.useCallback(async(i,k)=>{if(!t||w(e,k)||i&&i.length&&!await f(i,{shouldFocus:!1}))return;const l=(g("htmlContent")??"").toString();if(l.trim())try{const a=o?.opprettetAvPersonNavn||o?.opprettetAvPersonNavident||"Markedskontakt",m={htmlContent:l,tittel:"Om treffet",opprettetAvPersonNavn:a,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:C(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};n("innlegg"),o?.id?await B(t,o.id,m):await H(t,m),u(),d("htmlContent",l,{shouldDirty:!1})}catch(a){new R({message:"Lagring av innlegg feilet.",error:a})}finally{s("innlegg")}},[g,o,u,t,n,s,d,e,f])}}export{J as a,Z as b,U as e,q as u};
