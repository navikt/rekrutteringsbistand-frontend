import{y as Ce,t as A,ah as Se,ai as ee,h2 as te,hC as re,h4 as H,r as u,j as y,B as ne,aP as _,hD as z,hb as Ie,H as se,C as Y}from"./iframe-B2xGUNX-.js";import{t as K,i as G,k as R}from"./utils-ZtUwayO1.js";import{p as ie}from"./parseISO-IukRNK7-.js";import{f as ae,m as Ee}from"./format-DbvlSUt5.js";import{o as qe}from"./mutations-DLCTeFUZ.js";import{u as je,s as Re,e as Me}from"./useRekrutteringstreffValidering-COm2ZQMB.js";import{C as Oe}from"./ComboboxProvider-BQwD-fDo.js";import{i as B}from"./isSameDay-D8SV3bHz.js";import{u as Ne,D as Z}from"./useDatepicker-CEYa_VNa.js";import"./Date.Input-DyqbiFvC.js";function Be(e,n,s){return Ce(e,+A(e)+n)}function Fe(e,n,s){return Be(e,n*Se)}function Ve(e,n,s){const t=A(e,s?.in);return t.setTime(t.getTime()+n*ee),t}function Pe(e){return n=>{const t=(e?Math[e]:Math.trunc)(n);return t===0?0:t}}function Ae(e,n){return+A(e)-+A(n)}function Le(e,n,s){const t=Ae(e,n)/ee;return Pe(s?.roundingMethod)(t)}function He(){const{rekrutteringstreffId:e,startLagring:n,stoppLagring:s}=te(),{data:t,mutate:d}=re(e),{getValues:l}=H(),c=u.useCallback(()=>{const a=l(),m=K(a.fraDato??null,a.fraTid)??t?.fraTid??null,f=K(a.tilDato??a.fraDato??null,a.tilTid)??t?.tilTid??null,b=K(a.svarfristDato??null,a.svarfristTid)??t?.svarfrist??null,T=typeof a.tittel=="string"?a.tittel.trim():"";return{tittel:T.length>0?T:t?.tittel??"Treff uten navn",beskrivelse:a.beskrivelse??t?.beskrivelse??null,fraTid:m,tilTid:f,svarfrist:b,gateadresse:a.gateadresse??t?.gateadresse??null,postnummer:a.postnummer??t?.postnummer??null,poststed:a.poststed??t?.poststed??null}},[l,t]);return{lagre:u.useCallback(async()=>{if(!e)return;const a=c();try{n("rekrutteringstreff"),await qe(e,a),d()}finally{s("rekrutteringstreff")}},[c,e,d,n,s]),buildDto:c}}function oe(){const{rekrutteringstreffId:e}=te(),{data:n}=re(e),{getValues:s,trigger:t,formState:d}=H(),{lagre:l,buildDto:c}=He(),{tittelKiFeil:p,tittelKiSjekket:a}=je();return{autosave:u.useCallback(async f=>{if(!e||Re(n)||!await t(f&&f.length>0?f:void 0,{shouldFocus:!1}))return;if(d?.errors?.root?.type==="manualPeriod"){const g=c();if((g?.fraTid??null)!==(n?.fraTid??null)||(g?.tilTid??null)!==(n?.tilTid??null))return}const T=s(),D=typeof T.tittel=="string"?T.tittel.trim():"",i=D.length>0&&D!==(n?.tittel??"");!Me(n)&&i&&(!a||p)||await l()},[e,n,c,t,d,s,l,a,p])}}const U=[0,30],j=Array.from({length:24},(e,n)=>U.map(s=>`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`)).flat(),$e=/^([01]\d|2[0-3]):([0-5]\d)$/,_e=e=>{const n=e.match(/^(\d{1,2})(?::?(\d{0,2}))?$/);if(!n)return null;const s=Math.min(parseInt(n[1]||"0",10)||0,23),t=parseInt(n[2]||"0",10)||0,d=U.reduce((l,c)=>Math.abs(c-t)<Math.abs(l-t)?c:l,U[0]);return`${String(s).padStart(2,"0")}:${String(d).padStart(2,"0")}`};function ue({value:e,onChange:n,onBlur:s,label:t="Klokkeslett",hideLabel:d,disabled:l,error:c,className:p,options:a,maxTime:m}){const f=u.useRef(null),b=u.useRef(!1),T=u.useRef(!1),D=u.useMemo(()=>{const r=a??j;return m?r.filter(o=>o<=m):r},[a,m]),[i,g]=u.useState(e??""),[E,C]=u.useState(!1),v=u.useRef(!1),$=u.useRef(e),S=u.useRef(!1),q=u.useRef(!1),I=u.useCallback(r=>$e.test(r)&&(!m||r<=m),[m]),F=u.useCallback(r=>!r||/^[\d:]*$/.test(r),[]),fe=u.useCallback((r,o)=>m&&o>m||r.includes(o)?r:[...r,o].sort(),[m]),V=e&&I(e)?fe(D,e):D,M=u.useMemo(()=>V,[V]),W=()=>{const r=f.current;if(!r||typeof document>"u")return null;const o=r.getAttribute("aria-controls");return o?document.getElementById(o):null},me=u.useCallback(()=>{if(b.current)return;const r=f.current;if(!r||r.getAttribute("aria-expanded")!=="true")return;const o=W();if(!o)return;let h=o.querySelector("[role='option'][aria-selected='true']");if(!h&&e&&(h=Array.from(o.querySelectorAll("[role='option']")).find(k=>k.textContent?.trim()===e)||null),!h)return;const x=h.closest("[role='listbox']")||h.parentElement;if(x){const k=h.offsetTop,N=k+h.offsetHeight,Q=x.scrollTop,we=Q+x.clientHeight;if(k<Q+4){x.scrollTop=Math.max(k-4,0);return}if(N>we-4){const xe=Math.max(k-4,0);x.scrollTop=xe}}},[e]),P=u.useCallback(()=>{},[me]),O=u.useCallback(r=>{const o=r.trim();return o===""?(v.current?e&&n(""):g(e??""),!0):I(o)?(o!==e&&n(o),!0):(g(e??""),!1)},[I,n,e]),pe=u.useCallback(r=>{if(S.current&&r===""){S.current=!1;return}!v.current&&r!==""&&(v.current=!0),!(r===""&&!v.current)&&(g(r===""?"":r),r!==""&&C(!0))},[]),ge=u.useCallback(r=>{const o=r.relatedTarget,h=W(),x=T.current;if(T.current=!1,!x&&(q.current||(o&&h?h.contains(o):!1))){q.current=!1,s?.(r);return}if(q.current=!1,!v.current&&(i===""||i===$.current)){g(e??""),s?.(r);return}O(i),C(!0),s?.(r)},[O,i,s,e]),X=u.useCallback((r,o)=>{const h=V;let w=(k=>k&&I(k)?h.indexOf(k):-1)(r);if(w===-1){const k=_e(i);w=k?h.indexOf(k):-1}if(w===-1){const k=i||e||"",N=h.indexOf(k);w=N>=0?N:0}return h[(w+o+h.length)%h.length]},[V,I,i,e]),J=u.useCallback((r,o)=>{const h=X(r,o);v.current=!0,S.current=!0,g(h)},[X]),Te=u.useCallback(r=>{const o=r.key;if(o==="ArrowDown"||o==="ArrowUp"){r.preventDefault(),r.stopPropagation(),J(i||e,o==="ArrowDown"?1:-1);return}if(o==="Enter"){S.current=!0,!O(i??"")&&e&&g(e),C(!0);return}if(o==="Tab"){T.current=!0,S.current=!0,!O(i??"")&&e&&g(e),C(!0);return}},[O,i,J,e]),he=u.useCallback(r=>{const o=r.nativeEvent,h="data"in o?o.data:null;F(h)||r.preventDefault()},[F]),De=u.useCallback(r=>{const o=r.clipboardData.getData("text");F(o)||r.preventDefault()},[F]),ye=u.useCallback(r=>{const o=r.target,h=o.tagName==="INPUT",x=o.getAttribute("role")==="option"||!!o.closest("[role='option']"),w=!!o.closest("[role='listbox']");(x||w)&&(q.current=!0),w&&(b.current=!0),h||x||w||(f.current?.focus(),r.preventDefault(),S.current=!0)},[]),be=u.useCallback(()=>{b.current=!1,v.current=!1,$.current=e,C(!1),S.current=!0,q.current=!1,T.current=!1,P()},[P,e]);u.useEffect(()=>g(e??""),[e]),u.useEffect(()=>{const r=f.current;if(!r)return;const o=new MutationObserver(()=>{r.getAttribute("aria-expanded")==="true"&&P()});return o.observe(r,{attributes:!0,attributeFilter:["aria-expanded"]}),()=>o.disconnect()},[P]);const ke=u.useMemo(()=>{const r=i&&I(i)&&M.includes(i)?i:e&&I(e)&&M.includes(e)?e:void 0;return r?[r]:[]},[i,e,I,M]),ve=`${p??"w-[7rem]"} focus-within:outline-none focus-visible:outline-none focus-within:ring-0 focus-visible:ring-0`;return y.jsx(Oe,{ref:f,label:t,hideLabel:d,disabled:l,error:c,className:ve,options:M,filteredOptions:M,allowNewValues:!0,toggleListButton:!0,isListOpen:E?!1:void 0,value:i,inputClassName:"min-w-0",shouldShowSelectedOptions:!1,selectedOptions:ke,onMouseDownCapture:ye,onFocus:be,onToggleSelected:(r,o)=>{o&&(S.current=!0,q.current=!1,g(r),$.current=r,v.current=!1,n(r),C(!0))},onChange:pe,onBlur:ge,onKeyDownCapture:Te,onBeforeInput:he,onPaste:De})}ue.__docgenInfo={description:"",methods:[],displayName:"TimeInput",props:{value:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"ReactFocusEventHandler",raw:"React.FocusEventHandler<HTMLInputElement>",elements:[{name:"HTMLInputElement"}]},description:""},label:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Klokkeslett'",computed:!1}},hideLabel:{required:!1,tsType:{name:"boolean"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:""},error:{required:!1,tsType:{name:"union",raw:"ReactNode | boolean",elements:[{name:"ReactNode"},{name:"boolean"}]},description:""},className:{required:!1,tsType:{name:"string"},description:""},options:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},maxTime:{required:!1,tsType:{name:"string"},description:""}}};function le(e,n,s,t=15){return u.useMemo(()=>{if(!e||!n||!G(s)||!B(e,n))return j;const d=R(n,s);if(!d)return j;const l=Ve(d,t);if(!B(d,l))return t>0?[]:j;const c=l.getTime(),p=t>0;return j.filter(m=>{const f=R(e,m);return f?p?f.getTime()>=c:f.getTime()<=c:!1})},[e,n,s,t])}function ce(e,n){const s=u.useRef(null);return u.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]),{scheduleSave:u.useCallback(()=>{s.current&&clearTimeout(s.current),s.current=window.setTimeout(()=>{s.current=null,e(n)},0)},[e,n])}}function de({label:e,value:n,onChange:s,onBlur:t,error:d,from:l=new Date,to:c=new Date("2040-12-31"),disabled:p}){const{inputProps:a,datepickerProps:m,selectedDay:f,setSelected:b}=Ne({defaultSelected:n??void 0,fromDate:l,toDate:c,onDateChange:i=>s(i??null)}),T=u.useCallback(i=>!i||/^[\d./-]*$/.test(i),[]);u.useEffect(()=>{const i=n??void 0,g=f??void 0;(i&&(!g||g.getTime()!==i.getTime())||!i&&g)&&b(i)},[n,f,b]);const D=i=>{a.onBlur?.(i),t?.()};return y.jsx(Z,{mode:"single",...m,children:y.jsx(Z.Input,{...a,hideLabel:!0,label:e,error:d?d.message||!0:void 0,disabled:p,onBlur:D,onBeforeInput:i=>{const g=i.nativeEvent,E="data"in g?g.data:null;if(!T(E)){i.preventDefault();return}a.onBeforeInput?.(i)},onPaste:i=>{const g=i.clipboardData.getData("text");if(!T(g)){i.preventDefault();return}a.onPaste?.(i)},placeholder:"dd.mm.책책책책"})})}de.__docgenInfo={description:"",methods:[],displayName:"ControlledDatePicker",props:{label:{required:!0,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"union",raw:"Date | null",elements:[{name:"Date"},{name:"null"}]},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(d: Date | null) => void",signature:{arguments:[{type:{name:"union",raw:"Date | null",elements:[{name:"Date"},{name:"null"}]},name:"d"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},error:{required:!1,tsType:{name:"FieldError"},description:""},from:{required:!1,tsType:{name:"Date"},description:"",defaultValue:{value:"new Date()",computed:!1}},to:{required:!1,tsType:{name:"Date"},description:"",defaultValue:{value:"new Date('2040-12-31')",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:""}}};function L({label:e,nameDato:n,nameTid:s,control:t,disabledDato:d,disabledTid:l,hideDato:c,dateFrom:p,dateTo:a,timeOptions:m,onDatoBlur:f,onTidBlur:b,timeMax:T}){return y.jsxs("div",{className:"flex gap-4 items-start",children:[e&&y.jsx("div",{className:"flex items-center min-w-fit mt-3",children:y.jsx(ne,{size:"small",children:e})}),!c&&y.jsx(_,{name:n,control:t,rules:{required:"Dato er obligatorisk"},render:({field:D,fieldState:i})=>y.jsx(de,{label:e??"",value:D.value,onChange:g=>D.onChange(g),onBlur:()=>{D.onBlur(),f?.()},error:i.error,disabled:d,from:p,to:a})}),c&&y.jsx(_,{name:n,control:t,render:({field:D})=>y.jsx("input",{type:"hidden",value:D.value?.toISOString()||"",onChange:()=>{}})}),y.jsx(_,{name:s,control:t,rules:{required:"Tid er obligatorisk"},render:({field:D,fieldState:i})=>y.jsx(ue,{value:D.value??"",onChange:D.onChange,label:"Klokkeslett",hideLabel:!0,error:i.error?.message,disabled:l,onBlur:()=>{D.onBlur(),b?.()},className:"w-24",options:m??j,maxTime:T})})]})}L.__docgenInfo={description:"",methods:[],displayName:"DatoTidRad",props:{label:{required:!1,tsType:{name:"string"},description:""},nameDato:{required:!0,tsType:{name:"Path",elements:[{name:"T"}],raw:"Path<T>"},description:""},nameTid:{required:!0,tsType:{name:"Path",elements:[{name:"T"}],raw:"Path<T>"},description:""},control:{required:!0,tsType:{name:"any"},description:""},disabledDato:{required:!1,tsType:{name:"boolean"},description:""},disabledTid:{required:!1,tsType:{name:"boolean"},description:""},hideDato:{required:!1,tsType:{name:"boolean"},description:""},dateFrom:{required:!1,tsType:{name:"Date"},description:""},dateTo:{required:!1,tsType:{name:"Date"},description:""},timeOptions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onDatoBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onTidBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},timeMax:{required:!1,tsType:{name:"string"},description:""}}};const Ke=e=>e?ie(e):null,ze=e=>e?ae(ie(e),"HH:mm"):"",Ue=({control:e})=>{const{autosave:n}=oe(),{setValue:s}=H(),[t,d]=z({control:e,name:["svarfristDato","svarfristTid"]}),[l,c]=z({control:e,name:["fraDato","fraTid"]}),{treff:p}=Ie(),{scheduleSave:a}=ce(n,["fraDato","fraTid","tilDato","tilTid","svarfristDato","svarfristTid"]),m=le(t,l,c,0);return u.useEffect(()=>{p&&(!t&&p.svarfrist&&s("svarfristDato",Ke(p.svarfrist),{shouldValidate:!1,shouldDirty:!1}),!d&&p.svarfrist&&s("svarfristTid",ze(p.svarfrist),{shouldValidate:!1,shouldDirty:!1}))},[p,t,d,s]),u.useEffect(()=>{if(!l||!G(c))return;const f=R(l,c),b=R(t??null,d??null);!f||!b||b.getTime()>f.getTime()&&(s("svarfristDato",new Date(l),{shouldDirty:!0,shouldValidate:!1}),s("svarfristTid",c,{shouldDirty:!0,shouldValidate:!1}),a())},[l,c,t,d,s,a]),y.jsxs("div",{className:"space-y-4",children:[y.jsx(se,{level:"3",size:"small",children:"Svarfrist"}),y.jsx("div",{children:y.jsx(L,{nameDato:"svarfristDato",nameTid:"svarfristTid",control:e,dateTo:l??void 0,timeOptions:m,onDatoBlur:a,onTidBlur:a})})]})};Ue.__docgenInfo={description:"",methods:[],displayName:"SvarfristForm",props:{control:{required:!0,tsType:{name:"any"},description:""}}};function Ge(e,n,s=1){return{adjustEndTime:u.useCallback((d,l,c,p,a,m)=>{if(!d||!G(l))return!1;const f=R(d,l);if(!f)return!1;const T=R(c??d,p),D=s>0;if(T?D?T.getTime()>f.getTime():T.getTime()<f.getTime():!1)return!1;const g=Fe(f,s),E=Y(g),C=ae(g,"HH:mm");let v=!1;return(!c||Y(c).getTime()!==E.getTime())&&(e(a,E,{shouldDirty:!0,shouldValidate:!1}),v=!0),p!==C&&(e(m,C,{shouldDirty:!0,shouldValidate:!1}),v=!0),v&&n(),v},[e,n,s])}}const We=(e,n,s,t)=>{if(!e||!s)return"";const d=(p,a)=>{const[m,f]=a.split(":").map(Number),b=new Date(p);return b.setHours(m,f,0,0),b},l=d(e,n),c=d(s,t);if(B(l,c)){const p=Le(c,l);if(p===0)return"0 minutt";const a=Math.abs(p),m=Math.floor(a/60),f=a%60,b=p<0?"-":"",T=[];return m>0&&T.push(`${m} time${m>1?"r":""}`),f>0&&T.push(`${f} minutt`),`${b}${T.join(" ")}`}else{const p=Ee(c,l),a=p>=0?p+1:p;return`${a} dag${Math.abs(a)!==1?"er":""}`}},Xe=({control:e})=>{const{setValue:n}=H(),{autosave:s}=oe(),[t,d,l,c]=z({control:e,name:["fraDato","fraTid","tilDato","tilTid"]}),[p,a]=u.useState(t&&l?!B(t,l):!1),{scheduleSave:m}=ce(s,["fraDato","fraTid","tilDato","tilTid","svarfristDato","svarfristTid"]),{adjustEndTime:f}=Ge(n,m,1),b=le(l??t,t,d,1);u.useEffect(()=>{const D=t&&l?!B(t,l):!1;a(i=>i===D?i:D)},[t,l]),u.useEffect(()=>{f(t,d,l,c,"tilDato","tilTid")},[t,d,l,c,f]);const T=u.useMemo(()=>!t||!d||!c?"":We(t,d,l??t,c),[t,d,l,c]);return y.jsxs("div",{className:"space-y-4",children:[y.jsx("div",{className:"flex justify-between items-center",children:y.jsx(se,{level:"3",size:"small",children:"Tid"})}),y.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[y.jsx(L,{nameDato:"fraDato",nameTid:"fraTid",control:e,onDatoBlur:m,onTidBlur:m,timeMax:"22:59"}),y.jsx(L,{label:"Til",nameDato:"tilDato",nameTid:"tilTid",control:e,hideDato:!p,dateFrom:t??void 0,timeOptions:b,onDatoBlur:m,onTidBlur:m}),y.jsx(ne,{size:"small",className:"mt-3",children:T||"Velg tid"})]})]})};Xe.__docgenInfo={description:"",methods:[],displayName:"TidspunktForm",props:{control:{required:!0,tsType:{name:"any"},description:""}}};export{Ue as S,Xe as T,oe as u};
