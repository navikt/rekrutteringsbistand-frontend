import{r as j,j as e,L as U,B as G,n as z,ak as R,F as M,f as B,h as q,u as J,e as A,A as b,x as Y,w as Z}from"./iframe-Dbv-ZY6m.js";import{u as Q,a as W,D as N}from"./useDatepicker-DZNBOWwC.js";import"./Date.Input-BAQUwUKS.js";import{R as X,a as ee}from"./Radio-C0KXqxEm.js";import{a as f}from"./parse-CoDqBx_5.js";import{f as H}from"./format-Bjj9PWS-.js";import{u as te,A as E}from"./useForespurteOmDelingAvCv-Rzwjq_wp.js";import{u as se}from"./KandidatlisteContext-BfPHHPX5.js";import{a as u}from"./KandidatHendelseTag-BtPcl_FJ.js";import{U as T}from"./umamiEvents-D8PysN3T.js";import{S as re}from"./Tasklist-Bak44ZG3.js";import{M as C}from"./Modal-DWr6i92s.js";import{T as p}from"./Table-CbnQPkpB.js";var ne=(function(t){return t.ToDager="TO_DAGER",t.TreDager="TRE_DAGER",t.SyvDager="SYV_DAGER",t.Egenvalgt="EGENVALGT",t})({});const ae={TO_DAGER:"2 dager",TRE_DAGER:"3 dager",SYV_DAGER:"7 dager",EGENVALGT:"Egenvalgt"},I=({tittel:t,setValgtSvarfrist:n})=>{const[s,l]=j.useState(void 0),[o,m]=j.useState(null),{datepickerProps:g,inputProps:a}=Q({fromDate:f(new Date,2),toDate:W(new Date,1),onDateChange:d=>l(d),defaultSelected:s,inputFormat:"dd.MM.yyyy",allowTwoDigitYear:!1});return j.useEffect(()=>{s&&n(s)},[s,n]),e.jsxs("div",{className:"my-4",children:[e.jsx(X,{legend:e.jsxs(e.Fragment,{children:[e.jsx(U,{as:"span",children:t||"Frist for svar"}),e.jsx(G,{as:"span",children:" (må fylles ut)"})]}),description:"Kandidatene kan ikke svare etter denne fristen",defaultValue:null,children:Object.values(ne).map(d=>e.jsx(ee,{name:"svarfrist",value:d,onChange:D=>{const v=D.target.value;m(v),l(v==="EGENVALGT"?void 0:le(v))},children:e.jsx("span",{id:`svarfrist-label_${d}`,children:`${ae[d]} ${ie(d)}`})},d))}),e.jsx(N,{...g,children:e.jsx(N.Input,{...a,label:"Velg frist for svar (frist ut valgt dato)",placeholder:"dd.mm.yyyy",disabled:o!=="EGENVALGT"})})]})},ie=t=>{let n=new Date;if(t==="TO_DAGER")n=f(n,2);else if(t==="TRE_DAGER")n=f(n,3);else if(t==="SYV_DAGER")n=f(n,7);else return"";return`(frist ut ${H(n,"EEEE d. MMMM",{locale:z})})`},le=t=>{switch(t){case"TO_DAGER":return f(new Date,2);case"TRE_DAGER":return f(new Date,3);case"SYV_DAGER":return f(new Date,7)}};I.__docgenInfo={description:"",methods:[],displayName:"VelgSvarfrist",props:{tittel:{required:!1,tsType:{name:"string"},description:""},setValgtSvarfrist:{required:!0,tsType:{name:"signature",type:"function",raw:"(dato?: Date) => void",signature:{arguments:[{type:{name:"Date"},name:"dato"}],return:{name:"void"}}},description:""}}};const oe=async t=>R(`${M.internUrl}/foresporsler`,t),de=async(t,n)=>R(`${M.internUrl}/foresporsler/kandidat/${t}`,n),ce=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;return!s||s.length===0?!1:!!s.some(l=>l.type===u.Deling_av_CV_JA)}),pe=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;if(!s||s.length===0)return!1;const l=s.filter(a=>a.type===u.Deling_av_CV_NEI);if(l.length===0)return!1;const o=l[0],m=new Date(o.dato||"");return!s.some(a=>a.type===u.Spurt_om_å_dele_CV||a.type===u.Deling_av_CV_JA||a.type===u.Spurt_om_å_dele_CV_IKKE_DIGITAL?new Date(a.dato||"")>m:!1)}),me=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;if(!s||s.length===0)return!1;const l=s?.filter(a=>a.type===u.Frist_for_deling_av_cv_utløpt);if(l.length===0)return!1;const o=l[0],m=new Date(o.dato||"");return!s.some(a=>a.type===u.Spurt_om_å_dele_CV||a.type===u.Spurt_om_å_dele_CV_IKKE_DIGITAL?new Date(a.dato||"")>m:!1)}),ue=t=>t.filter(n=>{const s=n.kandidatHendelser.cvHendelser;return!s||s.length===0?!1:s.some(o=>{if(o.type===u.Spurt_om_å_dele_CV||o.type===u.Spurt_om_å_dele_CV_IKKE_DIGITAL){const m=o.raw&&"svarfrist"in o.raw?new Date(o.raw.svarfrist||""):null;return m&&m>new Date}return!1})}),ge=({markerteKandidater:t,fjernAllMarkering:n,sidebar:s})=>{const{track:l}=B(),{stillingsId:o}=q(),[m,g]=j.useState(!1),[a,d]=j.useState(void 0),{valgtNavKontor:D,visVarsel:v}=J(),{reFetchKandidatliste:K}=se(),[F,w]=j.useState(!1),$=te(o),h=pe(t),k=me(t),y=ue(t),_=ce(t),S=[...h,...k].filter(i=>!_.some(r=>r.aktørid===i.aktørid)),x=t.filter(i=>!_.some(r=>r.aktørid===i.aktørid)&&!h.some(r=>r.aktørid===i.aktørid)&&!k.some(r=>r.aktørid===i.aktørid)&&!y.some(r=>r.aktørid===i.aktørid)),L=async()=>{const i=x.map(c=>c.aktørid).filter(c=>c!==null),r=S.filter(c=>c.aktørid);if(a){w(!0);try{if(i.length>0&&(await oe({stillingsId:o,svarfrist:H(a,"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),aktorIder:i,navKontor:D?.navKontor??""}),l(T.Stilling.del_stilling_med_kandidat,{antall:i.length})),r.length>0){const c=r.map(V=>de(V.aktørid,{stillingsId:o,svarfrist:H(a,"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"),navKontor:D?.navKontor??""}));l(T.Stilling.del_stilling_med_kandidat_påNytt,{antall:r.length}),await Promise.all(c)}v({tekst:"Stillingen er delt med kandidatene",type:"info"})}catch(c){new Z({message:"Feil ved deling av CV for kandidater",error:c}),v({tekst:"Det oppstod en feil ved deling av stilling til alle markerte kandidater",type:"error"})}finally{n(),g(!1),w(!1),setTimeout(()=>{$.mutate(),K()},5e3)}}},P=i=>{if(i===null)return"Kan ikke spørre";switch(!0){case _.some(r=>r.aktørid===i):return"Har allerede svart ja";case y.some(r=>r.aktørid===i):return"Venter på svar";case h.some(r=>r.aktørid===i):return"Har tidligere svart nei";case k.some(r=>r.aktørid===i):return"Frist utløpt";default:return"Ikke spurt"}};return e.jsxs(e.Fragment,{children:[e.jsx(A,{disabled:t.length===0,onClick:()=>g(!0),variant:s?"primary":"tertiary",icon:e.jsx(re,{title:"Del med jobbsøker"}),children:"Spør om å dele CV"}),e.jsxs(C,{open:m,"aria-label":"Del stillingen med de markerte jobbsøkere",onClose:()=>g(!1),header:{heading:`Del med ${t.length} ${t.length===1?"jobbsøker ":"jobbsøkere"} i aktivitetsplanen`},children:[e.jsxs(C.Body,{children:[y.length>0&&e.jsxs(b,{variant:"info",size:"small",className:"mb-1",children:[y.length," ",y.length===1?"jobbsøker ":"jobbsøkere","har ikke svart på forespørselen."]}),h.length>0&&e.jsxs(b,{variant:"error",size:"small",className:"mb-1",children:[h.length," ",h.length===1?"jobbsøker ":"jobbsøkere","har tidliger svart nei til å dele CV-en."]}),k.length>0&&e.jsxs(b,{variant:"warning",size:"small",className:"mb-1",children:[k.length," ",k.length===1?"jobbsøker ":"jobbsøkere","har tidligere fått spørsmål, men ikke svart innen fristen."]}),_.length>0&&e.jsxs(b,{variant:"success",size:"small",className:"mb-1",children:[_.length," ",_.length===1?"jobbsøker ":"jobbsøkere","har allerede svart ja."]}),e.jsx(E,{size:"small",headingSize:"xsmall",className:"my-4",children:e.jsxs(E.Item,{children:[e.jsx(E.Header,{children:"Vis jobbsøkere"}),e.jsx(E.Content,{children:e.jsxs(p,{size:"small",children:[e.jsx(p.Header,{children:e.jsxs(p.Row,{children:[e.jsx(p.HeaderCell,{scope:"col",children:"Navn"}),e.jsx(p.HeaderCell,{scope:"col",children:"Fødselsnr."}),e.jsx(p.HeaderCell,{scope:"col",children:"Status"})]})}),e.jsx(p.Body,{children:t?.map(({fornavn:i,etternavn:r,fodselsnr:c,aktørid:V},O)=>e.jsxs(p.Row,{children:[e.jsxs(p.HeaderCell,{scope:"row",children:[i," ",r]}),e.jsx(p.DataCell,{children:c}),e.jsx(p.DataCell,{children:P(V)})]},O))})]})})]})}),e.jsx(G,{className:"my-8",children:e.jsxs(e.Fragment,{children:[x.length>0&&`Deler for første gang stillingen med ${x.length} ${x.length===1?"jobbsøker":"jobbsøkere"}.`,S.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),`Spør om deling på nytt for ${S.length} ${S.length===1?"jobbsøker":"jobbsøkere"}.`]})]})}),e.jsx(Y,{className:"my-8",children:`Det opprettes et stillingskort i Aktivitetsplanen. Jobbsøkere
                  vil bli varslet på SMS, og kan svare "ja" eller "nei" til at
                  CV-en skal bli delt med arbeidsgiver. Du vil se svaret i
                  kandidatlisten.`}),e.jsx(I,{setValgtSvarfrist:d}),e.jsxs(b,{variant:"info",className:"mt-8",children:["Stillingsoppdraget vil bli delt med jobbsøker.",e.jsx("br",{})," Det er viktig at annonseteksten er informativ og lett å forstå."]})]}),e.jsxs(C.Footer,{children:[e.jsx(A,{disabled:!a||t.length===0,onClick:L,variant:"primary",loading:F,children:"Del stilling"}),e.jsx(A,{disabled:F,variant:"secondary",onClick:()=>g(!1),children:"Avbryt"})]})]})]})};ge.__docgenInfo={description:"",methods:[],displayName:"DelMedKandidatModal",props:{markerteKandidater:{required:!0,tsType:{name:"Array",elements:[{name:"KandidatVisningProps"}],raw:"KandidatVisningProps[]"},description:""},fjernAllMarkering:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},sidebar:{required:!1,tsType:{name:"boolean"},description:""}}};export{ge as D,I as V};
