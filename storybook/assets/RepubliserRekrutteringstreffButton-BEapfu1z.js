import{r as d,j as e,d as j,x as _,bh as $,i as Q,b5 as X,b3 as Y,bi as Z,bj as ee,bk as te,B as y,L as N,bl as se}from"./iframe-BCPU83ju.js";import{M as b}from"./Modal-BBM7lRpi.js";import{M as re}from"./MeldingsmalVisning-01YvlxKx.js";import{t as B,f as h}from"./utils-DS1xyHGs.js";import{V as R,H as ne}from"./VStack-BIz_V_1H.js";import{S as le}from"./Bell-DN0MtTU7.js";import{B as O}from"./Box-8WIwS4-z.js";import{S as ae}from"./Switch-D_QyFY91.js";const ie=({rekrutteringstreffId:s,oppdaterData:r})=>{const[a,i]=d.useState(!1),l=d.useRef(null),n=()=>l.current?.showModal(),o=()=>{a||l.current?.close()},k=async()=>{if(a)return;i(!0);let m=!1;try{await $(s),r(),m=!0}catch(g){new Q({message:"Gjenåpning av rekrutteringstreff feilet",error:g})}finally{i(!1),m&&l.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",size:"small",variant:"primary",loading:a,onClick:n,children:"Gjenåpne"}),e.jsxs(b,{ref:l,onClose:()=>{a&&l.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(b.Body,{children:e.jsx(_,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(b.Footer,{children:[e.jsx(j,{type:"button",size:"small",loading:a,onClick:()=>void k(),children:"Gjenåpne"}),e.jsx(j,{type:"button",size:"small",variant:"secondary",disabled:a,onClick:o,children:"Avbryt"})]})]})]})};ie.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const oe=(s,r,a)=>{const i=[],l=B(s.fraDato,s.fraTid?.trim()||"00:00")??r?.fraTid,n=B(s.tilDato??s.fraDato,s.tilTid?.trim()||"00:00")??r?.tilTid,o=B(s.svarfristDato,s.svarfristTid?.trim()||"00:00")??r?.svarfrist,k=s.tittel?.trim()||r?.tittel||"";r?.tittel!==k&&i.push({felt:"navn",label:"Nytt navn",gammelVerdi:r?.tittel||"",nyVerdi:k,skalVarsle:!1});const m=[r?.gateadresse,r?.postnummer,r?.poststed].filter(Boolean).join(", "),g=[s.gateadresse??r?.gateadresse,s.postnummer??r?.postnummer,s.poststed??r?.poststed].filter(Boolean).join(", ");m!==g&&i.push({felt:"sted",label:"Nytt sted",gammelVerdi:m,nyVerdi:g,skalVarsle:!1});const u=[h(r?.fraTid),h(r?.tilTid)].filter(Boolean).join(" - "),v=[h(l),h(n)].filter(Boolean).join(" - ");u!==v&&i.push({felt:"tidspunkt",label:"Nytt tidspunkt",gammelVerdi:u,nyVerdi:v,skalVarsle:!1});const c=h(r?.svarfrist),x=h(o);return c!==x&&i.push({felt:"svarfrist",label:"Ny svarfrist",gammelVerdi:c,nyVerdi:x,skalVarsle:!1}),(a||"")!==(s.htmlContent||"")&&i.push({felt:"introduksjon",label:"Ny introduksjon",gammelVerdi:a?"Innhold endret":"",nyVerdi:s.htmlContent?"Innhold endret":"",skalVarsle:!1}),i},G=(s,r,a=!1)=>{const i=r.filter(o=>o.skalVarsle);if(i.length===0)return s;const l=i.map(o=>se[o.felt]);let n;return a?n=l.map(o=>`<p>${o}</p>`).join(""):n=l.join(`
`),s.replace("{{ENDRINGER}}",n)},de=({treff:s,innleggHtmlFraBackend:r})=>{const a=d.useRef(null),{getValues:i,watch:l,formState:n,setValue:o}=X(),{rekrutteringstreffId:k}=Y(),{data:m}=Z(),{data:g}=ee(k),[u,v]=d.useState([]),[c,x]=d.useState([]),[E,w]=d.useState(!1),V=d.useMemo(()=>g?.some(t=>t.hendelser.some(f=>f.hendelsestype===te.INVITERT)),[g]),M=d.useCallback(()=>{a.current?.close()},[]);d.useEffect(()=>{const t=()=>{const T=i(),I=oe(T,s,r||"");v(I)};t();const f=l(()=>{t()});return()=>f.unsubscribe()},[s,l,i,r]),d.useEffect(()=>{let t=null;return E&&!n.isSubmitting?((!n.errors||Object.keys(n.errors).length===0)&&M(),t=setTimeout(()=>{w(!1)},0)):n.isSubmitting&&!E&&(t=setTimeout(()=>{w(!0)},0)),()=>{t!==null&&clearTimeout(t)}},[n.isSubmitting,n.errors,E,M]);const z=l("tittelKiSjekket")??!1,C=l("htmlContentKiSjekket")??!1,A=l("tittelKiFeil")??!1,q=l("htmlContentKiFeil")??!1,U=A||q,J=!!(n.errors&&Object.keys(n.errors).some(t=>t!=="root")),F=U||J,K=s?.tittel?.trim()==="Treff uten navn",D=u.some(t=>t.felt==="navn"),L=u.some(t=>t.felt==="introduksjon"),S=d.useMemo(()=>u.length===0||F||!((!D||z)&&(!L||C))||K,[u.length,F,D,L,z,C,K]),P=d.useCallback(t=>{x(f=>{const T=f.map(p=>p.felt===t?{...p,skalVarsle:!p.skalVarsle}:p),I=Object.fromEntries(T.map(p=>[p.felt,p.skalVarsle]));return o("endringerSkalVarsle",I),T})},[o]),H=d.useMemo(()=>c.some(t=>t.skalVarsle),[c]),W=d.useCallback(()=>{if(!S){x([...u]);const t=Object.fromEntries(u.map(f=>[f.felt,!1]));o("endringerSkalVarsle",t),a.current?.showModal()}},[u,S,o]);return e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",variant:"primary",size:"small",disabled:S,onClick:W,children:"Publiser på nytt"}),e.jsxs(b,{ref:a,width:720,header:{heading:"Lagre endringer"},children:[e.jsx(b.Body,{children:e.jsxs(R,{gap:"6",children:[V&&e.jsxs(ne,{gap:"2",align:"center",children:[e.jsx(le,{"aria-hidden":!0,fontSize:"1.25rem"}),e.jsx(y,{children:"Du har gjort endringer du kan varsle om:"})]}),c.length===0?e.jsx(_,{children:"Ingen endringer oppdaget."}):e.jsxs(e.Fragment,{children:[V&&e.jsxs("div",{children:[e.jsx(N,{size:"small",children:"Velg hva du vil ha med i varslet"}),e.jsx(y,{size:"small",className:"text-text-subtle mt-1 mb-2",children:"Inviterte jobbsøkere som ikke har takket nei får melding på SMS eller epost."})]}),e.jsx(R,{gap:"3",children:c.map(t=>e.jsx(O.New,{background:t.skalVarsle?"info-soft":"neutral-softA",padding:"3",borderRadius:"large",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs(R,{gap:"1",children:[e.jsx(N,{size:"small",children:t.label}),e.jsxs(y,{size:"small",className:"text-text-subtle",children:["Før: ",t.gammelVerdi||"—"]}),e.jsxs(y,{size:"small",className:"text-text-subtle",children:["Nå: ",t.nyVerdi||"—"]})]}),V&&e.jsxs(ae,{size:"small",hideLabel:!0,checked:t.skalVarsle,onChange:()=>P(t.felt),children:["Varsle om ",t.label.toLowerCase()]})]})},t.felt))})]}),m&&V&&e.jsx(O.New,{background:"neutral-softA",padding:"4",borderRadius:"xlarge",children:e.jsxs(R,{gap:"2",children:[e.jsx(N,{size:"small",children:"Meldingen"}),H?e.jsx(re,{tittel:"",smsTekst:G(m.kandidatInvitertTreffEndret.smsTekst,c,!1),epostTittel:m.kandidatInvitertTreffEndret.epostTittel,epostHtmlBody:G(m.kandidatInvitertTreffEndret.epostHtmlBody,c,!0)}):e.jsx(y,{size:"small",className:"text-text-subtle",children:"Ingen varsel sendes ut. Hvis du vil sende melding til jobbsøkerne, velg endringene du vil varsle om over."})]})})]})}),e.jsxs(b.Footer,{children:[e.jsx(j,{type:"button",variant:"secondary",size:"small",onClick:M,disabled:n.isSubmitting,children:"Avbryt"}),e.jsx(j,{type:"submit",form:"rekrutteringstreff-form",variant:"primary",size:"small",disabled:S,loading:n.isSubmitting,children:H?"Lagre og varsle":"Lagre uten å varsle"})]})]})]})};de.__docgenInfo={description:`Komponent for å republisere et rekrutteringstreff.
Viser en knapp som åpner en modal for bekreftelse av endringer før republisering.`,methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{treff:{required:!0,tsType:{name:"union",raw:"RekrutteringstreffUtenHendelserDTO | null",elements:[{name:"z.infer",elements:[{name:"RekrutteringstreffUtenHendelserSchema"}],raw:`z.infer<
  typeof RekrutteringstreffUtenHendelserSchema
>`},{name:"null"}]},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{ie as G,de as R};
