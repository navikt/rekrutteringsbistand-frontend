import{e as P,a as U}from"./useAutosave-DpDfb8A_.js";import{bg as q,bW as z,b$ as B,r as s,h as R}from"./iframe-BBDbIFjR.js";const K=n=>n==null?"":String(n).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function Y(n){const{feltType:V,fieldName:y,watchedValue:L,triggerRHF:p,getValues:v,setValue:r,setKiFeilFieldName:w,saveCallback:g,setKiLagret:a,requireHasCheckedToShow:D,setKiSjekketFieldName:t,savedValue:k}=n,{rekrutteringstreffId:E}=q(),{data:x}=z(E),o=P(x)&&U(),{trigger:S,data:e,reset:F,error:u,isMutating:H}=B(E),[d,j]=s.useState(null),[i,c]=s.useState(!1),[C,b]=s.useState(!1);s.useEffect(()=>{b(!1),c(!1),j(null),F(),t&&r(t,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[L,F,t,r]);const M=!!e&&!u&&e?.bryterRetningslinjer&&!i;s.useEffect(()=>{const h=!!e&&!u&&!!e?.bryterRetningslinjer&&!i;r(w,h,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[e,u,i,w,r]);const N=s.useCallback(async()=>{if(!await p(y))return;const m=v(y),I=(typeof m=="string"?m:String(m??"")).trim(),A=K(I);if(A){if(k!==void 0){const l=K(k);if(A===l)return}try{const l=await S({feltType:V,tekst:I});b(!0),t&&r(t,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const f=l?.loggId??e?.loggId??null;if(j(f),(!(l?.bryterRetningslinjer??e?.bryterRetningslinjer)||i)&&!o&&(await g(!1),f&&a))try{await a({id:f,lagret:!0})}catch(G){new R({message:`Feil ved oppdatering av /lagret for logg ${f}.`,error:G})}}catch(l){new R({message:"Validation failed:",error:l}),b(!0),t&&r(t,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[p,y,v,S,V,i,o,g,a,e,t,r,k]),$=s.useCallback(async()=>{if(o){c(!0);return}if(c(!0),await g(!0),d&&a)try{await a({id:d,lagret:!0})}catch(h){new R({message:`Feil ved oppdatering av /lagret for logg ${d}.`,error:h})}},[o,g,d,a]),T=!!e&&!u&&!!e?.bryterRetningslinjer;return{analyse:e,analyseError:u,validating:H,kiErrorBorder:M,forceSave:i,setForceSave:c,loggId:d,hasChecked:C,showAnalysis:D?C&&T:T,erRedigeringAvPublisertTreff:o,runValidationAndMaybeSave:N,onForceSave:$}}export{Y as u};
