import{y as I,au as F,k as G,av as $,ao as q,aw as T,R as L,ax as r,o as W,W as c,u as Y,e as Q,f as X,r as j,h as K,j as e,d as f,A as w,B as v,L as D}from"./iframe-DYYFo0EH.js";import{U as Z}from"./umamiEvents-BDpRy9-M.js";import{S as ee}from"./ArrowForward-D4KsBc-F.js";import{M as x}from"./Modal-CNZnnLcK.js";import{A as g}from"./useForespurteOmDelingAvCv-M3wt_4u8.js";import{T as i}from"./Table-JoC5ff2C.js";import{S as se}from"./Select-CkfCexIl.js";const E=s=>{if(s===void 0)throw new L({message:"stillingId === undefined"});return`${T.internUrl}/varsler/stilling/${s}`},ne=`${T.internUrl}/varsler/query`;var o=(function(s){return s.VurdertSomAktuell="VURDERT_SOM_AKTUELL",s.FunnetPassendeStilling="PASSENDE_STILLING",s.Jobbarrangement="PASSENDE_JOBBARRANGEMENT",s})({});const te=r("IKKE_BESTILT").or(r("UNDER_UTSENDING")).or(r("OPPRETTET")).or(r("SLETTET")),ae=r("UNDER_UTSENDING").or(r("VELLYKKET_SMS")).or(r("VELLYKKET_EPOST")).or(r("FERDIGSTILT")).or(r("FEIL")),re=r(null).or(r("SMS")).or(r("EPOST")),le=W({id:c(),opprettet:c(),mottakerFnr:c(),stillingId:c(),avsenderNavident:c(),minsideStatus:te,eksternStatus:ae,eksternFeilmelding:c().nullable(),eksternKanal:re}).partial({eksternFeilmelding:!0}),ie=G(le),de=s=>I(s?E(s):null,async t=>{const m=await F(t),a=ie.parse(m),d={};return a.forEach(l=>{d[l.mottakerFnr]=l}),d},{refreshInterval:2e4}),oe=()=>{const{mutate:s}=$();return async({stillingId:t,mal:m,fnr:a})=>{try{const d=await q(E(t),{mal:m,fnr:a});return await Promise.all([s(E(t)),s(l=>l!==null&&typeof l=="object"&&"url"in l&&l.url===ne)]),d}catch(d){throw d}}},ce="_sendSmsModal_me9a7_1",me="_velgMal_me9a7_5",ue="_kontortidAdvarsel_me9a7_18",b={sendSmsModal:ce,velgMal:me,kontortidAdvarsel:ue},ge=`${T.internUrl}/meldingsmal`,Se=()=>I(ge,F),he=s=>{const{visVarsel:t}=Y(),{fjernAllMarkering:m,markerteKandidater:a}=s,{track:d}=Q(),{stillingsData:l}=X(),S=l?.stillingsinfo?.stillingskategori,R=l.stilling.uuid,[C,u]=j.useState(!1),{data:y={}}=de(S==="FORMIDLING"?null:l.stilling.uuid),P=oe(),[U,A]=j.useState(!1),h=a.filter(n=>n.fodselsnr&&y[n.fodselsnr]),k=a.filter(n=>!(n.fodselsnr&&y[n.fodselsnr])),V=a.some(n=>n.fodselsnr===null),[M,B]=j.useState(S===K.Jobbmesse?o.Jobbarrangement:o.VurdertSomAktuell),{data:_}=Se(),p=a.map(n=>n.fodselsnr),z=async()=>{if(A(!0),p.length===0){t({tekst:"Ingen kandidater valgt",type:"warning"});return}try{await P({mal:M,fnr:p.filter(n=>n!==null),stillingId:R}),d(Z.Stilling.send_beskjed_til_kandidat,{antall:p.length}),t({tekst:"Beskjed er sendt",type:"success"}),m(),u(!1)}catch(n){new L({message:"Klarte ikke å sende SMS:",error:n}),t({tekst:n instanceof Error?`Feil ved sending: ${n.message}`:"Det skjedde en uventet feil ved sending av beskjed",type:"error"})}finally{A(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(f,{disabled:a.length===0,onClick:()=>u(!0),size:s.sidebar?"small":"medium",variant:s.sidebar?"secondary":"tertiary",icon:e.jsx(ee,{title:"Del stilling"}),children:"Del stillingen"}),e.jsxs(x,{open:C,className:b.sendSmsModal,onClose:()=>u(!1),"aria-label":`Del stillingen med ${a.length} kandidater`,header:{heading:"Del stillingen"},children:[e.jsxs(x.Body,{children:[(h.length>0||V)&&e.jsx(w,{variant:"warning",size:"small",className:"my-4",children:"Ikke alle kandidatene vil motta beskjeden"}),e.jsxs("div",{className:"send-sms-modal__innhold",children:[e.jsxs(v,{children:["Det vil bli sendt beskjed til"," ",e.jsx("b",{children:k.length})," ",k.length===1?"kandidat":"kandidater"]}),e.jsx(v,{size:"small",children:"Telefonnummerene/e-postene blir hentet fra Kontakt- og reservasjonsregisteret."}),e.jsx(g,{size:"small",headingSize:"xsmall",className:"my-4",children:e.jsxs(g.Item,{children:[e.jsx(g.Header,{children:"Vis kandidater"}),e.jsx(g.Content,{children:e.jsxs(i,{size:"small",children:[e.jsx(i.Header,{children:e.jsxs(i.Row,{children:[e.jsx(i.HeaderCell,{scope:"col",children:"Navn"}),e.jsx(i.HeaderCell,{scope:"col",children:"Fødselsnr."}),e.jsx(i.HeaderCell,{scope:"col",children:"Kan sende beskjed"})]})}),e.jsx(i.Body,{children:a?.map(({fornavn:n,etternavn:H,fodselsnr:N},J)=>e.jsxs(i.Row,{children:[e.jsxs(i.HeaderCell,{scope:"row",children:[n," ",H]}),e.jsx(i.DataCell,{children:N}),e.jsx(i.DataCell,{children:h.some(O=>O.fodselsnr===N)?"Nei":"Ja"})]},J))})]})})]})}),e.jsx(w,{variant:"info",className:b.kontortidAdvarsel,children:e.jsx(D,{size:"small",children:"SMS sendes ut mellom 09:00 og 17:15 hver dag. Det kan oppstå forsinkelser."})}),S!==K.Jobbmesse&&e.jsxs(se,{className:b.velgMal,label:"Velg hva som skal vises i beskjeden",onChange:n=>{B(n.target.value)},children:[e.jsx("option",{value:o.VurdertSomAktuell,children:"Send stilling til en aktuell kandidat"}),e.jsx("option",{value:o.FunnetPassendeStilling,children:"Oppfordre kandidat til å søke på stilling"})]}),e.jsx(D,{htmlFor:"forhåndsvisning",children:"Meldingen som vil bli sendt til kandidatene"}),e.jsx("div",{id:"forhåndsvisning",className:"p-4",children:e.jsx(v,{children:e.jsxs("span",{children:[_?ke(M,_):"Klarte ikke å hente meldingsmaler"," "]})})})]})]}),e.jsxs(x.Footer,{children:[e.jsx(f,{disabled:h.length===a.length||k.length===0,variant:"primary",loading:U,onClick:z,children:"Send beskjed"}),e.jsx(f,{variant:"secondary",onClick:()=>u(!1),children:"Avbryt"})]})]})]})},ke=(s,t)=>{if(s===o.VurdertSomAktuell)return t.vurdertSomAktuell?.smsTekst;if(s===o.FunnetPassendeStilling)return t.passendeStilling?.smsTekst;if(s===o.Jobbarrangement)return t.passendeJobbarrangement?.smsTekst};he.__docgenInfo={description:"",methods:[],displayName:"SendSmsModal",props:{markerteKandidater:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"kandidaterSchema"}],raw:"z.infer<typeof kandidaterSchema>"}],raw:"KandidatListeKandidatDTO[]"},description:""},fjernAllMarkering:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},sidebar:{required:!1,tsType:{name:"boolean"},description:""}}};export{he as S,de as u};
