import{af as w,d as G,ac as $,ag as T,R as F,ah as a,o as q,I as m,u as W,c as Y,r as f,j as e,b as j,A as I,B as v,t as K}from"./iframe--aQMagBM.js";import{u as L,a as Q}from"./index-DGK8N2bN.js";import{a as X}from"./StillingsContext-DZ7500xJ.js";import{S as D}from"./stilling-typer-DLlwa7NU.js";import{U as Z}from"./umamiEvents-BDpRy9-M.js";import{S as ee}from"./ArrowForward-BXAeWVaL.js";import{M as x}from"./Modal-B9efuJdm.js";import{A as g}from"./useForespurteOmDelingAvCv-DQ69Yz0_.js";import{T as i}from"./Table-QzRVE1eN.js";import{S as se}from"./Select-BiXQKWBX.js";const E=s=>{if(s===void 0)throw new F({message:"stillingId === undefined"});return`${T.internUrl}/varsler/stilling/${s}`},ne=`${T.internUrl}/varsler/query`;var o=(function(s){return s.VurdertSomAktuell="VURDERT_SOM_AKTUELL",s.FunnetPassendeStilling="PASSENDE_STILLING",s.Jobbarrangement="PASSENDE_JOBBARRANGEMENT",s})({});const te=a("IKKE_BESTILT").or(a("UNDER_UTSENDING")).or(a("OPPRETTET")).or(a("SLETTET")),re=a("UNDER_UTSENDING").or(a("VELLYKKET_SMS")).or(a("VELLYKKET_EPOST")).or(a("FERDIGSTILT")).or(a("FEIL")),ae=a(null).or(a("SMS")).or(a("EPOST")),le=q({id:m(),opprettet:m(),mottakerFnr:m(),stillingId:m(),avsenderNavident:m(),minsideStatus:te,eksternStatus:re,eksternFeilmelding:m().nullable(),eksternKanal:ae}).partial({eksternFeilmelding:!0}),ie=G(le),de=s=>L(s?E(s):null,async t=>{const c=await w(t),r=ie.parse(c),d={};return r.forEach(l=>{d[l.mottakerFnr]=l}),d},{refreshInterval:2e4}),oe=()=>{const{mutate:s}=Q();return async({stillingId:t,mal:c,fnr:r})=>{try{const d=await $(E(t),{mal:c,fnr:r});return await Promise.all([s(E(t)),s(l=>l!==null&&typeof l=="object"&&"url"in l&&l.url===ne)]),d}catch(d){throw d}}},me="_sendSmsModal_me9a7_1",ce="_velgMal_me9a7_5",ue="_kontortidAdvarsel_me9a7_18",b={sendSmsModal:me,velgMal:ce,kontortidAdvarsel:ue},ge=`${T.internUrl}/meldingsmal`,Se=()=>L(ge,w),he=s=>{const{visVarsel:t}=W(),{fjernAllMarkering:c,markerteKandidater:r}=s,{track:d}=Y(),{stillingsData:l}=X(),S=l?.stillingsinfo?.stillingskategori,R=l.stilling.uuid,[C,u]=f.useState(!1),{data:y={}}=de(S==="FORMIDLING"?null:l.stilling.uuid),P=oe(),[U,A]=f.useState(!1),h=r.filter(n=>n.fodselsnr&&y[n.fodselsnr]),k=r.filter(n=>!(n.fodselsnr&&y[n.fodselsnr])),V=r.some(n=>n.fodselsnr===null),[M,B]=f.useState(S===D.Jobbmesse?o.Jobbarrangement:o.VurdertSomAktuell),{data:_}=Se(),p=r.map(n=>n.fodselsnr),z=async()=>{if(A(!0),p.length===0){t({tekst:"Ingen kandidater valgt",type:"warning"});return}try{await P({mal:M,fnr:p.filter(n=>n!==null),stillingId:R}),d(Z.Stilling.send_beskjed_til_kandidat,{antall:p.length}),t({tekst:"Beskjed er sendt",type:"success"}),c(),u(!1)}catch(n){new F({message:"Klarte ikke å sende SMS:",error:n}),t({tekst:n instanceof Error?`Feil ved sending: ${n.message}`:"Det skjedde en uventet feil ved sending av beskjed",type:"error"})}finally{A(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(j,{disabled:r.length===0,onClick:()=>u(!0),size:s.sidebar?"small":"medium",variant:s.sidebar?"secondary":"tertiary",icon:e.jsx(ee,{title:"Del stilling"}),children:"Del stillingen"}),e.jsxs(x,{open:C,className:b.sendSmsModal,onClose:()=>u(!1),"aria-label":`Del stillingen med ${r.length} kandidater`,header:{heading:"Del stillingen"},children:[e.jsxs(x.Body,{children:[(h.length>0||V)&&e.jsx(I,{variant:"warning",size:"small",className:"my-4",children:"Ikke alle kandidatene vil motta beskjeden"}),e.jsxs("div",{className:"send-sms-modal__innhold",children:[e.jsxs(v,{children:["Det vil bli sendt beskjed til"," ",e.jsx("b",{children:k.length})," ",k.length===1?"kandidat":"kandidater"]}),e.jsx(v,{size:"small",children:"Telefonnummerene/e-postene blir hentet fra Kontakt- og reservasjonsregisteret."}),e.jsx(g,{size:"small",headingSize:"xsmall",className:"my-4",children:e.jsxs(g.Item,{children:[e.jsx(g.Header,{children:"Vis kandidater"}),e.jsx(g.Content,{children:e.jsxs(i,{size:"small",children:[e.jsx(i.Header,{children:e.jsxs(i.Row,{children:[e.jsx(i.HeaderCell,{scope:"col",children:"Navn"}),e.jsx(i.HeaderCell,{scope:"col",children:"Fødselsnr."}),e.jsx(i.HeaderCell,{scope:"col",children:"Kan sende beskjed"})]})}),e.jsx(i.Body,{children:r?.map(({fornavn:n,etternavn:H,fodselsnr:N},J)=>e.jsxs(i.Row,{children:[e.jsxs(i.HeaderCell,{scope:"row",children:[n," ",H]}),e.jsx(i.DataCell,{children:N}),e.jsx(i.DataCell,{children:h.some(O=>O.fodselsnr===N)?"Nei":"Ja"})]},J))})]})})]})}),e.jsx(I,{variant:"info",className:b.kontortidAdvarsel,children:e.jsx(K,{size:"small",children:"SMS sendes ut mellom 09:00 og 17:15 hver dag. Det kan oppstå forsinkelser."})}),S!==D.Jobbmesse&&e.jsxs(se,{className:b.velgMal,label:"Velg hva som skal vises i beskjeden",onChange:n=>{B(n.target.value)},children:[e.jsx("option",{value:o.VurdertSomAktuell,children:"Send stilling til en aktuell kandidat"}),e.jsx("option",{value:o.FunnetPassendeStilling,children:"Oppfordre kandidat til å søke på stilling"})]}),e.jsx(K,{htmlFor:"forhåndsvisning",children:"Meldingen som vil bli sendt til kandidatene"}),e.jsx("div",{id:"forhåndsvisning",className:"p-4",children:e.jsx(v,{children:e.jsxs("span",{children:[_?ke(M,_):"Klarte ikke å hente meldingsmaler"," "]})})})]})]}),e.jsxs(x.Footer,{children:[e.jsx(j,{disabled:h.length===r.length||k.length===0,variant:"primary",loading:U,onClick:z,children:"Send beskjed"}),e.jsx(j,{variant:"secondary",onClick:()=>u(!1),children:"Avbryt"})]})]})]})},ke=(s,t)=>{if(s===o.VurdertSomAktuell)return t.vurdertSomAktuell?.smsTekst;if(s===o.FunnetPassendeStilling)return t.passendeStilling?.smsTekst;if(s===o.Jobbarrangement)return t.passendeJobbarrangement?.smsTekst};he.__docgenInfo={description:"",methods:[],displayName:"SendSmsModal",props:{markerteKandidater:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"kandidaterSchema"}],raw:"z.infer<typeof kandidaterSchema>"}],raw:"KandidatListeKandidatDTO[]"},description:""},fjernAllMarkering:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},sidebar:{required:!1,tsType:{name:"boolean"},description:""}}};export{he as S,de as u};
