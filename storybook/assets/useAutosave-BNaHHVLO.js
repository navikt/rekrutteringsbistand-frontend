import{t as y,a as N}from"./utils-Bh74qxnP.js";import{o as x,av as M,h5 as P,hB as $,ak as H,T,h2 as w,hC as L,h4 as O,r as C,hA as K,w as V,hD as J,hi as D}from"./iframe-D-AjZlUt.js";import{o as U}from"./mutations-BzufnPmX.js";const E=x({tittel:T().min(1,"Tittel kan ikke være tom"),htmlContent:T().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:T().nullable().optional(),opprettetAvPersonBeskrivelse:T().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:T().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),F=$,X=t=>`${P.internUrl}/${t}/innlegg`,Z=(t,r)=>`${P.internUrl}/${t}/innlegg/${r}`,q=async(t,r)=>{E.parse(r);const s=await H(X(t),r);return F.parse(s)},z=async(t,r,s)=>{E.parse(s);const e=await M(Z(t,r),s);return F.parse(e)},G=()=>{try{return!1}catch{return!1}},B=t=>{const r=J(t?.hendelser);return r===D.INVITERE||r===D.FULLFØRE},R=(t,r)=>r?!1:B(t)&&G(),j=(t,r,s,e)=>t||r&&!e?!1:s;function _(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e,mutate:b}=L(t),{getValues:h,trigger:u,formState:f}=O(),d=C.useCallback((o,m)=>{const n=h(),l=y(n.fraDato??null,n.fraTid)??e?.fraTid??null,a=y(n.tilDato??n.fraDato??null,n.tilTid)??e?.tilTid??null,v=y(n.svarfristDato??null,n.svarfristTid)??e?.svarfrist??null,i=typeof n.tittel=="string"?n.tittel.trim():"",I=!!f?.errors?.tittel,k=!!n.tittelKiFeil,p=!!n?.tittelKiSjekket,g=!!(i.length>0||e?.tittel&&e.tittel.trim().length>0);let c=j(I,k,g,o);return!B(e)&&!o&&(c=c&&p&&!k),{tittel:c&&i.length>0?i:e?.tittel,beskrivelse:n.beskrivelse??e?.beskrivelse??null,fraTid:l,tilTid:a,svarfrist:v,gateadresse:n.gateadresse??e?.gateadresse??null,postnummer:n.postnummer??e?.postnummer??null,poststed:n.poststed??e?.poststed??null}},[h,e,f]);return{save:C.useCallback(async(o,m)=>{if(!t||R(e,m))return;const n=d(m,o),l=new Set(Object.keys(n??{})),a=o&&o.length>0?o:Array.from(l);if(!l.has("tittel")){const i=a?.indexOf("tittel")??-1;i>=0&&a.splice(i,1)}if(!m&&!await u(a?.length?a:void 0,{shouldFocus:!1})){const I=f?.errors||{},p=Object.keys(I).filter(g=>g!=="root").filter(g=>l.has(g));if(!(p.length===0||p.length===1&&p[0]==="tittel"&&!l.has("tittel")))return}if(f?.errors?.root?.type==="manualPeriod"&&((n?.fraTid??null)!==(e?.fraTid??null)||(n?.tilTid??null)!==(e?.tilTid??null)))return;const v=n??d(m,o);try{r("rekrutteringstreff"),await U(t,v),b()}finally{s("rekrutteringstreff")}},[d,t,u,e,b,f?.errors,r,s])}}function tt(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e}=L(t),{data:b,mutate:h}=K(t),u=b?.[0],{getValues:f,trigger:d,setValue:S,formState:o}=O();return{save:C.useCallback(async(n,l)=>{if(!t||R(e,l)||n&&n.length&&!l&&!await d(n,{shouldFocus:!1}))return;const a=f(),v=!!o?.errors?.htmlContent,i=!!a?.htmlContentKiFeil,I=!!a?.htmlContentKiSjekket,k=(a.htmlContent??"").toString(),p=k.trim().length>0;let g=j(v,i,p,l);if(!B(e)&&!l&&(g=g&&I&&!i),!!g)try{const c=u?.opprettetAvPersonNavn||u?.opprettetAvPersonNavident||"Markedskontakt",A={htmlContent:k,tittel:"Om treffet",opprettetAvPersonNavn:c,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:N(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),u?.id?await z(t,u.id,A):await q(t,A),h(),S("htmlContent",k,{shouldDirty:!1})}catch(c){new V({message:"Lagring av innlegg feilet.",error:c})}finally{s("innlegg")}},[f,u,h,t,r,s,S,e,d,o?.errors])}}export{G as a,_ as b,B as e,tt as u};
