import{r as o,j as e,d as k,M as w,bh as q,E as J,b5 as P,b3 as A,bi as U,bj as W,bk as Q,N as X,B as h}from"./iframe-DYebcAac.js";import{M as f}from"./Modal-COqdtEtc.js";import{M as Y}from"./MeldingsmalVisning-CCFtYvI3.js";import{t as Z,f as $}from"./utils-CGM6bfHA.js";const ee=({rekrutteringstreffId:t,oppdaterData:s})=>{const[l,r]=o.useState(!1),i=o.useRef(null),a=()=>i.current?.showModal(),c=()=>{l||i.current?.close()},d=async()=>{if(l)return;r(!0);let u=!1;try{await q(t),s(),u=!0}catch(m){new J({message:"Gjenåpning av rekrutteringstreff feilet",error:m})}finally{r(!1),u&&i.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"button",size:"small",variant:"primary",loading:l,onClick:a,children:"Gjenåpne"}),e.jsxs(f,{ref:i,onClose:()=>{l&&i.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(f.Body,{children:e.jsx(w,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(f.Footer,{children:[e.jsx(k,{type:"button",size:"small",loading:l,onClick:()=>void d(),children:"Gjenåpne"}),e.jsx(k,{type:"button",size:"small",variant:"secondary",disabled:l,onClick:c,children:"Avbryt"})]})]})]})};ee.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const T=(t,s)=>{if(!t)return null;const l=s?.trim()||"00:00";return Z(t,l)},v=t=>t?$(t):"",g=(t,s,l,r,i)=>{const a=u=>i?i(u):u??"",c=a(l),d=a(r);c!==d&&t.push({etikett:s,gammelVerdi:c,nyVerdi:d})},te=(t,s,l)=>{const r=[],i=T(t.fraDato,t.fraTid)??s?.fraTid,a=T(t.tilDato??t.fraDato,t.tilTid)??s?.tilTid,c=T(t.svarfristDato,t.svarfristTid)??s?.svarfrist,d=t.tittel?.trim()||s?.tittel||"";return g(r,"Tittel",s?.tittel,d),g(r,"Beskrivelse",s?.beskrivelse,t.beskrivelse??s?.beskrivelse),g(r,"Fra",s?.fraTid,i,v),g(r,"Til",s?.tilTid,a,v),g(r,"Svarfrist",s?.svarfrist,c,v),g(r,"Gateadresse",s?.gateadresse,t.gateadresse??s?.gateadresse),g(r,"Postnummer",s?.postnummer,t.postnummer??s?.postnummer),g(r,"Poststed",s?.poststed,t.poststed??s?.poststed),(l||"")!==(t.htmlContent||"")&&r.push({etikett:"Innlegg",gammelVerdi:"Innhold endret",nyVerdi:"Innhold endret"}),r},se=({treff:t,innleggHtmlFraBackend:s})=>{const l=o.useRef(null),{getValues:r,watch:i,formState:a}=P(),{rekrutteringstreffId:c}=A(),{data:d}=U(),{data:u}=W(c),[m,S]=o.useState([]),[I,G]=o.useState([]),[j,E]=o.useState(!1),O=o.useMemo(()=>u?.some(n=>n.hendelser.some(p=>p.hendelsestype===Q.INVITERT)),[u]),y=o.useCallback(()=>{l.current?.close()},[]);o.useEffect(()=>{if(!t){const x=setTimeout(()=>{S([])},0);return()=>clearTimeout(x)}const n=()=>{const x=r(),V=te(x,t,s||"");S(K=>JSON.stringify(K)===JSON.stringify(V)?K:V)};n();const p=i(()=>{n()});return()=>p.unsubscribe()},[t,i,r,s]),o.useEffect(()=>{let n=null;return j&&!a.isSubmitting?((!a.errors||Object.keys(a.errors).length===0)&&y(),n=setTimeout(()=>{E(!1)},0)):a.isSubmitting&&!j&&(n=setTimeout(()=>{E(!0)},0)),()=>{n!==null&&clearTimeout(n)}},[a.isSubmitting,a.errors,j,y]);const M=i("tittelKiSjekket")??!1,R=i("htmlContentKiSjekket")??!1,z=i("tittelKiFeil")??!1,_=i("htmlContentKiFeil")??!1,D=z||_,L=!!(a.errors&&Object.keys(a.errors).some(n=>n!=="root")),B=D||L,F=t?.tittel?.trim()==="Treff uten navn",N=m.some(n=>n.etikett==="Tittel"),C=m.some(n=>n.etikett==="Innlegg"),b=o.useMemo(()=>m.length===0||B||!((!N||M)&&(!C||R))||F,[m.length,B,N,C,M,R,F]),H=o.useCallback(()=>{b||(G([...m]),l.current?.showModal())},[m,b]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"button",variant:"primary",size:"small",disabled:b,onClick:H,children:"Publiser på nytt"}),e.jsxs(f,{ref:l,header:{heading:"Følgende endringer vil bli publisert"},children:[e.jsx(f.Body,{children:e.jsxs("div",{className:"space-y-3",children:[I.length===0?e.jsx(w,{children:"Ingen endringer oppdaget."}):e.jsx("div",{className:"space-y-3",children:I.map((n,p)=>e.jsxs("div",{className:"border-b pb-2",children:[e.jsx(X,{size:"small",children:n.etikett}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{children:"Fra:"}),e.jsx(h,{className:"text-gray-400",children:n.gammelVerdi||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{children:"Til:"}),e.jsx(h,{className:"text-gray-400",children:n.nyVerdi||"—"})]})]},p))}),d&&O&&e.jsx(Y,{tittel:"Melding til jobbsøker om endring",smsTekst:d.kandidatInvitertTreffEndret.smsTekst,epostTittel:d.kandidatInvitertTreffEndret.epostTittel,epostHtmlBody:d.kandidatInvitertTreffEndret.epostHtmlBody})]})}),e.jsxs(f.Footer,{children:[e.jsx(k,{type:"submit",form:"rekrutteringstreff-form",variant:"primary",size:"small",disabled:b,loading:a.isSubmitting,children:"Publiser på nytt"}),e.jsx(k,{type:"button",variant:"secondary",size:"small",onClick:y,disabled:a.isSubmitting,children:"Avbryt"})]})]})]})};se.__docgenInfo={description:`Komponent for å republisere et rekrutteringstreff.
Viser en knapp som åpner en modal for bekreftelse av endringer før republisering.`,methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{treff:{required:!0,tsType:{name:"any"},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{ee as G,se as R};
