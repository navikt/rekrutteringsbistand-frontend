import{t as y,a as N}from"./utils-PYbeYfgi.js";import{o as x,av as M,h5 as B,hB as $,ak as H,T,h2 as D,hC as P,h4 as w,r as L,hA as K,w as V,hD as J,hi as C}from"./iframe-BAewwkeG.js";import{o as U}from"./mutations-BrPiw95f.js";const E=x({tittel:T().min(1,"Tittel kan ikke være tom"),htmlContent:T().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:T().nullable().optional(),opprettetAvPersonBeskrivelse:T().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:T().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),R=$,X=t=>`${B.internUrl}/${t}/innlegg`,Z=(t,r)=>`${B.internUrl}/${t}/innlegg/${r}`,q=async(t,r)=>{E.parse(r);const s=await H(X(t),r);return R.parse(s)},z=async(t,r,s)=>{E.parse(s);const e=await M(Z(t,r),s);return R.parse(e)},G=()=>{try{return!1}catch{return!1}},O=t=>{const r=J(t?.hendelser);return r===C.INVITERE||r===C.FULLFØRE},F=(t,r)=>r?!1:O(t)&&G(),j=(t,r,s,e)=>t||r&&!e?!1:s;function _(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=D(),{data:e,mutate:b}=P(t),{getValues:h,trigger:u,formState:f}=w(),p=L.useCallback((o,m)=>{const n=h(),l=y(n.fraDato??null,n.fraTid)??e?.fraTid??null,a=y(n.tilDato??n.fraDato??null,n.tilTid)??e?.tilTid??null,v=y(n.svarfristDato??null,n.svarfristTid)??e?.svarfrist??null,i=typeof n.tittel=="string"?n.tittel.trim():"",I=!!f?.errors?.tittel,k=!!n.tittelKiFeil,d=!!n?.tittelKiSjekket,g=!!(i.length>0||e?.tittel&&e.tittel.trim().length>0);let c=j(I,k,g,o);return!O(e)&&!o&&(c=c&&d&&!k),{tittel:c&&i.length>0?i:e?.tittel,beskrivelse:n.beskrivelse??e?.beskrivelse??null,fraTid:l,tilTid:a,svarfrist:v,gateadresse:n.gateadresse??e?.gateadresse??null,postnummer:n.postnummer??e?.postnummer??null,poststed:n.poststed??e?.poststed??null}},[h,e,f]);return{validerOgLagreRekrutteringstreff:L.useCallback(async(o,m)=>{if(!t||F(e,m))return;const n=p(m,o),l=new Set(Object.keys(n??{})),a=o&&o.length>0?o:Array.from(l);if(!l.has("tittel")){const i=a?.indexOf("tittel")??-1;i>=0&&a.splice(i,1)}if(!m&&!await u(a?.length?a:void 0,{shouldFocus:!1})){const I=f?.errors||{},d=Object.keys(I).filter(g=>g!=="root").filter(g=>l.has(g));if(!(d.length===0||d.length===1&&d[0]==="tittel"&&!l.has("tittel")))return}if(f?.errors?.root?.type==="manualPeriod"&&((n?.fraTid??null)!==(e?.fraTid??null)||(n?.tilTid??null)!==(e?.tilTid??null)))return;const v=n??p(m,o);try{r("rekrutteringstreff"),await U(t,v),b()}finally{s("rekrutteringstreff")}},[p,t,u,e,b,f?.errors,r,s])}}function tt(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=D(),{data:e}=P(t),{data:b,mutate:h}=K(t),u=b?.[0],{getValues:f,trigger:p,setValue:S,formState:o}=w();return{validerOgLagreInnlegg:L.useCallback(async(n,l)=>{if(!t||F(e,l)||n&&n.length&&!l&&!await p(n,{shouldFocus:!1}))return;const a=f(),v=!!o?.errors?.htmlContent,i=!!a?.htmlContentKiFeil,I=!!a?.htmlContentKiSjekket,k=(a.htmlContent??"").toString(),d=k.trim().length>0;let g=j(v,i,d,l);if(!O(e)&&!l&&(g=g&&I&&!i),!!g)try{const c=u?.opprettetAvPersonNavn||u?.opprettetAvPersonNavident||"Markedskontakt",A={htmlContent:k,tittel:"Om treffet",opprettetAvPersonNavn:c,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:N(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),u?.id?await z(t,u.id,A):await q(t,A),h(),S("htmlContent",k,{shouldDirty:!1})}catch(c){new V({message:"Lagring av innlegg feilet.",error:c})}finally{s("innlegg")}},[f,u,h,t,r,s,S,e,p,o?.errors])}}export{G as a,_ as b,O as e,tt as u};
