import{e as U,a as $}from"./useAutosave-CB3Uvbsh.js";import{a_ as q,bF as z,bK as B,r as s,f as R}from"./iframe-Bm0iWSAX.js";const K=n=>n==null?"":String(n).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function X(n){const{feltType:V,fieldName:y,watchedValue:L,triggerRHF:p,getValues:v,setValue:r,setKiFeilFieldName:w,saveCallback:g,setKiLagret:a,requireHasCheckedToShow:D,setKiSjekketFieldName:t,savedValue:k}=n,{rekrutteringstreffId:E}=q(),{data:x}=z(E),o=U(x)&&$(),{trigger:F,data:e,reset:S,error:f,isMutating:H}=B(E),[u,j]=s.useState(null),[i,c]=s.useState(!1),[C,b]=s.useState(!1);s.useEffect(()=>{b(!1),c(!1),j(null),S(),t&&r(t,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[L,S,t,r]);const M=!!e&&!f&&e?.bryterRetningslinjer&&!i;s.useEffect(()=>{const h=!!e&&!f&&!!e?.bryterRetningslinjer&&!i;r(w,h,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[e,f,i,w,r]);const N=s.useCallback(async()=>{if(!await p(y))return;const m=v(y),I=(typeof m=="string"?m:String(m??"")).trim(),A=K(I);if(A){if(k!==void 0){const l=K(k);if(A===l)return}try{const l=await F({feltType:V,tekst:I});b(!0),t&&r(t,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const d=l?.loggId??e?.loggId??null;if(j(d),(!(l?.bryterRetningslinjer??e?.bryterRetningslinjer)||i)&&!o&&(await g(!1),d&&a))try{await a({id:d,lagret:!0})}catch(P){new R({message:`Feil ved oppdatering av /lagret for logg ${d}.`,error:P})}}catch(l){new R({message:"Validation failed:",error:l}),b(!0),t&&r(t,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[p,y,v,F,V,i,o,g,a,e,t,r,k]),G=s.useCallback(async()=>{if(o){c(!0);return}if(c(!0),await g(!0),u&&a)try{await a({id:u,lagret:!0})}catch(h){new R({message:`Feil ved oppdatering av /lagret for logg ${u}.`,error:h})}},[o,g,u,a]),T=!!e&&!f&&!!e?.bryterRetningslinjer;return{analyse:e,analyseError:f,validating:H,kiErrorBorder:M,forceSave:i,setForceSave:c,loggId:u,hasChecked:C,showAnalysis:D?C&&T:T,erRedigeringAvPublisertTreff:o,runValidationAndMaybeSave:N,onForceSave:G}}export{X as u};
