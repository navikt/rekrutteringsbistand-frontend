import{t as y,a as N}from"./utils-mdupL_T8.js";import{o as x,av as M,h5 as P,hC as $,ak as H,T as b,h2 as w,hD as E,h4 as L,r as A,hB as K,w as J,hE as U,hi as D}from"./iframe-UjNt-zBO.js";import{o as X}from"./mutations-tTjdV5tW.js";const O=x({tittel:b().min(1,"Tittel kan ikke være tom"),htmlContent:b().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:b().nullable().optional(),opprettetAvPersonBeskrivelse:b().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:b().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),F=$,Z=t=>`${P.internUrl}/${t}/innlegg`,q=(t,r)=>`${P.internUrl}/${t}/innlegg/${r}`,z=async(t,r)=>{O.parse(r);const s=await H(Z(t),r);return F.parse(s)},G=async(t,r,s)=>{O.parse(s);const e=await M(q(t,r),s);return F.parse(e)},Q=()=>{try{return!1}catch{return!1}},C=t=>{const r=U(t?.hendelser);return r===D.INVITERE||r===D.FULLFØRE},R=(t,r)=>r?!1:C(t)&&Q(),j=(t,r,s,e)=>t||r&&!e?!1:s;function V(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e,mutate:T}=E(t),{getValues:h,trigger:c,formState:k}=L(),m=A.useCallback((o,g)=>{const n=h(),l=y(n.fraDato??null,n.fraTid)??e?.fraTid??null,i=y(n.tilDato??n.fraDato??null,n.tilTid)??e?.tilTid??null,v=y(n.svarfristDato??null,n.svarfristTid)??e?.svarfrist??null,a=typeof n.tittel=="string"?n.tittel.trim():"",I=!!k?.errors?.tittel,p=!!n.tittelKiFeil,d=!!n?.tittelKiSjekket,u=!!(a.length>0||e?.tittel&&e.tittel.trim().length>0);let f=j(I,p,u,o);return!C(e)&&!o&&(f=f&&d&&!p),g&&g.length>0&&!g.includes("tittel")&&(f=!1),{...f&&{tittel:a.length>0?a:e?.tittel},beskrivelse:n.beskrivelse??e?.beskrivelse??null,fraTid:l,tilTid:i,svarfrist:v,gateadresse:n.gateadresse??e?.gateadresse??null,postnummer:n.postnummer??e?.postnummer??null,poststed:n.poststed??e?.poststed??null}},[h,e,k]);return{save:A.useCallback(async(o,g)=>{if(!t||R(e,g))return;const n=m(g,o),l=new Set(Object.keys(n??{})),i=o&&o.length>0?o:Array.from(l);if(!l.has("tittel")){const a=i?.indexOf("tittel")??-1;a>=0&&i.splice(a,1)}if(!g&&!await c(i?.length?i:void 0,{shouldFocus:!1})){const I=k?.errors||{},d=Object.keys(I).filter(u=>u!=="root").filter(u=>l.has(u));if(!(d.length===0||d.length===1&&d[0]==="tittel"&&!l.has("tittel")))return}if(k?.errors?.root?.type==="manualPeriod"&&((n?.fraTid??null)!==(e?.fraTid??null)||(n?.tilTid??null)!==(e?.tilTid??null)))return;const v=n??m(g,o);try{r("rekrutteringstreff"),await X(t,v),T()}finally{s("rekrutteringstreff")}},[m,t,c,e,T,k?.errors,r,s])}}function tt(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e}=E(t),{data:T,mutate:h}=K(t),c=T?.[0],{getValues:k,trigger:m,setValue:S,formState:o}=L();return{save:A.useCallback(async(n,l)=>{if(!t||R(e,l)||n&&n.length&&!l&&!await m(n,{shouldFocus:!1}))return;const i=k(),v=!!o?.errors?.htmlContent,a=!!i?.htmlContentKiFeil,I=!!i?.htmlContentKiSjekket,p=(i.htmlContent??"").toString(),d=p.trim().length>0;let u=j(v,a,d,l);if(!C(e)&&!l&&(u=u&&I&&!a),!!u)try{const f=c?.opprettetAvPersonNavn||c?.opprettetAvPersonNavident||"Markedskontakt",B={htmlContent:p,tittel:"Om treffet",opprettetAvPersonNavn:f,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:N(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),c?.id?await G(t,c.id,B):await z(t,B),h(),S("htmlContent",p,{shouldDirty:!1})}catch(f){new J({message:"Lagring av innlegg feilet.",error:f})}finally{s("innlegg")}},[k,c,h,t,r,s,S,e,m,o?.errors])}}export{Q as a,V as b,C as e,tt as u};
