import{x as O,y as K,av as D,r as u,h9 as U,ha as b,hb as v,q as W,hc as k,hd as C,he as x,h1 as P,au as _,k as N,h6 as E,a8 as F,o as V,W as e,b as L,X as M}from"./iframe-DYYFo0EH.js";const A=x?t=>{t()}:W.startTransition,q=t=>{const[,r]=u.useState({}),n=u.useRef(!1),a=u.useRef(t),o=u.useRef({data:!1,error:!1,isValidating:!1}),s=u.useCallback(c=>{let g=!1;const p=a.current;for(const f in c)if(Object.prototype.hasOwnProperty.call(c,f)){const i=f;p[i]!==c[i]&&(p[i]=c[i],o.current[i]&&(g=!0))}g&&!n.current&&r({})},[]);return C(()=>(n.current=!1,()=>{n.current=!0})),[a,o.current,s]},z=()=>(t,r,n={})=>{const{mutate:a}=D(),o=u.useRef(t),s=u.useRef(r),c=u.useRef(n),g=u.useRef(0),[p,f,i]=q({data:k,error:k,isMutating:!1}),d=p.current,S=u.useCallback(async(m,j)=>{const[w,T]=U(o.current);if(!s.current)throw new Error("Can’t trigger the mutation: missing fetcher.");if(!w)throw new Error("Can’t trigger the mutation: missing key.");const l=b(b({populateCache:!1,throwOnError:!0},c.current),j),y=v();g.current=y,i({isMutating:!0});try{const h=await a(w,s.current(T,{arg:m}),b(l,{throwOnError:!0}));return g.current<=y&&(A(()=>i({data:h,isMutating:!1,error:void 0})),l.onSuccess==null||l.onSuccess.call(l,h,w,l)),h}catch(h){if(g.current<=y&&(A(()=>i({error:h,isMutating:!1})),l.onError==null||l.onError.call(l,h,w,l),l.throwOnError))throw h}},[]),$=u.useCallback(()=>{g.current=v(),i({data:k,error:k,isMutating:!1})},[]);return C(()=>{o.current=t,s.current=r,c.current=n}),{trigger:S,reset:$,get data(){return f.data=!0,d.data},get error(){return f.error=!0,d.error},get isMutating(){return f.isMutating=!0,d.isMutating}}},I=O(K,z),B=(t=":rekrutteringstreffId")=>`${P.internUrl}/${t}/ki`,R=(t=":rekrutteringstreffId")=>`${B(t)}/logg`,G=V({id:e(),opprettetTidspunkt:e(),treffId:e(),tittel:e().nullable(),feltType:e(),spørringFraFrontend:e(),spørringFiltrert:e(),systemprompt:e().nullable(),bryterRetningslinjer:M(),begrunnelse:e().nullable(),kiNavn:e(),kiVersjon:e(),svartidMs:L(),lagret:M(),manuellKontrollBryterRetningslinjer:M().nullable(),manuellKontrollUtfortAv:e().nullable(),manuellKontrollTidspunkt:e().nullable(),promptVersjonsnummer:L().nullable(),promptEndretTidspunkt:e().nullable(),promptHash:e().nullable()}),H=N(G),X=async t=>{try{const r=await _(t);return H.parse(r)}catch(r){throw E.logger.error(r,`Feil ved henting av KI-logg fra ${t}`),r}},Y=t=>async(r,{arg:n})=>{const{id:a,bryterRetningslinjer:o}=n;try{await F(`${R(t)}/${a}/manuell`,{bryterRetningslinjer:o})}catch(s){throw E.logger.error(s,`Feil ved oppdatering av manuell vurdering for KI-logg ${a}`),s}},J=t=>async(r,{arg:n})=>{const{id:a,lagret:o}=n;try{await F(`${R(t)}/${a}/lagret`,{lagret:o})}catch(s){throw E.logger.error(s,`Feil ved oppdatering av lagret-status for KI-logg ${a}`),s}},Z=(t,r)=>{const n=new URLSearchParams;r&&n.set("feltType",r);const a=t?`${R(t)}${n.toString()?`?${n.toString()}`:""}`:null,o=K(a,X,{revalidateOnFocus:!1}),{trigger:s,isMutating:c,error:g}=I(`${R(t??":rekrutteringstreffId")}/manuell`,Y(t??":rekrutteringstreffId")),{trigger:p,isMutating:f,error:i}=I(`${R(t??":rekrutteringstreffId")}/lagret`,J(t??":rekrutteringstreffId")),d=async()=>await o.mutate();return{...o,setManuell:async m=>{await s(m),await d()},settingManuell:c,manuellError:g,setLagret:async m=>{await p(m),await d()},settingLagret:f,lagretError:i,refresh:d}};export{Z as a,I as u};
