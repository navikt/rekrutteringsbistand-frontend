import{o as R,av as K,h5 as b,hA as N,ak as V,T as f,h2 as h,hB as j,h4 as x,r as k,w as D,hC as B,j as n,B as O,aP as M}from"./iframe-D0HnIaN5.js";import{f as $}from"./index-muOa2yv3.js";import{u as H,s as _}from"./useRekrutteringstreffValidering-BEUI_wN4.js";import{K as G}from"./KiAnalyseIntro-DA6S_OTX.js";import{K as J}from"./KiAnalysePanel-BDpuH93o.js";import{u as U}from"./useFormFeltMedKiValidering-pK_HL8hp.js";import{R as X}from"./RikTekstEditor-C6yU9mBQ.js";import{S as q}from"./Skeleton-B8wtegwI.js";const A=R({tittel:f().min(1,"Tittel kan ikke være tom"),htmlContent:f().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:f().nullable().optional(),opprettetAvPersonBeskrivelse:f().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:f().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),S=N,z=e=>`${b.internUrl}/${e}/innlegg`,W=(e,t)=>`${b.internUrl}/${e}/innlegg/${t}`,Z=async(e,t)=>{A.parse(t);const r=await V(z(e),t);return S.parse(r)},Q=async(e,t,r)=>{A.parse(r);const o=await K(W(e,t),r);return S.parse(o)};function Y(){const{rekrutteringstreffId:e,startLagring:t,stoppLagring:r}=h(),{data:o,mutate:a}=j(e),s=o?.[0],{getValues:l,setValue:g}=x();return{lagre:k.useCallback(async()=>{if(!e)return;const i=(l().htmlContent??"").toString();if(i.trim().length!==0)try{const d=s?.opprettetAvPersonNavn||s?.opprettetAvPersonNavident||"Markedskontakt",c={htmlContent:i,tittel:"Om treffet",opprettetAvPersonNavn:d,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:$(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};t("innlegg"),s?.id?await Q(e,s.id,c):await Z(e,c),a(),g("htmlContent",i,{shouldDirty:!1})}catch(d){new D({message:"Lagring av innlegg feilet.",error:d})}finally{r("innlegg")}},[l,s,a,e,t,r,g])}}function ee(){const{rekrutteringstreffId:e}=h(),{data:t}=B(e),{getValues:r,trigger:o,formState:a}=x(),{lagre:s}=Y(),{harInnleggFeil:l,innleggKiFeil:g,innleggKiSjekket:m}=H();return{autosave:k.useCallback(async i=>{!e||_(t)||i&&i.length&&!await o(i,{shouldFocus:!1})||!((r().htmlContent??"").toString().trim().length>0)||l||m&&g||await s()},[e,t,o,a,r,s,l,g,m])}}const te="rediger-innlegg-htmlcontent-form",T=({onUpdated:e})=>{const{rekrutteringstreffId:t}=h(),{data:r,isLoading:o}=j(t),a=r?.[0],s=a?a.htmlContent??null:void 0,{autosave:l}=ee(),[g,m]=k.useState(Date.now()),{analyse:p,analyseError:i,validating:d,kiErrorBorder:c,harGodkjentKiFeil:v,showAnalysis:y,erRedigeringAvPublisertTreff:w,validerMedKiOgLagreVedGodkjenning:E,onGodkjennKiFeil:F,control:L,setValue:I,kiLoggLoading:C}=U({feltType:"innlegg",fieldName:"htmlContent",savedValue:s,saveCallback:l,onUpdated:e,requireHasCheckedToShow:!0});return k.useEffect(()=>{const u=a?.htmlContent??"";I("htmlContent",u,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!1}),m(Date.now())},[I,a?.htmlContent]),n.jsx(n.Fragment,{children:n.jsxs("section",{className:"space-y-3",children:[n.jsx(G,{title:"Introduksjon"}),(o||C)&&n.jsx(q,{variant:"text"}),!o&&!C&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"space-y-2",children:n.jsx(O,{size:"small",textColor:"subtle",children:"Fortell jobbsøkeren om treffet: de unike fordelene, mulighetene, og oppgavene som de vil møte. For eksempel arbeidsgivere, forventninger, læring- og karrieremuligheter."})}),n.jsx("div",{className:`border rounded-lg ${c?"border-red-500":"border-gray-300"}`,onBlur:u=>{const P=u.currentTarget;setTimeout(async()=>{P.contains(document.activeElement)||await E()},0)},children:n.jsx(M,{name:"htmlContent",control:L,render:({field:u})=>n.jsx(X,{id:te,tekst:u.value??"",onChange:u.onChange},g)})}),n.jsx(J,{validating:d,analyse:p,analyseError:i,harGodkjentKiFeil:v,showAnalysis:y,erRedigeringAvPublisertTreff:w,onGodkjennKiFeil:F,ariaLabel:"Analyse av innlegg"})]})]})})};T.displayName="InnleggForm";T.__docgenInfo={description:"",methods:[],displayName:"InnleggForm",props:{onUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{T as I};
