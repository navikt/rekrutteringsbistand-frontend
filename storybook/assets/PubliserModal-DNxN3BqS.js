import{u as Z,r as i,b0 as ee,T as se,bc as te,at as ie,j as e,d as v,H as I,E as re,ch as le,w as ne}from"./iframe-Dn6oOtbf.js";import{D as T}from"./DatoVelger-C1ECt_Wo.js";import{p as C}from"./parse-VVjy0MJj.js";import{f as y,i as P}from"./format-C0S4jMUI.js";import{p as oe}from"./parseISO-Cf7-iP2x.js";import{U as ae}from"./umamiEvents-DmzFNrn7.js";import{v as de}from"./validerEpost-bkYxvk6k.js";import{M as x}from"./Modal-BVkvhY2h.js";import{B as pe}from"./Box-7aq35ZMy.js";import{a as ue}from"./Checkbox-C-i3RhP1.js";import{T as j}from"./ToggleGroup-C_ucDYtI.js";import{T as L}from"./TextField-Bg37P7x7.js";const ce=s=>s.replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})(?!:)/,"$1:00").replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\.(\d{3})\d+(.*)$/,"$1.$2$3"),O=s=>{if(!s)return null;if(/^\d{2}\.\d{2}\.\d{4}$/.test(s)){const o=C(s,"dd.MM.yyyy",new Date);return P(o)?y(o,"yyyy-MM-dd'T'00:00:00"):null}const l=oe(ce(s));return P(l)?y(l,"yyyy-MM-dd'T'HH:mm:ss"):null},ge=s=>{const l=O(s.stilling?.published),o=O(s.stilling?.expires);return{...s,stilling:{...s.stilling,properties:{...s.stilling.properties,tags:typeof s.stilling?.properties?.tags=="string"?s.stilling?.properties?.tags:JSON.stringify(s.stilling?.properties?.tags??[]),workday:typeof s.stilling?.properties?.workday=="string"?s.stilling?.properties?.workday:JSON.stringify(s.stilling?.properties?.workday??[]),workhours:typeof s.stilling?.properties?.workhours=="string"?s.stilling?.properties?.workhours:JSON.stringify(s.stilling?.properties?.workhours??[])},published:l,expires:o}}};function me({disabled:s}){const{brukerData:l,valgtNavKontor:o}=Z(),p=i.useRef(null),{watch:a,setValue:n,getValues:h}=ee(),{track:H}=se(),A=te(),V=a("stilling.privacy"),_=a("stilling.published"),$=a("stilling.expires"),B=a("stilling.properties.applicationemail"),S=a("stilling.properties.applicationurl"),[F,N]=i.useState(!1),z=ie(h().stilling.uuid),E=t=>{if(t)try{return y(new Date(t),"dd.MM.yyyy")}catch{return}},[u,R]=i.useState(E(_)),[c,U]=i.useState(E($)),[g,J]=i.useState(V==="SHOW_ALL"),K=S?"url":"email",[d,W]=i.useState(K),[b,G]=i.useState(B??""),[q,D]=i.useState(""),[f,Q]=i.useState(S??""),[X,M]=i.useState(""),w=t=>{if(!t)return null;const r=C(t,"dd.MM.yyyy",new Date);return y(r,"yyyy-MM-dd'T'HH:mm:ss")},k=()=>{D(""),M("")},Y=async()=>{N(!0);try{if(n("stilling.published",w(u),{shouldDirty:!0}),n("stilling.expires",w(c),{shouldDirty:!0}),n("stilling.privacy",g?"SHOW_ALL":"INTERNAL_NOT_SHOWN",{shouldDirty:!0}),g)if(d==="email"){const m=de(b);if(m.erGodkjent)n("stilling.properties.applicationemail",b,{shouldDirty:!0}),n("stilling.properties.applicationurl",null,{shouldDirty:!0});else{D(m.feilmelding);return}}else if(f.trim()!=="")n("stilling.properties.applicationurl",f,{shouldDirty:!0}),n("stilling.properties.applicationemail",null,{shouldDirty:!0});else{M("Lenke til søknadsskjema kan ikke være tom");return}const t=ge(h()),r={...t,stillingsinfo:{...t.stillingsinfo},stilling:{...t.stilling,status:"ACTIVE",administration:{...t.stilling.administration,status:"DONE"},firstPublished:!0}};H(ae.Stilling.ny_stilling_info,{yrkestittel:r.stilling.categoryList?.[0]?.name,sektor:r.stilling.properties?.sector,ansettelsesform:r.stilling.properties?.engagementtype,arbeidstidsordning:r.stilling?.properties?.jobarrangement,omfangIProsent:r.stilling.properties?.jobpercentage,arbeidssted:r.stilling.locationList});try{await le(r,{eierNavident:l.ident,eierNavn:l.navn,eierNavKontorEnhetId:o?.navKontor})}catch(m){alert("Feil ved opprettelse av stilling"),new ne({message:"Feil ved opprettelse av stilling",error:m})}p.current?.close(),z.mutate(),A.push(`/stilling/${h().stilling.uuid}`)}catch{alert("Uventet feil ved publisering")}finally{N(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"small",disabled:s,onClick:()=>{k(),p.current?.showModal()},children:"Publiser"}),e.jsxs(x,{ref:p,header:{heading:"Publiser stillingsoppdraget"},children:[e.jsxs(x.Body,{children:[e.jsxs(pe.New,{background:"neutral-soft",padding:"6",className:"mb-8",children:[e.jsx(I,{size:"small",className:"mb-2",children:"Dette skjer når du publiserer oppdraget"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm mb-4",children:[e.jsx("li",{children:"Stillingsoppdraget blir synlig for Nav-ansatte i rekrutteringsbistand."}),e.jsx("li",{children:"Ansatte hos arbeidsgiveren på Min Side Arbeidsgiver på nav.no (med Altinn-tilgang)."}),e.jsx("li",{children:"Jobbsøkere som får stillingen delt i aktivitetsplanen."})]}),e.jsx(re,{size:"small",children:"Ikke alt må være helt perfekt! Du kan når som helst endre eller avpublisere oppdraget."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(T,{disablePastDates:!0,label:"Publiseringsdato",valgtDato:u,tilDato:c,setDato:t=>R(t)}),e.jsx(T,{disablePastDates:!0,label:"Siste visningsdato",valgtDato:c,fraDato:u,setDato:t=>U(t)})]}),e.jsx(ue,{checked:g,onChange:t=>J(t.target.checked),children:"Publiser stillingsoppdraget offentlig på arbeidsplassen.no også"}),g&&e.jsxs("div",{children:[e.jsx(I,{size:"small",className:"mb-4",children:"Hvordan skal jobbsøker søke?"}),e.jsxs(j,{fill:!0,defaultValue:d,onChange:t=>W(t),children:[e.jsx(j.Item,{value:"email",label:"E-post"}),e.jsx(j.Item,{value:"url",label:"Søknadsskjema"})]}),d==="email"&&e.jsx("div",{className:"mt-4",children:e.jsx(L,{label:"E-post",value:b,error:q,onInput:()=>k(),onChange:t=>G(t.target.value)})}),d==="url"&&e.jsx("div",{className:"mt-4",children:e.jsx(L,{label:"Lenke til søknadsskjema",value:f,error:X,onInput:()=>k(),onChange:t=>Q(t.target.value)})})]})]})]}),e.jsxs(x.Footer,{children:[e.jsx(v,{loading:F,type:"button",onClick:Y,children:"Publiser oppdraget"}),e.jsx(v,{type:"button",variant:"secondary",onClick:()=>p.current?.close(),children:"Avbryt"})]})]})]})}me.__docgenInfo={description:"",methods:[],displayName:"PubliserModal",props:{disabled:{required:!0,tsType:{name:"boolean"},description:""}}};export{me as P,ge as m};
