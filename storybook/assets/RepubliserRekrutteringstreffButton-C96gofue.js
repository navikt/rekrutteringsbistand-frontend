import{r as d,j as e,d as g,F as V,br as L,x as D,bg as _,L as q,B as k}from"./iframe-BovJDKCI.js";import{M as p}from"./Modal-BS1wt9c9.js";import{t as P,f as A}from"./utils-qn5ksuH1.js";const J=({rekrutteringstreffId:t,oppdaterData:s})=>{const[a,n]=d.useState(!1),i=d.useRef(null),l=()=>i.current?.showModal(),o=()=>{a||i.current?.close()},c=async()=>{if(a)return;n(!0);let u=!1;try{await L(t),s(),u=!0}catch(b){new D({message:"Gjenåpning av rekrutteringstreff feilet",error:b})}finally{n(!1),u&&i.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"button",size:"small",variant:"primary",loading:a,onClick:l,children:"Gjenåpne"}),e.jsxs(p,{ref:i,onClose:()=>{a&&i.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(p.Body,{children:e.jsx(V,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(p.Footer,{children:[e.jsx(g,{type:"button",size:"small",loading:a,onClick:()=>void c(),children:"Gjenåpne"}),e.jsx(g,{type:"button",size:"small",variant:"secondary",disabled:a,onClick:o,children:"Avbryt"})]})]})]})};J.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const v=(t,s)=>{if(!t)return null;const a=s?.trim()||"00:00";return P(t,a)},T=t=>t?A(t):"",m=(t,s,a,n,i)=>{const l=u=>i?i(u):u??"",o=l(a),c=l(n);o!==c&&t.push({etikett:s,gammelVerdi:o,nyVerdi:c})},H=(t,s,a)=>{const n=[],i=v(t.fraDato,t.fraTid)??s?.fraTid,l=v(t.tilDato??t.fraDato,t.tilTid)??s?.tilTid,o=v(t.svarfristDato,t.svarfristTid)??s?.svarfrist,c=t.tittel?.trim()||s?.tittel||"";return m(n,"Tittel",s?.tittel,c),m(n,"Beskrivelse",s?.beskrivelse,t.beskrivelse??s?.beskrivelse),m(n,"Fra",s?.fraTid,i,T),m(n,"Til",s?.tilTid,l,T),m(n,"Svarfrist",s?.svarfrist,o,T),m(n,"Gateadresse",s?.gateadresse,t.gateadresse??s?.gateadresse),m(n,"Postnummer",s?.postnummer,t.postnummer??s?.postnummer),m(n,"Poststed",s?.poststed,t.poststed??s?.poststed),(a||"")!==(t.htmlContent||"")&&n.push({etikett:"Innlegg",gammelVerdi:"Innhold endret",nyVerdi:"Innhold endret"}),n},U=({treff:t,innleggHtmlFraBackend:s})=>{const a=d.useRef(null),{getValues:n,watch:i,formState:l}=_(),[o,c]=d.useState([]),[u,b]=d.useState([]),[j,S]=d.useState(!1),y=d.useCallback(()=>{a.current?.close()},[]);d.useEffect(()=>{if(!t){const x=setTimeout(()=>{c([])},0);return()=>clearTimeout(x)}const r=()=>{const x=n(),C=H(x,t,s||"");c(M=>JSON.stringify(M)===JSON.stringify(C)?M:C)};r();const h=i(()=>{r()});return()=>h.unsubscribe()},[t,i,n,s]),d.useEffect(()=>{let r=null;return j&&!l.isSubmitting?((!l.errors||Object.keys(l.errors).length===0)&&y(),r=setTimeout(()=>{S(!1)},0)):l.isSubmitting&&!j&&(r=setTimeout(()=>{S(!0)},0)),()=>{r!==null&&clearTimeout(r)}},[l.isSubmitting,l.errors,j,y]);const I=i("tittelKiSjekket")??!1,F=i("htmlContentKiSjekket")??!1,K=i("tittelKiFeil")??!1,w=i("htmlContentKiFeil")??!1,G=K||w,O=!!(l.errors&&Object.keys(l.errors).some(r=>r!=="root")),R=G||O,E=t?.tittel?.trim()==="Treff uten navn",N=o.some(r=>r.etikett==="Tittel"),B=o.some(r=>r.etikett==="Innlegg"),f=d.useMemo(()=>o.length===0||R||!((!N||I)&&(!B||F))||E,[o.length,R,N,B,I,F,E]),z=d.useCallback(()=>{f||(b([...o]),a.current?.showModal())},[o,f]);return e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"button",variant:"primary",size:"small",disabled:f,onClick:z,children:"Publiser på nytt"}),e.jsxs(p,{ref:a,header:{heading:"Følgende endringer vil bli publisert"},children:[e.jsx(p.Body,{children:e.jsxs("div",{className:"space-y-3",children:[u.length===0?e.jsx(V,{children:"Ingen endringer oppdaget."}):e.jsx("div",{className:"space-y-3",children:u.map((r,h)=>e.jsxs("div",{className:"border-b pb-2",children:[e.jsx(q,{size:"small",children:r.etikett}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Fra:"}),e.jsx(k,{className:"text-gray-400",children:r.gammelVerdi||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Til:"}),e.jsx(k,{className:"text-gray-400",children:r.nyVerdi||"—"})]})]},h))}),e.jsx(k,{className:"text-gray-600",children:"Inviterte deltakere vil ikke bli informert om endringene på nytt av republiseringen"})]})}),e.jsxs(p.Footer,{children:[e.jsx(g,{type:"submit",form:"rekrutteringstreff-form",variant:"primary",size:"small",disabled:f,loading:l.isSubmitting,children:"Publiser på nytt"}),e.jsx(g,{type:"button",variant:"secondary",size:"small",onClick:y,disabled:l.isSubmitting,children:"Avbryt"})]})]})]})};U.__docgenInfo={description:`Komponent for å republisere et rekrutteringstreff.
Viser en knapp som åpner en modal for bekreftelse av endringer før republisering.`,methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{treff:{required:!0,tsType:{name:"any"},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{J as G,U as R};
