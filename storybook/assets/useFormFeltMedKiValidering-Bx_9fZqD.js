import{e as B,a as O}from"./useAutosave-Dt5xq-0K.js";import{b3 as Q,b8 as W,b5 as q,bI as J,bP as X,bQ as Y,r as a,E as y}from"./iframe-T-H04Ezd.js";const G=s=>s==null?"":String(s).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function N({feltType:s,fieldName:e,savedValue:b,saveCallback:V,onUpdated:g}){const{rekrutteringstreffId:F}=Q(),{treff:T}=W(),{control:R,setValue:t,getValues:j,trigger:E}=q(),{setLagret:i,isLoading:x}=J(F,s),L=X({control:R,name:e}),w=B(T)&&O(),{trigger:S,data:r,reset:$,error:n,isMutating:A}=Y(F),[u,C]=a.useState(null),[c,d]=a.useState(!1),[D,f]=a.useState(!1);a.useEffect(()=>{f(!1),d(!1),C(null),$(),t(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[L,$,e,t]);const M=!!r&&!n&&r?.bryterRetningslinjer&&!c;a.useEffect(()=>{const l=!!r&&!n&&!!r?.bryterRetningslinjer&&!c;t(`${e}KiFeil`,l,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[r,n,c,e,t]);const h=a.useCallback(async l=>{try{await V([e],l)}catch(K){new y({message:`Lagring av ${s} feilet.`,error:K})}finally{g?.()}},[V,e,s,g]),H=a.useCallback(async()=>{if(!await E(e))return;const K=j(e),I=String(K??"").trim(),v=G(I);if(v){if(b!==void 0){const o=G(b);if(v===o)return}try{const o=await S({feltType:s,tekst:I});f(!0);const k=o?.loggId??r?.loggId??null;C(k);const p=o?.bryterRetningslinjer??r?.bryterRetningslinjer;if(t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),t(`${e}KiFeil`,!!p,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),!p&&(await h(!0),k&&i))try{await i({id:k,lagret:!0})}catch(z){new y({message:`Feil ved oppdatering av /lagret for logg ${k}.`,error:z})}}catch(o){new y({message:"Validation failed:",error:o}),f(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[E,e,j,S,s,h,i,r,t,b]),P=a.useCallback(async()=>{if(w){d(!0),f(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),t(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),g?.();return}if(d(!0),await h(!0),u&&i)try{await i({id:u,lagret:!0})}catch(l){new y({message:`Feil ved oppdatering av /lagret for logg ${u}.`,error:l})}},[w,h,u,i,e,t,g]),m=!!r&&!n&&!!r?.bryterRetningslinjer;return{analyse:r,analyseError:n,validating:A,kiErrorBorder:M,harGodkjentKiFeil:c,setHarGodkjentKiFeil:d,loggId:u,hasChecked:D,showAnalysis:D&&m,erRedigeringAvPublisertTreff:w,validerMedKiOgLagreVedGodkjenning:H,onGodkjennKiFeil:P,watchedValue:L,control:R,setValue:t,getValues:j,kiLoggLoading:x}}export{N as u};
