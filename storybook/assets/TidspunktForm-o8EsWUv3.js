import{y as we,t as P,ah as xe,ai as Y,r as o,j as h,B as Z,aP as H,h4 as ee,hB as _,hb as ve,H as te,C as J}from"./iframe-Dbv-ZY6m.js";import{i as z,k as M}from"./utils-CCH58d7-.js";import{b as re}from"./useAutosave-D07gursF.js";import{p as ne}from"./parseISO-C6AtVv5J.js";import{f as se,m as Ce}from"./format-Bjj9PWS-.js";import{C as Se}from"./ComboboxProvider-CEuHV2Eh.js";import{i as R}from"./isSameDay-C8Vc0nyl.js";import{u as Ee,D as Q}from"./useDatepicker-DZNBOWwC.js";import"./Date.Input-BAQUwUKS.js";function Ie(e,n,s){return we(e,+P(e)+n)}function qe(e,n,s){return Ie(e,n*xe)}function je(e,n,s){const r=P(e,s?.in);return r.setTime(r.getTime()+n*Y),r}function Me(e){return n=>{const r=(e?Math[e]:Math.trunc)(n);return r===0?0:r}}function Ne(e,n){return+P(e)-+P(n)}function Be(e,n,s){const r=Ne(e,n)/Y;return Me(s?.roundingMethod)(r)}const K=[0,30],j=Array.from({length:24},(e,n)=>K.map(s=>`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`)).flat(),Oe=/^([01]\d|2[0-3]):([0-5]\d)$/,Re=e=>{const n=e.match(/^(\d{1,2})(?::?(\d{0,2}))?$/);if(!n)return null;const s=Math.min(parseInt(n[1]||"0",10)||0,23),r=parseInt(n[2]||"0",10)||0,c=K.reduce((u,l)=>Math.abs(l-r)<Math.abs(u-r)?l:u,K[0]);return`${String(s).padStart(2,"0")}:${String(c).padStart(2,"0")}`};function ie({value:e,onChange:n,onBlur:s,label:r="Klokkeslett",hideLabel:c,disabled:u,error:l,className:m,options:p,maxTime:d}){const f=o.useRef(null),y=o.useRef(!1),b=o.useRef(!1),D=o.useMemo(()=>{const t=p??j;return d?t.filter(a=>a<=d):t},[p,d]),[i,g]=o.useState(e??""),[I,C]=o.useState(!1),w=o.useRef(!1),$=o.useRef(e),S=o.useRef(!1),q=o.useRef(!1),E=o.useCallback(t=>Oe.test(t)&&(!d||t<=d),[d]),F=o.useCallback(t=>!t||/^[\d:]*$/.test(t),[]),le=o.useCallback((t,a)=>d&&a>d||t.includes(a)?t:[...t,a].sort(),[d]),V=e&&E(e)?le(D,e):D,N=o.useMemo(()=>V,[V]),U=()=>{const t=f.current;if(!t||typeof document>"u")return null;const a=t.getAttribute("aria-controls");return a?document.getElementById(a):null},ce=o.useCallback(()=>{if(y.current)return;const t=f.current;if(!t||t.getAttribute("aria-expanded")!=="true")return;const a=U();if(!a)return;let T=a.querySelector("[role='option'][aria-selected='true']");if(!T&&e&&(T=Array.from(a.querySelectorAll("[role='option']")).find(k=>k.textContent?.trim()===e)||null),!T)return;const v=T.closest("[role='listbox']")||T.parentElement;if(v){const k=T.offsetTop,O=k+T.offsetHeight,X=v.scrollTop,be=X+v.clientHeight;if(k<X+4){v.scrollTop=Math.max(k-4,0);return}if(O>be-4){const ke=Math.max(k-4,0);v.scrollTop=ke}}},[e]),A=o.useCallback(()=>{},[ce]),B=o.useCallback(t=>{const a=t.trim();return a===""?(w.current?e&&n(""):g(e??""),!0):E(a)?(a!==e&&n(a),!0):(g(e??""),!1)},[E,n,e]),de=o.useCallback(t=>{if(S.current&&t===""){S.current=!1;return}!w.current&&t!==""&&(w.current=!0),!(t===""&&!w.current)&&(g(t===""?"":t),t!==""&&C(!0))},[]),fe=o.useCallback(t=>{const a=t.relatedTarget,T=U(),v=b.current;if(b.current=!1,!v&&(q.current||(a&&T?T.contains(a):!1))){q.current=!1,s?.(t);return}if(q.current=!1,!w.current&&(i===""||i===$.current)){g(e??""),s?.(t);return}B(i),C(!0),s?.(t)},[B,i,s,e]),G=o.useCallback((t,a)=>{const T=V;let x=(k=>k&&E(k)?T.indexOf(k):-1)(t);if(x===-1){const k=Re(i);x=k?T.indexOf(k):-1}if(x===-1){const k=i||e||"",O=T.indexOf(k);x=O>=0?O:0}return T[(x+a+T.length)%T.length]},[V,E,i,e]),W=o.useCallback((t,a)=>{const T=G(t,a);w.current=!0,S.current=!0,g(T)},[G]),me=o.useCallback(t=>{const a=t.key;if(a==="ArrowDown"||a==="ArrowUp"){t.preventDefault(),t.stopPropagation(),W(i||e,a==="ArrowDown"?1:-1);return}if(a==="Enter"){S.current=!0,!B(i??"")&&e&&g(e),C(!0);return}if(a==="Tab"){b.current=!0,S.current=!0,!B(i??"")&&e&&g(e),C(!0);return}},[B,i,W,e]),pe=o.useCallback(t=>{const a=t.nativeEvent,T="data"in a?a.data:null;F(T)||t.preventDefault()},[F]),Te=o.useCallback(t=>{const a=t.clipboardData.getData("text");F(a)||t.preventDefault()},[F]),ge=o.useCallback(t=>{const a=t.target,T=a.tagName==="INPUT",v=a.getAttribute("role")==="option"||!!a.closest("[role='option']"),x=!!a.closest("[role='listbox']");(v||x)&&(q.current=!0),x&&(y.current=!0),T||v||x||(f.current?.focus(),t.preventDefault(),S.current=!0)},[]),he=o.useCallback(()=>{y.current=!1,w.current=!1,$.current=e,C(!1),S.current=!0,q.current=!1,b.current=!1,A()},[A,e]);o.useEffect(()=>g(e??""),[e]),o.useEffect(()=>{const t=f.current;if(!t)return;const a=new MutationObserver(()=>{t.getAttribute("aria-expanded")==="true"&&A()});return a.observe(t,{attributes:!0,attributeFilter:["aria-expanded"]}),()=>a.disconnect()},[A]);const De=o.useMemo(()=>{const t=i&&E(i)&&N.includes(i)?i:e&&E(e)&&N.includes(e)?e:void 0;return t?[t]:[]},[i,e,E,N]),ye=`${m??"w-[7rem]"} focus-within:outline-none focus-visible:outline-none focus-within:ring-0 focus-visible:ring-0`;return h.jsx(Se,{ref:f,label:r,hideLabel:c,disabled:u,error:l,className:ye,options:N,filteredOptions:N,allowNewValues:!0,toggleListButton:!0,isListOpen:I?!1:void 0,value:i,inputClassName:"min-w-0",shouldShowSelectedOptions:!1,selectedOptions:De,onMouseDownCapture:ge,onFocus:he,onToggleSelected:(t,a)=>{a&&(S.current=!0,q.current=!1,g(t),$.current=t,w.current=!1,n(t),C(!0))},onChange:de,onBlur:fe,onKeyDownCapture:me,onBeforeInput:pe,onPaste:Te})}ie.__docgenInfo={description:"",methods:[],displayName:"TimeInput",props:{value:{required:!1,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"ReactFocusEventHandler",raw:"React.FocusEventHandler<HTMLInputElement>",elements:[{name:"HTMLInputElement"}]},description:""},label:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Klokkeslett'",computed:!1}},hideLabel:{required:!1,tsType:{name:"boolean"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:""},error:{required:!1,tsType:{name:"union",raw:"ReactNode | boolean",elements:[{name:"ReactNode"},{name:"boolean"}]},description:""},className:{required:!1,tsType:{name:"string"},description:""},options:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},maxTime:{required:!1,tsType:{name:"string"},description:""}}};function ae(e,n,s,r=15){return o.useMemo(()=>{if(!e||!n||!z(s)||!R(e,n))return j;const c=M(n,s);if(!c)return j;const u=je(c,r);if(!R(c,u))return r>0?[]:j;const l=u.getTime(),m=r>0;return j.filter(d=>{const f=M(e,d);return f?m?f.getTime()>=l:f.getTime()<=l:!1})},[e,n,s,r])}function oe(e,n){const s=o.useRef(null);return o.useEffect(()=>()=>{s.current&&clearTimeout(s.current)},[]),{scheduleSave:o.useCallback(()=>{s.current&&clearTimeout(s.current),s.current=window.setTimeout(()=>{s.current=null,e(n)},0)},[e,n])}}function ue({label:e,value:n,onChange:s,onBlur:r,error:c,from:u=new Date,to:l=new Date("2040-12-31"),disabled:m}){const{inputProps:p,datepickerProps:d,selectedDay:f,setSelected:y}=Ee({defaultSelected:n??void 0,fromDate:u,toDate:l,onDateChange:i=>s(i??null)}),b=o.useCallback(i=>!i||/^[\d./-]*$/.test(i),[]);o.useEffect(()=>{const i=n??void 0,g=f??void 0;(i&&(!g||g.getTime()!==i.getTime())||!i&&g)&&y(i)},[n,f,y]);const D=i=>{p.onBlur?.(i),r?.()};return h.jsx(Q,{mode:"single",...d,children:h.jsx(Q.Input,{...p,hideLabel:!0,label:e,error:c?c.message||!0:void 0,disabled:m,onBlur:D,onBeforeInput:i=>{const g=i.nativeEvent,I="data"in g?g.data:null;if(!b(I)){i.preventDefault();return}p.onBeforeInput?.(i)},onPaste:i=>{const g=i.clipboardData.getData("text");if(!b(g)){i.preventDefault();return}p.onPaste?.(i)},placeholder:"dd.mm.책책책책"})})}ue.__docgenInfo={description:"",methods:[],displayName:"ControlledDatePicker",props:{label:{required:!0,tsType:{name:"string"},description:""},value:{required:!0,tsType:{name:"union",raw:"Date | null",elements:[{name:"Date"},{name:"null"}]},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(d: Date | null) => void",signature:{arguments:[{type:{name:"union",raw:"Date | null",elements:[{name:"Date"},{name:"null"}]},name:"d"}],return:{name:"void"}}},description:""},onBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},error:{required:!1,tsType:{name:"FieldError"},description:""},from:{required:!1,tsType:{name:"Date"},description:"",defaultValue:{value:"new Date()",computed:!1}},to:{required:!1,tsType:{name:"Date"},description:"",defaultValue:{value:"new Date('2040-12-31')",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:""}}};function L({label:e,nameDato:n,nameTid:s,control:r,disabledDato:c,disabledTid:u,hideDato:l,dateFrom:m,dateTo:p,timeOptions:d,onDatoBlur:f,onTidBlur:y,timeMax:b}){return h.jsxs("div",{className:"flex gap-4 items-start",children:[e&&h.jsx("div",{className:"flex items-center min-w-fit mt-3",children:h.jsx(Z,{size:"small",children:e})}),!l&&h.jsx(H,{name:n,control:r,rules:{required:"Dato er obligatorisk"},render:({field:D,fieldState:i})=>h.jsx(ue,{label:e??"",value:D.value,onChange:g=>D.onChange(g),onBlur:()=>{D.onBlur(),f?.()},error:i.error,disabled:c,from:m,to:p})}),l&&h.jsx(H,{name:n,control:r,render:({field:D})=>h.jsx("input",{type:"hidden",value:D.value?.toISOString()||"",onChange:()=>{}})}),h.jsx(H,{name:s,control:r,rules:{required:"Tid er obligatorisk"},render:({field:D,fieldState:i})=>h.jsx(ie,{value:D.value??"",onChange:D.onChange,label:"Klokkeslett",hideLabel:!0,error:i.error?.message,disabled:u,onBlur:()=>{D.onBlur(),y?.()},className:"w-24",options:d??j,maxTime:b})})]})}L.__docgenInfo={description:"",methods:[],displayName:"DatoTidRad",props:{label:{required:!1,tsType:{name:"string"},description:""},nameDato:{required:!0,tsType:{name:"Path",elements:[{name:"T"}],raw:"Path<T>"},description:""},nameTid:{required:!0,tsType:{name:"Path",elements:[{name:"T"}],raw:"Path<T>"},description:""},control:{required:!0,tsType:{name:"any"},description:""},disabledDato:{required:!1,tsType:{name:"boolean"},description:""},disabledTid:{required:!1,tsType:{name:"boolean"},description:""},hideDato:{required:!1,tsType:{name:"boolean"},description:""},dateFrom:{required:!1,tsType:{name:"Date"},description:""},dateTo:{required:!1,tsType:{name:"Date"},description:""},timeOptions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onDatoBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onTidBlur:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},timeMax:{required:!1,tsType:{name:"string"},description:""}}};const Fe=e=>e?ne(e):null,Ve=e=>e?se(ne(e),"HH:mm"):"",Ae=({control:e})=>{const{save:n}=re(),{setValue:s}=ee(),[r,c]=_({control:e,name:["svarfristDato","svarfristTid"]}),[u,l]=_({control:e,name:["fraDato","fraTid"]}),{treff:m}=ve(),{scheduleSave:p}=oe(n,["svarfristDato","svarfristTid"]),d=ae(r,u,l,0);return o.useEffect(()=>{m&&(!r&&m.svarfrist&&s("svarfristDato",Fe(m.svarfrist),{shouldValidate:!1,shouldDirty:!1}),!c&&m.svarfrist&&s("svarfristTid",Ve(m.svarfrist),{shouldValidate:!1,shouldDirty:!1}))},[m,r,c,s]),o.useEffect(()=>{if(!u||!z(l))return;const f=M(u,l),y=M(r??null,c??null);!f||!y||y.getTime()>f.getTime()&&(s("svarfristDato",new Date(u),{shouldDirty:!0,shouldValidate:!1}),s("svarfristTid",l,{shouldDirty:!0,shouldValidate:!1}),p())},[u,l,r,c,s,p]),h.jsxs("div",{className:"space-y-4",children:[h.jsx(te,{level:"3",size:"small",children:"Svarfrist"}),h.jsx("div",{children:h.jsx(L,{nameDato:"svarfristDato",nameTid:"svarfristTid",control:e,dateTo:u??void 0,timeOptions:d,onDatoBlur:p,onTidBlur:p})})]})};Ae.__docgenInfo={description:"",methods:[],displayName:"SvarfristForm",props:{control:{required:!0,tsType:{name:"any"},description:""}}};function Pe(e,n,s=1){return{adjustEndTime:o.useCallback((c,u,l,m,p,d)=>{if(!c||!z(u))return!1;const f=M(c,u);if(!f)return!1;const b=M(l??c,m),D=s>0;if(b?D?b.getTime()>f.getTime():b.getTime()<f.getTime():!1)return!1;const g=qe(f,s),I=J(g),C=se(g,"HH:mm");let w=!1;return(!l||J(l).getTime()!==I.getTime())&&(e(p,I,{shouldDirty:!0,shouldValidate:!1}),w=!0),m!==C&&(e(d,C,{shouldDirty:!0,shouldValidate:!1}),w=!0),w&&n(),w},[e,n,s])}}const Le=(e,n,s,r)=>{if(!e||!s)return"";const c=(m,p)=>{const[d,f]=p.split(":").map(Number),y=new Date(m);return y.setHours(d,f,0,0),y},u=c(e,n),l=c(s,r);if(R(u,l)){const m=Be(l,u);if(m===0)return"0 minutt";const p=Math.abs(m),d=Math.floor(p/60),f=p%60,y=m<0?"-":"",b=[];return d>0&&b.push(`${d} time${d>1?"r":""}`),f>0&&b.push(`${f} minutt`),`${y}${b.join(" ")}`}else{const m=Ce(l,u),p=m>=0?m+1:m;return`${p} dag${Math.abs(p)!==1?"er":""}`}},$e=({control:e})=>{const{setValue:n}=ee(),{save:s}=re(),[r,c,u,l]=_({control:e,name:["fraDato","fraTid","tilDato","tilTid"]}),[m,p]=o.useState(r&&u?!R(r,u):!1),{scheduleSave:d}=oe(s,["fraDato","fraTid","tilDato","tilTid","svarfristDato","svarfristTid"]),{adjustEndTime:f}=Pe(n,d,1),y=ae(u??r,r,c,1);o.useEffect(()=>{const D=r&&u?!R(r,u):!1;p(i=>i===D?i:D)},[r,u]),o.useEffect(()=>{f(r,c,u,l,"tilDato","tilTid")},[r,c,u,l,f]);const b=o.useMemo(()=>!r||!c||!l?"":Le(r,c,u??r,l),[r,c,u,l]);return h.jsxs("div",{className:"space-y-4",children:[h.jsx("div",{className:"flex justify-between items-center",children:h.jsx(te,{level:"3",size:"small",children:"Tid"})}),h.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[h.jsx(L,{nameDato:"fraDato",nameTid:"fraTid",control:e,onDatoBlur:d,onTidBlur:d,timeMax:"22:59"}),h.jsx(L,{label:"Til",nameDato:"tilDato",nameTid:"tilTid",control:e,hideDato:!m,dateFrom:r??void 0,timeOptions:y,onDatoBlur:d,onTidBlur:d}),h.jsx(Z,{size:"small",className:"mt-3",children:b||"Velg tid"})]})]})};$e.__docgenInfo={description:"",methods:[],displayName:"TidspunktForm",props:{control:{required:!0,tsType:{name:"any"},description:""}}};export{Ae as S,$e as T};
