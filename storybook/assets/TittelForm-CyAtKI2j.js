import{h4 as k,hE as E,r as j,j as e,H as R,aP as N,B as _,hb as I,e as G,Y as z,a0 as H}from"./iframe-CUkABeAB.js";import{b as O}from"./useAutosave-DG0Pw3Rf.js";import{u as X}from"./usePamPostdata-CTB2bqXI.js";import{T as P}from"./TextField-CGwItSZA.js";import{T as q,S as W}from"./TidspunktForm-BX2AwKyj.js";import{B as y}from"./Box-2klzx0AL.js";import{K as Y}from"./KiAnalyseIntro-C1UYtjpR.js";import{K as $}from"./KiAnalysePanel-DZgl-U4S.js";import{u as J}from"./useFormFeltMedKiValidering-Dh10cQ3u.js";import{M as F}from"./mutations-DaQUduVI.js";import{S as Q}from"./Skeleton-Dh8TGTWJ.js";const r={GATEADRESSE:"gateadresse",POSTNUMMER:"postnummer",POSTSTED:"poststed"},A=({control:a})=>{const{setValue:o,clearErrors:i,setError:h,trigger:x}=k(),{save:T}=O(),s=E({control:a,name:r.POSTNUMMER}),{data:d,isLoading:m}=X(s||"");return j.useEffect(()=>{!s||s.length!==4||m||(d?.korrigertNavnBy?(o(r.POSTSTED,d.korrigertNavnBy,{shouldDirty:!0,shouldValidate:!0}),i(r.POSTSTED)):(o(r.POSTSTED,"",{shouldDirty:!0,shouldValidate:!0}),h(r.POSTSTED,{type:"manual",message:"Ukjent poststed"})))},[s,m,d,o,h,i]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{level:"3",size:"small",children:"Sted"}),e.jsx(N,{name:r.GATEADRESSE,control:a,render:({field:n,fieldState:u})=>e.jsx(P,{...n,value:n.value??"",label:"Gateadresse",error:u.error?.message,onBlur:()=>{n.onBlur(),T([r.GATEADRESSE])}})}),e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(N,{name:r.POSTNUMMER,control:a,render:({field:n,fieldState:u})=>e.jsx(P,{...n,value:n.value??"",label:"Postnummer",htmlSize:12,error:u.error?.message,onChange:p=>{const c=p.target.value.replace(/\D/g,"");i([r.POSTNUMMER,r.POSTSTED]),o(r.POSTSTED,"",{shouldDirty:!1,shouldValidate:!0}),c.length<=4&&n.onChange(c),c.length===4&&x([r.POSTNUMMER])},onBlur:()=>{n.onBlur(),T([r.POSTNUMMER,r.POSTSTED])}})}),e.jsx(_,{className:`pt-8 ${E({control:a,name:r.POSTSTED})?"":"aksel-error-message"}`,children:E({control:a,name:r.POSTSTED})||(s&&s.length===4&&!m?"Ukjent poststed":"")})]})]})};A.__docgenInfo={description:"",methods:[],displayName:"StedForm"};const Z=()=>{const{control:a}=k();return e.jsxs("div",{className:"space-y-8",children:[e.jsx(R,{level:"2",size:"medium",children:"Praktiske forhold"}),e.jsx(y.New,{background:"neutral-moderate",borderRadius:"xlarge",padding:"3",children:e.jsx(q,{control:a})}),e.jsx(y.New,{background:"neutral-moderate",borderRadius:"xlarge",padding:"3",children:e.jsx(W,{control:a})}),e.jsx(y.New,{background:"neutral-moderate",borderRadius:"xlarge",padding:"3",children:e.jsx(A,{control:a})})]})};Z.__docgenInfo={description:"",methods:[],displayName:"PraktiskeForhold"};const M="Treff uten navn",B=({onUpdated:a})=>{const{treff:o,harPublisert:i}=I(),h=o?o.tittel??null:void 0,{clearErrors:x,formState:{isSubmitting:T}}=k(),s=j.useRef(null),{save:d}=O(),{analyse:m,analyseError:n,validating:u,kiErrorBorder:p,harGodkjentKiFeil:c,showAnalysis:w,erRedigeringAvPublisertTreff:V,runValidationAndMaybeSave:D,onGodkjennKiFeil:C,watchedValue:S,control:K,setValue:b,kiLoggLoading:v}=J({feltType:"tittel",fieldName:"tittel",savedValue:h,saveCallback:d,onUpdated:a}),L=F-(typeof S=="string"?S.length:0),U=()=>{b("tittel","",{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),s.current?.focus()};return j.useEffect(()=>{if(!o||v)return;const l=!i,g=(S??"").trim(),t=g.length===0||g===M;if(l&&t&&s.current){const f=setTimeout(()=>{s.current?.focus()},100);return()=>clearTimeout(f)}},[o,v,i]),e.jsxs("section",{className:"space-y-3",children:[v&&e.jsx(Q,{variant:"text"}),!v&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Navn på treffet"}),e.jsxs("div",{className:"relative w-full",children:[S&&e.jsx(G,{type:"button",onClick:U,"aria-label":"Tøm tittel feltet",variant:"tertiary",size:"small",className:"absolute right-2 top-[2rem] -translate-y-1/2 h-8 p-1",title:"Tøm feltet",children:e.jsx(z,{"aria-hidden":!0,fontSize:"1.25rem"})}),e.jsx("div",{className:"flex items-start",children:e.jsx(N,{control:K,name:"tittel",render:({field:l,fieldState:g})=>e.jsx(P,{...l,value:l.value??"",ref:t=>{l.ref(t),s.current=t},label:"Navn på treffet",hideLabel:!0,maxLength:F,className:"w-full pt-2",error:g.error?.message||(p?"Brudd på retningslinjer":void 0),"aria-invalid":!!(g.error||p),autoComplete:"off",autoCorrect:"off",spellCheck:!1,onChange:t=>{l.onChange(t),t.target.value.trim().length>0&&x("tittel")},onBlur:async()=>{l.onBlur(),setTimeout(async()=>{!u&&!T&&await D()},0)},onFocus:()=>{const t=l.value;if(!t||typeof t!="string")return;t.trim()===M&&b("tittel","",{shouldValidate:!1,shouldDirty:!1,shouldTouch:!1})},onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),(async()=>{const f=t.currentTarget;await D(),f?.blur()})())}})})})]}),e.jsxs(H,{className:"text-gray-400",children:[L," tegn igjen"]}),e.jsx($,{validating:u,analyse:m,analyseError:n,harGodkjentKiFeil:c,showAnalysis:w,erRedigeringAvPublisertTreff:V,onGodkjennKiFeil:C,ariaLabel:"Analyse av tittel"})]})]})};B.displayName="TittelForm";B.__docgenInfo={description:"",methods:[],displayName:"TittelForm",props:{onUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{Z as P,A as S,B as T};
