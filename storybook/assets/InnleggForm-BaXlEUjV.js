import{o as R,av as K,h5 as b,hA as N,ak as V,T as f,h2 as h,hB as j,h4 as x,r as k,w as D,hC as B,j as n,B as O,aP as M}from"./iframe-uCi_mQk4.js";import{f as $}from"./index-DZDgpI4e.js";import{u as H,s as _,e as G}from"./useRekrutteringstreffValidering-CE6rjwiH.js";import{K as J}from"./KiAnalyseIntro-B51RdPPF.js";import{K as U}from"./KiAnalysePanel-tnwPDBM_.js";import{u as X}from"./useFormFeltMedKiValidering-B10a2Tzp.js";import{R as q}from"./RikTekstEditor-64wo8FMy.js";import{S as z}from"./Skeleton-C9BU2TEp.js";const A=R({tittel:f().min(1,"Tittel kan ikke være tom"),htmlContent:f().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:f().nullable().optional(),opprettetAvPersonBeskrivelse:f().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:f().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),S=N,W=e=>`${b.internUrl}/${e}/innlegg`,Z=(e,t)=>`${b.internUrl}/${e}/innlegg/${t}`,Q=async(e,t)=>{A.parse(t);const r=await V(W(e),t);return S.parse(r)},Y=async(e,t,r)=>{A.parse(r);const o=await K(Z(e,t),r);return S.parse(o)};function ee(){const{rekrutteringstreffId:e,startLagring:t,stoppLagring:r}=h(),{data:o,mutate:a}=j(e),s=o?.[0],{getValues:g,setValue:l}=x();return{lagre:k.useCallback(async()=>{if(!e)return;const i=(g().htmlContent??"").toString();if(i.trim().length!==0)try{const d=s?.opprettetAvPersonNavn||s?.opprettetAvPersonNavident||"Markedskontakt",c={htmlContent:i,tittel:"Om treffet",opprettetAvPersonNavn:d,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:$(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};t("innlegg"),s?.id?await Y(e,s.id,c):await Q(e,c),a(),l("htmlContent",i,{shouldDirty:!1})}catch(d){new D({message:"Lagring av innlegg feilet.",error:d})}finally{r("innlegg")}},[g,s,a,e,t,r,l])}}function te(){const{rekrutteringstreffId:e}=h(),{data:t}=B(e),{getValues:r,trigger:o,formState:a}=x(),{lagre:s}=ee(),{harInnleggFeil:g,innleggKiFeil:l,innleggKiSjekket:m}=H();return{autosave:k.useCallback(async i=>{!e||_(t)||i&&i.length&&!await o(i,{shouldFocus:!1})||!((r().htmlContent??"").toString().trim().length>0)||g||l||!G(t)&&(!m||l)||await s()},[e,t,o,a,r,s,g,l,m])}}const ne="rediger-innlegg-htmlcontent-form",T=({onUpdated:e})=>{const{rekrutteringstreffId:t}=h(),{data:r,isLoading:o}=j(t),a=r?.[0],s=a?a.htmlContent??null:void 0,{autosave:g}=te(),[l,m]=k.useState(Date.now()),{analyse:p,analyseError:i,validating:d,kiErrorBorder:c,harGodkjentKiFeil:v,showAnalysis:y,erRedigeringAvPublisertTreff:w,validerMedKiOgLagreVedGodkjenning:E,onGodkjennKiFeil:F,control:L,setValue:I,kiLoggLoading:C}=X({feltType:"innlegg",fieldName:"htmlContent",savedValue:s,saveCallback:g,onUpdated:e,requireHasCheckedToShow:!0});return k.useEffect(()=>{const u=a?.htmlContent??"";I("htmlContent",u,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!1}),m(Date.now())},[I,a?.htmlContent]),n.jsx(n.Fragment,{children:n.jsxs("section",{className:"space-y-3",children:[n.jsx(J,{title:"Introduksjon"}),(o||C)&&n.jsx(z,{variant:"text"}),!o&&!C&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"space-y-2",children:n.jsx(O,{size:"small",textColor:"subtle",children:"Fortell jobbsøkeren om treffet: de unike fordelene, mulighetene, og oppgavene som de vil møte. For eksempel arbeidsgivere, forventninger, læring- og karrieremuligheter."})}),n.jsx("div",{className:`border rounded-lg ${c?"border-red-500":"border-gray-300"}`,onBlur:u=>{const P=u.currentTarget;setTimeout(async()=>{P.contains(document.activeElement)||await E()},0)},children:n.jsx(M,{name:"htmlContent",control:L,render:({field:u})=>n.jsx(q,{id:ne,tekst:u.value??"",onChange:u.onChange},l)})}),n.jsx(U,{validating:d,analyse:p,analyseError:i,harGodkjentKiFeil:v,showAnalysis:y,erRedigeringAvPublisertTreff:w,onGodkjennKiFeil:F,ariaLabel:"Analyse av innlegg"})]})]})})};T.displayName="InnleggForm";T.__docgenInfo={description:"",methods:[],displayName:"InnleggForm",props:{onUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{T as I};
