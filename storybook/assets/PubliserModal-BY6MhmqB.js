import{f as m,X as D,u as q,r,bg as G,J as X,bt as Q,aB as Y,j as e,d as h,H as M,F as Z,cC as ee,x as se}from"./iframe-CnM7RT4h.js";import{D as w}from"./DatoVelger-CK38w0Va.js";import{p as T}from"./parse-DTRzWOAH.js";import{p as te}from"./parseISO-Bt1F7znG.js";import{U as ie}from"./umamiEvents-DmzFNrn7.js";import{M as b}from"./Modal-EGw49zjI.js";import{B as re}from"./Box-KSbBkdlM.js";import{a as le}from"./Checkbox-DMHXfjoN.js";import{T as f}from"./ToggleGroup-BkmucQj-.js";import{T as I}from"./TextField-CKELRIUm.js";const ne=s=>s.replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})(?!:)/,"$1:00").replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\.(\d{3})\d+(.*)$/,"$1.$2$3"),P=s=>{if(!s)return null;if(/^\d{2}\.\d{2}\.\d{4}$/.test(s)){const o=T(s,"dd.MM.yyyy",new Date);return D(o)?m(o,"yyyy-MM-dd'T'00:00:00"):null}const l=te(ne(s));return D(l)?m(l,"yyyy-MM-dd'T'HH:mm:ss"):null},oe=s=>{const l=P(s.stilling?.published),o=P(s.stilling?.expires);return{...s,stilling:{...s.stilling,properties:{...s.stilling.properties,tags:typeof s.stilling?.properties?.tags=="string"?s.stilling?.properties?.tags:JSON.stringify(s.stilling?.properties?.tags??[]),workday:typeof s.stilling?.properties?.workday=="string"?s.stilling?.properties?.workday:JSON.stringify(s.stilling?.properties?.workday??[]),workhours:typeof s.stilling?.properties?.workhours=="string"?s.stilling?.properties?.workhours:JSON.stringify(s.stilling?.properties?.workhours??[])},published:l,expires:o}}};function ae({disabled:s}){const{brukerData:l,valgtNavKontor:o}=q(),p=r.useRef(null),{watch:a,setValue:n,getValues:y}=G(),{track:O}=X(),C=Q(),E=a("stilling.privacy"),L=a("stilling.published"),H=a("stilling.expires"),A=a("stilling.properties.applicationemail"),k=a("stilling.properties.applicationurl"),[V,x]=r.useState(!1),_=Y(y().stilling.uuid),v=t=>{if(t)try{return m(new Date(t),"dd.MM.yyyy")}catch{return}},[u,B]=r.useState(v(L)),[g,F]=r.useState(v(H)),[c,$]=r.useState(E==="SHOW_ALL"),z=k?"url":"email",[d,J]=r.useState(z),[j,R]=r.useState(A??""),[S,U]=r.useState(k??""),N=t=>{if(!t)return null;const i=T(t,"dd.MM.yyyy",new Date);return m(i,"yyyy-MM-dd'T'HH:mm:ss")},K=async()=>{x(!0);try{n("stilling.published",N(u),{shouldDirty:!0}),n("stilling.expires",N(g),{shouldDirty:!0}),n("stilling.privacy",c?"SHOW_ALL":"INTERNAL_NOT_SHOWN",{shouldDirty:!0}),c&&(d==="email"?(n("stilling.properties.applicationemail",j||null,{shouldDirty:!0}),n("stilling.properties.applicationurl",null,{shouldDirty:!0})):(n("stilling.properties.applicationurl",S||null,{shouldDirty:!0}),n("stilling.properties.applicationemail",null,{shouldDirty:!0})));const t=oe(y()),i={...t,stillingsinfo:{...t.stillingsinfo},stilling:{...t.stilling,status:"ACTIVE",administration:{...t.stilling.administration,status:"DONE"},firstPublished:!0}};O(ie.Stilling.ny_stilling_info,{yrkestittel:i.stilling.categoryList?.[0]?.name,sektor:i.stilling.properties?.sector,ansettelsesform:i.stilling.properties?.engagementtype,arbeidstidsordning:i.stilling?.properties?.jobarrangement,omfangIProsent:i.stilling.properties?.jobpercentage,arbeidssted:i.stilling.locationList});try{await ee(i,{eierNavident:l.ident,eierNavn:l.navn,eierNavKontorEnhetId:o?.navKontor})}catch(W){alert("Feil ved opprettelse av stilling"),new se({message:"Feil ved opprettelse av stilling",error:W})}p.current?.close(),_.mutate(),C.push(`/stilling/${y().stilling.uuid}`)}catch{alert("Uventet feil ved publisering")}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"small",disabled:s,onClick:()=>p.current?.showModal(),children:"Publiser"}),e.jsxs(b,{ref:p,header:{heading:"Publiser stillingsoppdraget"},children:[e.jsxs(b.Body,{children:[e.jsxs(re.New,{background:"neutral-soft",padding:"6",className:"mb-8",children:[e.jsx(M,{size:"small",className:"mb-2",children:"Dette skjer når du publiserer oppdraget"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm mb-4",children:[e.jsx("li",{children:"Stillingsoppdraget blir synlig for Nav-ansatte i rekrutteringsbistand."}),e.jsx("li",{children:"Ansatte hos arbeidsgiveren på Min Side Arbeidsgiver på nav.no (med Altinn-tilgang)."}),e.jsx("li",{children:"Jobbsøkere som får stillingen delt i aktivitetsplanen."})]}),e.jsx(Z,{size:"small",children:"Ikke alt må være helt perfekt! Du kan når som helst endre eller avpublisere oppdraget."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(w,{disablePastDates:!0,label:"Publiseringsdato",valgtDato:u,tilDato:g,setDato:t=>B(t)}),e.jsx(w,{disablePastDates:!0,label:"Siste visningsdato",valgtDato:g,fraDato:u,setDato:t=>F(t)})]}),e.jsx(le,{checked:c,onChange:t=>$(t.target.checked),children:"Publiser stillingsoppdraget offentlig på arbeidsplassen.no også"}),c&&e.jsxs("div",{children:[e.jsx(M,{size:"small",className:"mb-4",children:"Hvordan skal jobbsøker søke?"}),e.jsxs(f,{fill:!0,defaultValue:d,onChange:t=>J(t),children:[e.jsx(f.Item,{value:"email",label:"E-post"}),e.jsx(f.Item,{value:"url",label:"Søknadsskjema"})]}),d==="email"&&e.jsx("div",{className:"mt-4",children:e.jsx(I,{label:"E-post",value:j,onChange:t=>R(t.target.value)})}),d==="url"&&e.jsx("div",{className:"mt-4",children:e.jsx(I,{label:"Lenke til søknadsskjema",value:S,onChange:t=>U(t.target.value)})})]})]})]}),e.jsxs(b.Footer,{children:[e.jsx(h,{loading:V,type:"button",onClick:K,children:"Publiser oppdraget"}),e.jsx(h,{type:"button",variant:"secondary",onClick:()=>p.current?.close(),children:"Avbryt"})]})]})]})}ae.__docgenInfo={description:"",methods:[],displayName:"PubliserModal",props:{disabled:{required:!0,tsType:{name:"boolean"},description:""}}};export{ae as P,oe as m};
