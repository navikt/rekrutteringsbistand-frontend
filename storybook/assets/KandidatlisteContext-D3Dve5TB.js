import{j as r,cx as v,ci as m,r as K,w as C,am as j}from"./iframe-DhZ6odjH.js";import{O as D}from"./OrganisasjonsnummerAlert-BviJ9JMB.js";import{K as d,a as e}from"./KandidatHendelseTag-ClNTVVbc.js";import{f as y}from"./util-TPcHwbXL.js";import{i as R}from"./isBefore-DPyoQYA2.js";import{a as V}from"./util-DPdujr1q.js";const F=t=>{const a=y({dato:t.svarfrist,visning:"tall"}),n=t.svarfrist?R(new Date(t.svarfrist),new Date):!1,s={dato:new Date(t.deltTidspunkt),raw:t};switch(t.tilstand){case v.IKKE_SENDT:case v.PROVER_VARSLING:return{tag:r.jsx(d,{type:e.Spurt_om_å_dele_CV,dato:a}),type:e.Spurt_om_å_dele_CV,tekst:"Prøver varsling",...s};case v.HAR_VARSLET:return{tag:r.jsx(d,{type:e.Spurt_om_å_dele_CV,dato:a}),type:e.Spurt_om_å_dele_CV,dato:new Date(t.deltTidspunkt),tekst:`av ${t.deltAv}`,raw:t};case v.KAN_IKKE_VARSLE:return{tag:r.jsx(d,{type:e.Spurt_om_å_dele_CV_IKKE_DIGITAL,dato:a}),type:e.Spurt_om_å_dele_CV_IKKE_DIGITAL,tekst:"Kandidaten bruker ikke digitale tjenester fra Nav. Du må ringe og registrere svaret i stillingskortet i Aktivitetsplanen.",...s};case v.KAN_IKKE_OPPRETTE:return{tag:r.jsx(d,{type:e.Deling_Av_CV_Feilet,dato:a}),type:e.Deling_Av_CV_Feilet,tekst:"Kan ikke opprette forespørsel",...s};case v.AVBRUTT:return t.deltStatus==="SENDT"&&n?{tag:r.jsx(d,{type:e.Frist_for_deling_av_cv_utløpt,dato:a}),type:e.Frist_for_deling_av_cv_utløpt,tekst:`Frist for deling av CV utløpt ${t.svarfrist&&y({dato:t.svarfrist})}`,...s}:{type:e.Avbrutt_i_aktivitetsplanen,tag:r.jsx(d,{type:e.Avbrutt_i_aktivitetsplanen}),...s};case v.HAR_SVART:return t.svar?.harSvartJa?{tag:r.jsx(d,{type:e.Deling_av_CV_JA,dato:a}),type:e.Deling_av_CV_JA,tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&y({dato:t.svar?.svarTidspunkt})}`,...s}:{type:e.Deling_av_CV_NEI,tag:r.jsx(d,{type:e.Deling_av_CV_NEI,dato:a}),tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&y({dato:t.svar?.svarTidspunkt})}`,...s};default:return{type:null,tag:r.jsx(d,{type:null}),...s}}},w=(t,a=!1,n,s)=>{const o={dato:new Date(t.tidspunkt),raw:t};if(n&&s===0&&n.length>=2&&t.utfall===m.PRESENTERT&&n[1].utfall===m.FATT_JOBBEN)return{type:e.Fjernet_fått_jobben,...o,tag:r.jsx(d,{type:e.Fjernet_fått_jobben}),tekst:""};switch(t.utfall){case m.FATT_JOBBEN:return{type:e.Fått_jobben,...o,tag:r.jsx(d,{type:e.Fått_jobben})};case m.IKKE_PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste===!1&&a?{...o,tag:r.jsx(d,{type:e.CV_slettet_hos_arbeidsgiver}),type:e.CV_slettet_hos_arbeidsgiver,tekst:e.CV_slettet_hos_arbeidsgiver}:{type:null,...o};case m.PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste?{...o,type:e.CV_delt_med_arbeidsgiver,tag:r.jsx(d,{type:e.CV_delt_med_arbeidsgiver})}:{...o,type:null};default:return{...o,type:null,tag:r.jsx(d,{type:null})}}},I=({kandidat:t,forespørselCvForKandidat:a,beskjedForKandidat:n})=>{const s=t.utfallsendringer?.some(i=>i.utfall===m.PRESENTERT&&i.sendtTilArbeidsgiversKandidatliste),o=t.utfallsendringer?.map((i,u)=>w(i,s,t.utfallsendringer,u)),_=a?.map(i=>F(i));let p=null;n!==null&&n?.opprettet&&(p={type:n?.eksternStatus?.includes("FEIL")?e.SMS_FEIL:e.SMS_OK,tag:r.jsx(d,{type:n?.eksternStatus?.includes("FEIL")?e.SMS_FEIL:e.SMS_OK}),tekst:V((n?.eksternFeilmelding||"").replace(/[_-]/g," ")),dato:new Date(n?.opprettet),raw:n});const l=p?[p]:[],c=[..._??[],...o??[]].filter(i=>i.type!==null).sort((i,u)=>(u.dato?.getTime()||0)-(i.dato?.getTime()||0))[0],T=l?l.sort((i,u)=>(u.dato?.getTime()||0)-(i.dato?.getTime()||0))[0]:null;return{utfallsendringer:o,cvHendelser:_,varsler:l,sisteSms:T,sisteHendelse:c}},b=(t,a,n)=>{const s=t.aktørid&&a?a[t.aktørid]:null,o=n&&n[t.fodselsnr??""],_=I({kandidat:t,forespørselCvForKandidat:s,beskjedForKandidat:o});return{...t,kandidatHendelser:_}},E=K.createContext(void 0),h=({children:t,kandidatliste:a,forespurteKandidater:n,beskjeder:s,reFetchKandidatliste:o})=>{const{stillingsData:_,kandidatlisteInfo:p}=j(),[l,c]=K.useState([]),T=p?.kandidatlisteStatus==="LUKKET",f=a?.organisasjonReferanse,i=_?.stilling?.employer?.orgnr,u=!!(f&&i&&f!==i),k=g=>{if(c&&l){const A=l.some(S=>S.fodselsnr===g.fodselsnr)?l.filter(S=>S.fodselsnr!==g.fodselsnr):[...l,g];c(A)}},x=a.kandidater?a.kandidater.map(g=>b(g,n,s)):[];return r.jsxs(E.Provider,{value:{forespurteKandidater:n,beskjeder:s,markerteKandidater:l,setMarkerteKandidater:c,lukketKandidatliste:T,reFetchKandidatliste:o,toggleMarkerKandidat:k,kandidatlisteId:a.kandidatlisteId,usynligeKandidater:a.formidlingerAvUsynligKandidat,kandidater:x,kandidatlisteRawData:a},children:[u&&r.jsx(D,{}),t]})},$=()=>{const t=K.useContext(E);if(t===void 0)throw new C({message:"Context er undefined, må være children av KandidatlisteContextProvider."});return t};h.__docgenInfo={description:"",methods:[],displayName:"KandidatlisteContextProvider",props:{children:{required:!1,tsType:{name:"union",raw:"ReactNode | undefined",elements:[{name:"ReactNode"},{name:"undefined"}]},description:""},kandidatliste:{required:!0,tsType:{name:"z.infer",elements:[{name:"kandidatlisteSchema"}],raw:"z.infer<typeof kandidatlisteSchema>"},description:""},forespurteKandidater:{required:!0,tsType:{name:"z.infer",elements:[{name:"ForespurteOmDelingAvCvSchema"}],raw:`z.infer<
  typeof ForespurteOmDelingAvCvSchema
>`},description:""},beskjeder:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"z.infer",elements:[{name:"SmsSchema"}],raw:"z.infer<typeof SmsSchema>"}],raw:"Record<string, Sms>"},description:""},reFetchKandidatliste:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{h as K,$ as u};
