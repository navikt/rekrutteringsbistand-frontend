import{r as m,j as e,e as g,x as N,w as z,h4 as L,L as O,B as k}from"./iframe-DTHA2nxD.js";import{g as q}from"./PubliserRekrutteringstreffButton-Cf4rRvc1.js";import{M as p}from"./Modal-Ds-AniFV.js";import{t as D,f as _}from"./utils-v2fEqnp5.js";const A=({rekrutteringstreffId:n,oppdaterData:t})=>{const[r,s]=m.useState(!1),i=m.useRef(null),d=()=>i.current?.showModal(),o=()=>{r||i.current?.close()},c=async()=>{if(r)return;s(!0);let l=!1;try{await q(n),t(),l=!0}catch(h){new z({message:"Gjenåpning av rekrutteringstreff feilet",error:h})}finally{s(!1),l&&i.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"button",size:"small",variant:"primary",loading:r,onClick:d,children:"Gjenåpne"}),e.jsxs(p,{ref:i,onClose:()=>{r&&i.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(p.Body,{children:e.jsx(N,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(p.Footer,{children:[e.jsx(g,{type:"button",size:"small",loading:r,onClick:()=>void c(),children:"Gjenåpne"}),e.jsx(g,{type:"button",size:"small",variant:"secondary",disabled:r,onClick:o,children:"Avbryt"})]})]})]})};A.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const f=(n,t)=>{if(!n)return null;const r=t?.trim()||"00:00";return D(n,r)},x=n=>n?_(n):"",u=(n,t,r,s,i)=>{const d=l=>i?i(l):l??"",o=d(r),c=d(s);o!==c&&n.push({etikett:t,gammelVerdi:o,nyVerdi:c})},J=(n,t,r)=>{const s=[],i=f(n.fraDato,n.fraTid)??t?.fraTid,d=f(n.tilDato??n.fraDato,n.tilTid)??t?.tilTid,o=f(n.svarfristDato,n.svarfristTid)??t?.svarfrist,c=n.tittel?.trim()||t?.tittel||"";return u(s,"Tittel",t?.tittel,c),u(s,"Beskrivelse",t?.beskrivelse,n.beskrivelse??t?.beskrivelse),u(s,"Fra",t?.fraTid,i,x),u(s,"Til",t?.tilTid,d,x),u(s,"Svarfrist",t?.svarfrist,o,x),u(s,"Gateadresse",t?.gateadresse,n.gateadresse??t?.gateadresse),u(s,"Postnummer",t?.postnummer,n.postnummer??t?.postnummer),u(s,"Poststed",t?.poststed,n.poststed??t?.poststed),(r||"")!==(n.htmlContent||"")&&s.push({etikett:"Innlegg",gammelVerdi:"Innhold endret",nyVerdi:"Innhold endret"}),s},H=({disabled:n,treff:t,innleggHtmlFraBackend:r,onBekreft:s})=>{const i=m.useRef(null),{getValues:d,watch:o,formState:c}=L(),[l,h]=m.useState([]);m.useEffect(()=>{if(!t){h([]);return}const a=()=>{const V=d(),R=J(V,t,r||"");h(w=>JSON.stringify(w)===JSON.stringify(R)?w:R)};a();const y=o(a);return()=>y.unsubscribe()},[t,o,d,r]);const b=o("tittelKiSjekket")??!1,v=o("innleggKiSjekket")??!1,E=o("tittelKiFeil")??!1,M=o("innleggKiFeil")??!1,C=E||M,K=!!(c.errors&&Object.keys(c.errors).some(a=>a!=="root")),T=C||K,S=t?.tittel?.trim()==="Treff uten navn",B=l.some(a=>a.etikett==="Tittel"),F=l.some(a=>a.etikett==="Innlegg"),j=m.useMemo(()=>{const a=l.length===0;return n||a||T||!((!B||b)&&(!F||v))||S},[n,l.length,T,B,F,b,v,S]),G=()=>!j&&i.current?.showModal(),I=()=>i.current?.close(),P=async()=>{j||(I(),await s())};return e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"button",variant:"primary",size:"small",disabled:j,onClick:G,children:"Publiser på nytt"}),e.jsxs(p,{ref:i,header:{heading:"Følgende endringer vil bli publisert"},children:[e.jsx(p.Body,{children:e.jsxs("div",{className:"space-y-3",children:[l.length===0?e.jsx(N,{children:"Ingen endringer oppdaget."}):e.jsx("div",{className:"space-y-3",children:l.map((a,y)=>e.jsxs("div",{className:"border-b pb-2",children:[e.jsx(O,{size:"small",children:a.etikett}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Fra:"}),e.jsx(k,{className:"text-gray-400",children:a.gammelVerdi||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Til:"}),e.jsx(k,{className:"text-gray-400",children:a.nyVerdi||"—"})]})]},y))}),e.jsx(k,{className:"text-gray-600",children:"Inviterte deltakere vil ikke bli informert om endringene på nytt av republiseringen"})]})}),e.jsxs(p.Footer,{children:[e.jsx(g,{type:"button",variant:"primary",size:"small",disabled:j,onClick:P,children:"Publiser på nytt"}),e.jsx(g,{type:"button",variant:"secondary",size:"small",onClick:I,children:"Avbryt"})]})]})]})};H.__docgenInfo={description:"",methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{disabled:{required:!1,tsType:{name:"boolean"},description:""},treff:{required:!0,tsType:{name:"any"},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},onBekreft:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""}}};export{A as G,H as R};
