import{e as z,a as B}from"./useAutosave-DHkNhXEh.js";import{h5 as J,o as x,ak as O,T as w,U as Q,h2 as X,hC as Y,h4 as Z,hE as _,r as a,w as b}from"./iframe-05oBaVfn.js";import{a as N,u as ee}from"./useKiLogg-0yYCIRls.js";const te=(t=":id")=>`${J.internUrl}/${t}/ki/valider`,re=x({feltType:w(),tekst:w()}),se=x({loggId:w(),bryterRetningslinjer:Q(),begrunnelse:w()}),ae=async(t,{arg:e})=>{const g=e.tekst.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),k={...e,tekst:g};re.parse(e);const y=await O(t,k);return se.parse(y)},ne=t=>N(te(t??":id"),ae),M=t=>t==null?"":String(t).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function de({feltType:t,fieldName:e,savedValue:g,saveCallback:k,onUpdated:y,requireHasCheckedToShow:D=!1}){const{rekrutteringstreffId:S}=X(),{data:T}=Y(S),{control:v,setValue:s,getValues:j,trigger:V}=Z(),{setLagret:n,isLoading:P}=ee(S,t),F=_({control:v,name:e}),c=z(T)&&B(),{trigger:L,data:r,reset:m,error:u,isMutating:U}=ne(S),[d,C]=a.useState(null),[i,R]=a.useState(!1),[I,E]=a.useState(!1);a.useEffect(()=>{E(!1),R(!1),C(null),m(),s(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[F,m,e,s]);const G=!!r&&!u&&r?.bryterRetningslinjer&&!i;a.useEffect(()=>{const o=!!r&&!u&&!!r?.bryterRetningslinjer&&!i;s(`${e}KiFeil`,o,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[r,u,i,e,s]);const p=a.useCallback(async o=>{try{await k([e],o)}catch(f){new b({message:`Lagring av ${t} feilet.`,error:f})}finally{y?.()}},[k,e,t,y]),H=a.useCallback(async()=>{if(!await V(e))return;const f=j(e),K=(typeof f=="string"?f:String(f??"")).trim(),A=M(K);if(A){if(g!==void 0){const l=M(g);if(A===l)return}try{const l=await L({feltType:t,tekst:K});E(!0),s(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const h=l?.loggId??r?.loggId??null;if(C(h),(!(l?.bryterRetningslinjer??r?.bryterRetningslinjer)||i)&&!c&&(await p(!1),h&&n))try{await n({id:h,lagret:!0})}catch(q){new b({message:`Feil ved oppdatering av /lagret for logg ${h}.`,error:q})}}catch(l){new b({message:"Validation failed:",error:l}),E(!0),s(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[V,e,j,L,t,i,c,p,n,r,s,g]),W=a.useCallback(async()=>{if(c){R(!0);return}if(R(!0),await p(!0),d&&n)try{await n({id:d,lagret:!0})}catch(o){new b({message:`Feil ved oppdatering av /lagret for logg ${d}.`,error:o})}},[c,p,d,n]),$=!!r&&!u&&!!r?.bryterRetningslinjer;return{analyse:r,analyseError:u,validating:U,kiErrorBorder:G,forceSave:i,setForceSave:R,loggId:d,hasChecked:I,showAnalysis:D?I&&$:$,erRedigeringAvPublisertTreff:c,runValidationAndMaybeSave:H,onForceSave:W,watchedValue:F,control:v,setValue:s,getValues:j,kiLoggLoading:P}}export{de as u};
