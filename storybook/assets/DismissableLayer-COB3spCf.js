import{r as l,aj as A,W as M,R as O,h as H,G as V,l as P}from"./iframe-B3f5JsBL.js";import{a as Z}from"./owner-CO0wgQ-G.js";import{a as C}from"./useControllableState-CmSO-Fnv.js";function G(r,n){const i=[],t=new Set,e=new Map;n.forEach((d,c)=>{d.forEach(f=>{f!==c&&e.set(f,c)})});const o=d=>{if(t.has(d))return;const c=e.get(d);if(c&&!t.has(c)&&(o(c),t.has(d)))return;t.add(d),i.push(d);const f=n.get(d);f&&f.forEach(o)};return r.forEach(o),i}function X(r,n=globalThis?.document,i=!0){const t=C(r);l.useEffect(()=>{if(!i)return;const e=o=>{o.key==="Escape"&&t(o)};return n.addEventListener("keydown",e,!0),()=>{n.removeEventListener("keydown",e,!0)}},[t,n,i])}const F={FOCUS_OUTSIDE:"AKSEL_FOCUS_OUTSIDE",POINTER_DOWN_OUTSIDE:"AKSEL_POINTER_DOWN_OUTSIDE"};function U(r,n,i,{discrete:t}={discrete:!1}){if(!n)return;const e=i.originalEvent.target,o=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:i});e.addEventListener(r,n,{once:!0}),t&&e?A.flushSync(()=>e.dispatchEvent(o)):e.dispatchEvent(o)}function q(r,n=globalThis?.document,i=!0){const t=C(r),e=l.useRef(!1);return l.useEffect(()=>{if(!i)return;const o=d=>{if(d.target&&!e.current){const c={originalEvent:d};U(F.FOCUS_OUTSIDE,t,c)}};return n.addEventListener("focusin",o),()=>{n.removeEventListener("focusin",o)}},[n,t,i]),{onFocusCapture:()=>{e.current=!0},onBlurCapture:()=>{e.current=!1}}}function J(r,n=globalThis?.document,i=!0){const t=C(r),e=l.useRef(!1),o=l.useRef(()=>{}),d=M();return l.useEffect(()=>{if(!i)return;const c=f=>{function E(){U(F.POINTER_DOWN_OUTSIDE,t,{originalEvent:f},{discrete:!0})}f.target&&!e.current?f.pointerType==="touch"?(n.removeEventListener("click",o.current),o.current=E,n.addEventListener("click",o.current,{once:!0})):E():n.removeEventListener("click",o.current),e.current=!1};return d.start(0,()=>{n.addEventListener("pointerdown",c)}),()=>{n.removeEventListener("pointerdown",c),n.removeEventListener("click",o.current)}},[n,t,d,i]),{onPointerDownCapture:()=>{e.current=!0}}}var Q=function(r,n){var i={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&n.indexOf(t)<0&&(i[t]=r[t]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,t=Object.getOwnPropertySymbols(r);e<t.length;e++)n.indexOf(t[e])<0&&Object.prototype.propertyIsEnumerable.call(r,t[e])&&(i[t[e]]=r[t[e]]);return i};const _=O.createContext(null),D="dismissableLayer.update";let x;const Y=O.createContext({layers:new Set,branchedLayers:new Map,layersWithOutsidePointerEventsDisabled:new Set}),re=l.forwardRef((r,n)=>{var{children:i,disableOutsidePointerEvents:t,onDismiss:e,onInteractOutside:o,onEscapeKeyDown:d,onFocusOutside:c,onPointerDownOutside:f,safeZone:E,asChild:W,enabled:h=!0}=r,y=Q(r,["children","disableOutsidePointerEvents","onDismiss","onInteractOutside","onEscapeKeyDown","onFocusOutside","onPointerDownOutside","safeZone","asChild","enabled"]);const a=l.useContext(Y),[,k]=l.useState({}),[u,N]=O.useState(null),B=H(n,N),v=Z(u),L=G(a.layers,a.branchedLayers),T=$(L,a.layersWithOutsidePointerEventsDisabled),m=u?L.indexOf(u):-1,j=a.layersWithOutsidePointerEventsDisabled.size>0,w=T===-1||m>=T;function S(s){if(!E?.anchor)return;let g=!1;s.defaultPrevented||s.detail.originalEvent.type==="pointerdown"&&(g=!0);const R=s.target;(E.anchor.contains(R)||R===E.anchor)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&g&&s.preventDefault()}const K=J(s=>{w&&(f?.(s),o?.(s),E&&S(s),!s.defaultPrevented&&e&&e())},v,h),I=q(s=>{c?.(s),o?.(s),E&&S(s),!s.defaultPrevented&&e&&e()},v,h);X(s=>{m===a.layers.size-1&&(d?.(s),!s.defaultPrevented&&e&&(s.preventDefault(),e()))},v,h),l.useEffect(()=>{if(!(!u||!h))return t&&(a.layersWithOutsidePointerEventsDisabled.size===0&&(x=v.body.style.pointerEvents,v.body.style.pointerEvents="none"),a.layersWithOutsidePointerEventsDisabled.add(u)),a.layers.add(u),b(),()=>{t&&a.layersWithOutsidePointerEventsDisabled.size===1&&(v.body.style.pointerEvents=x)}},[u,h,t,a,v]),l.useEffect(()=>()=>{u&&(a.layers.has(u)||a.layersWithOutsidePointerEventsDisabled.has(u))&&(a.layers.delete(u),a.layersWithOutsidePointerEventsDisabled.delete(u),b())},[u,a,h]);const p=l.useContext(_);l.useEffect(()=>{if(!u||!h||!p||u===p)return;a.branchedLayers.has(p)||a.branchedLayers.set(p,new Set);const s=a.branchedLayers.get(p);return s.add(u),b(),()=>{s.delete(u),s.size===0&&a.branchedLayers.delete(p),b()}},[u,h,p,a]),l.useEffect(()=>{const s=()=>k({});return document.addEventListener(D,s),()=>document.removeEventListener(D,s)},[]);const z=W?V:"div";return O.createElement(_.Provider,{value:u},O.createElement(z,Object.assign({},y,{ref:B,style:Object.assign({pointerEvents:j?w?"auto":"none":void 0},y.style),onFocusCapture:P(y.onFocusCapture,I.onFocusCapture),onBlurCapture:P(y.onBlurCapture,I.onBlurCapture),onPointerDownCapture:P(y.onPointerDownCapture,K.onPointerDownCapture)}),i))});function b(){const r=new CustomEvent(D);document.dispatchEvent(r)}function $(r,n){for(let i=r.length-1;i>=0;i-=1)if(n.has(r[i]))return i;return-1}export{re as D};
