import{u as L,c as E,ac as J,r as h,aD as R,aM as O,aN as r,aE as M,aO as U,j as e,e as u,A,B as j,L as _,h as q}from"./iframe-Bs62DkEX.js";import{U as P}from"./umamiEvents-DmzFNrn7.js";import{S as $}from"./ArrowForward-DP4disbp.js";import{M as S}from"./Modal-D_wK6Ohn.js";import{A as d}from"./Accordion-BWYOs60D.js";import{T as n}from"./Table-CQVWa3L6.js";import{S as G}from"./Select-DFspM0qT.js";const Q="_sendSmsModal_me9a7_1",W="_velgMal_me9a7_5",X="_kontortidAdvarsel_me9a7_18",f={sendSmsModal:Q,velgMal:W,kontortidAdvarsel:X},Y=l=>{const{visVarsel:t}=L(),{fjernAllMarkering:C,markerteKandidater:a}=l,{track:D}=E(),{stillingsData:o}=J(),m=o?.stillingsinfo?.stillingskategori,w=o.stilling.uuid,[F,i]=h.useState(!1),{data:p={}}=R(m==="FORMIDLING"?null:o.stilling.uuid),N=O(),[T,x]=h.useState(!1),c=a.filter(s=>s.fodselsnr&&p[s.fodselsnr]),g=a.filter(s=>!(s.fodselsnr&&p[s.fodselsnr])),K=a.some(s=>s.fodselsnr===null),[v,z]=h.useState(m===M.Jobbmesse?r.Jobbarrangement:r.VurdertSomAktuell),{data:b}=U(),k=a.map(s=>s.fodselsnr),H=async()=>{if(x(!0),k.length===0){t({tekst:"Ingen kandidater valgt",type:"warning"});return}try{await N({mal:v,fnr:k.filter(s=>s!==null),stillingId:w}),D(P.Stilling.send_beskjed_til_kandidat,{antall:k.length}),t({tekst:"Beskjed er sendt",type:"success"}),C(),i(!1)}catch(s){new q({message:"Klarte ikke å sende SMS:",error:s}),t({tekst:s instanceof Error?`Feil ved sending: ${s.message}`:"Det skjedde en uventet feil ved sending av beskjed",type:"error"})}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(u,{disabled:a.length===0,onClick:()=>i(!0),size:l.sidebar?"small":"medium",variant:l.sidebar?"secondary":"tertiary",icon:e.jsx($,{title:"Del stilling"}),children:"Del stillingen"}),e.jsxs(S,{open:F,className:f.sendSmsModal,onClose:()=>i(!1),"aria-label":`Del stillingen med ${a.length} kandidater`,header:{heading:"Del stillingen"},children:[e.jsxs(S.Body,{children:[(c.length>0||K)&&e.jsx(A,{variant:"warning",size:"small",className:"my-4",children:"Ikke alle kandidatene vil motta beskjeden"}),e.jsxs("div",{className:"send-sms-modal__innhold",children:[e.jsxs(j,{children:["Det vil bli sendt beskjed til"," ",e.jsx("b",{children:g.length})," ",g.length===1?"kandidat":"kandidater"]}),e.jsx(j,{size:"small",children:"Telefonnummerene/e-postene blir hentet fra Kontakt- og reservasjonsregisteret."}),e.jsx(d,{size:"small",headingSize:"xsmall",className:"my-4",children:e.jsxs(d.Item,{children:[e.jsx(d.Header,{children:"Vis kandidater"}),e.jsx(d.Content,{children:e.jsxs(n,{size:"small",children:[e.jsx(n.Header,{children:e.jsxs(n.Row,{children:[e.jsx(n.HeaderCell,{scope:"col",children:"Navn"}),e.jsx(n.HeaderCell,{scope:"col",children:"Fødselsnr."}),e.jsx(n.HeaderCell,{scope:"col",children:"Kan sende beskjed"})]})}),e.jsx(n.Body,{children:a?.map(({fornavn:s,etternavn:I,fodselsnr:y},V)=>e.jsxs(n.Row,{children:[e.jsxs(n.HeaderCell,{scope:"row",children:[s," ",I]}),e.jsx(n.DataCell,{children:y}),e.jsx(n.DataCell,{children:c.some(B=>B.fodselsnr===y)?"Nei":"Ja"})]},V))})]})})]})}),e.jsx(A,{variant:"info",className:f.kontortidAdvarsel,children:e.jsx(_,{size:"small",children:"SMS sendes ut mellom 09:00 og 17:15 hver dag. Det kan oppstå forsinkelser."})}),m!==M.Jobbmesse&&e.jsxs(G,{className:f.velgMal,label:"Velg hva som skal vises i beskjeden",onChange:s=>{z(s.target.value)},children:[e.jsx("option",{value:r.VurdertSomAktuell,children:"Send stilling til en aktuell kandidat"}),e.jsx("option",{value:r.FunnetPassendeStilling,children:"Oppfordre kandidat til å søke på stilling"})]}),e.jsx(_,{htmlFor:"forhåndsvisning",children:"Meldingen som vil bli sendt til kandidatene"}),e.jsx("div",{id:"forhåndsvisning",className:"p-4",children:e.jsx(j,{children:e.jsxs("span",{children:[b?Z(v,b):"Klarte ikke å hente meldingsmaler"," "]})})})]})]}),e.jsxs(S.Footer,{children:[e.jsx(u,{disabled:c.length===a.length||g.length===0,variant:"primary",loading:T,onClick:H,children:"Send beskjed"}),e.jsx(u,{variant:"secondary",onClick:()=>i(!1),children:"Avbryt"})]})]})]})},Z=(l,t)=>{if(l===r.VurdertSomAktuell)return t.vurdertSomAktuell?.smsTekst;if(l===r.FunnetPassendeStilling)return t.passendeStilling?.smsTekst;if(l===r.Jobbarrangement)return t.passendeJobbarrangement?.smsTekst};Y.__docgenInfo={description:"",methods:[],displayName:"SendSmsModal",props:{markerteKandidater:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"kandidaterSchema"}],raw:"z.infer<typeof kandidaterSchema>"}],raw:"KandidatListeKandidatDTO[]"},description:""},fjernAllMarkering:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},sidebar:{required:!1,tsType:{name:"boolean"},description:""}}};export{Y as S};
