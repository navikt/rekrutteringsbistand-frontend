import{b8 as m,r as a,b3 as J,b7 as Q,b5 as X,bI as Y,bL as Z,bM as _,i as L}from"./iframe-B2tryd13.js";import"./AutoLagre-DvMkgJUz.js";const U=()=>{try{return!1}catch{return!1}},N=t=>t===m.PUBLISERT||t===m.FULLFØRT,ee=a.createContext(null),te={lagreNaa:async()=>{},lagrer:!1,venterPåLagring:!1,feil:null,sisteLagret:null,harUlagredeEndringer:!1,statusTekst:"Autolagring utilgjengelig",skjemaVerdier:()=>({}),kiSjekket:!0,autoLagringAktiv:!1,harKiFeil:!1},re=()=>a.useContext(ee)??te,b=t=>t==null?"":String(t).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function ne({feltType:t,fieldName:e,savedValue:c,onUpdated:o}){const{rekrutteringstreffId:F}=J(),{treff:p}=Q(),{lagreNaa:V,autoLagringAktiv:K}=re(),{control:w,setValue:r,getValues:R,trigger:S}=X(),{setLagret:i,isLoading:M}=Y(F,t),C=Z({control:w,name:e}),v=b(C),E=b(c),j=N(p)&&U(),{trigger:A,data:s,reset:$,error:u,isMutating:P}=_(F),[g,x]=a.useState(null),[f,d]=a.useState(!1),[I,h]=a.useState(!1);a.useEffect(()=>{v!==E&&(h(!1),d(!1),x(null),$(),r(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}))},[E,v,$,e,r]);const H=!!s&&!u&&s?.bryterRetningslinjer&&!f;a.useEffect(()=>{const n=!!s&&!u&&!!s?.bryterRetningslinjer&&!f;r(`${e}KiFeil`,n,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[s,u,f,e,r]);const k=a.useCallback(async()=>{if(!K){o?.();return}try{await V()}catch(n){new L({message:`Lagring av ${t} feilet.`,error:n})}finally{o?.()}},[K,V,t,o]),B=a.useCallback(async()=>{if(!await S(e))return;const W=R(e),D=String(W??"").trim(),T=b(D);if(T){if(c!==void 0){const l=b(c);if(T===l)return}try{const l=await A({feltType:t,tekst:D});h(!0);const y=l?.loggId??s?.loggId??null;x(y);const G=l?.bryterRetningslinjer??s?.bryterRetningslinjer;if(r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),r(`${e}KiFeil`,!!G,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),!G&&(await k(),y&&i))try{await i({id:y,lagret:!0})}catch(q){new L({message:`Feil ved oppdatering av /lagret for logg ${y}.`,error:q})}}catch(l){new L({message:"Validation failed:",error:l}),h(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[S,e,R,A,t,k,i,s,r,c]),z=a.useCallback(async()=>{if(j){d(!0),h(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),r(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),o?.();return}if(d(!0),await k(),g&&i)try{await i({id:g,lagret:!0})}catch(n){new L({message:`Feil ved oppdatering av /lagret for logg ${g}.`,error:n})}},[j,k,g,i,e,r,o]),O=!!s&&!u&&!!s?.bryterRetningslinjer;return{analyse:s,analyseError:u,validating:P,kiErrorBorder:H,harGodkjentKiFeil:f,setHarGodkjentKiFeil:d,loggId:g,hasChecked:I,showAnalysis:I&&O,erRedigeringAvPublisertTreff:j,validerMedKiOgLagreVedGodkjenning:B,onGodkjennKiFeil:z,watchedValue:C,control:w,setValue:r,getValues:R,kiLoggLoading:M}}export{ne as u};
