import{e as B,a as J}from"./useAutosave-CsHUi5j0.js";import{h5 as O,o as T,ak as Q,T as w,U as X,h2 as Y,hC as Z,h4 as _,hE as U,r as a,w as j}from"./iframe-sZP266bO.js";import{a as N,u as ee}from"./useKiLogg-CvHUwCfb.js";const te=(t=":id")=>`${O.internUrl}/${t}/ki/valider`,re=T({feltType:w(),tekst:w()}),se=T({loggId:w(),bryterRetningslinjer:X(),begrunnelse:w()}),ae=async(t,{arg:e})=>{const u=e.tekst.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),h={...e,tekst:u};re.parse(e);const n=await Q(t,h);return se.parse(n)},ne=t=>N(te(t??":id"),ae),D=t=>t==null?"":String(t).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function ce({feltType:t,fieldName:e,savedValue:u,saveCallback:h,onUpdated:n,requireHasCheckedToShow:G=!1}){const{rekrutteringstreffId:S}=Y(),{data:M}=Z(S),{control:F,setValue:r,getValues:V,trigger:K}=_(),{setLagret:i,isLoading:x}=ee(S,t),E=U({control:F,name:e}),g=B(M)&&J(),{trigger:$,data:s,reset:v,error:c,isMutating:H}=ne(S),[d,C]=a.useState(null),[k,y]=a.useState(!1),[I,R]=a.useState(!1);a.useEffect(()=>{R(!1),y(!1),C(null),v(),r(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[E,v,e,r]);const P=!!s&&!c&&s?.bryterRetningslinjer&&!k;a.useEffect(()=>{const o=!!s&&!c&&!!s?.bryterRetningslinjer&&!k;r(`${e}KiFeil`,o,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[s,c,k,e,r]);const b=a.useCallback(async o=>{try{await h([e],o)}catch(f){new j({message:`Lagring av ${t} feilet.`,error:f})}finally{n?.()}},[h,e,t,n]),W=a.useCallback(async()=>{if(!await K(e))return;const f=V(e),m=(typeof f=="string"?f:String(f??"")).trim(),A=D(m);if(A){if(u!==void 0){const l=D(u);if(A===l)return}try{const l=await $({feltType:t,tekst:m});R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const p=l?.loggId??s?.loggId??null;if(C(p),!(l?.bryterRetningslinjer??s?.bryterRetningslinjer)&&!g&&(await b(),p&&i))try{await i({id:p,lagret:!0})}catch(z){new j({message:`Feil ved oppdatering av /lagret for logg ${p}.`,error:z})}}catch(l){new j({message:"Validation failed:",error:l}),R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[K,e,V,$,t,g,b,i,s,r,u]),q=a.useCallback(async()=>{if(g){y(!0),R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),r(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),n?.();return}if(y(!0),await b(!0),d&&i)try{await i({id:d,lagret:!0})}catch(o){new j({message:`Feil ved oppdatering av /lagret for logg ${d}.`,error:o})}},[g,b,d,i,e,r,n]),L=!!s&&!c&&!!s?.bryterRetningslinjer;return{analyse:s,analyseError:c,validating:H,kiErrorBorder:P,harGodkjentKiFeil:k,setHarGodkjentKiFeil:y,loggId:d,hasChecked:I,showAnalysis:G?I&&L:L,erRedigeringAvPublisertTreff:g,runValidationAndMaybeSave:W,onGodkjennKiFeil:q,watchedValue:E,control:F,setValue:r,getValues:V,kiLoggLoading:x}}export{ce as u};
