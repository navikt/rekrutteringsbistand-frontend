import{bO as C,bP as z,bQ as F,V as Y,bR as _,bS as q,bT as L,r as e,j as y,d as B,a7 as H,n as K}from"./iframe-BYISswbs.js";import{c as Q}from"./compareAsc-Cgb9DBsI.js";import{d as $}from"./differenceInMonths-CV4qCpC8.js";import{d as G,g as J}from"./differenceInMilliseconds-DHCleDWg.js";import{S as W}from"./ExclamationmarkTriangle-DszJHhmG.js";import{S as Z}from"./Floppydisk-CwoftluH.js";function A(s){return C(s,Date.now())}function ee(s,c,t){const S=G(s,c)/1e3;return J(t?.roundingMethod)(S)}function re(s,c,t){const S=z(),r=t?.locale??S.locale??F,T=2520,d=Q(s,c);if(isNaN(d))throw new RangeError("Invalid time value");const n=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:d}),[l,i]=Y(t?.in,...d>0?[c,s]:[s,c]),p=ee(i,l),b=(_(i)-_(l))/1e3,a=Math.round((p-b)/60);let f;if(a<2)return t?.includeSeconds?p<5?r.formatDistance("lessThanXSeconds",5,n):p<10?r.formatDistance("lessThanXSeconds",10,n):p<20?r.formatDistance("lessThanXSeconds",20,n):p<40?r.formatDistance("halfAMinute",0,n):p<60?r.formatDistance("lessThanXMinutes",1,n):r.formatDistance("xMinutes",1,n):a===0?r.formatDistance("lessThanXMinutes",1,n):r.formatDistance("xMinutes",a,n);if(a<45)return r.formatDistance("xMinutes",a,n);if(a<90)return r.formatDistance("aboutXHours",1,n);if(a<q){const u=Math.round(a/60);return r.formatDistance("aboutXHours",u,n)}else{if(a<T)return r.formatDistance("xDays",1,n);if(a<L){const u=Math.round(a/q);return r.formatDistance("xDays",u,n)}else if(a<L*2)return f=Math.round(a/L),r.formatDistance("aboutXMonths",f,n)}if(f=$(i,l),f<12){const u=Math.round(a/L);return r.formatDistance("xMonths",u,n)}else{const u=f%12,D=Math.trunc(f/12);return u<3?r.formatDistance("aboutXYears",D,n):u<9?r.formatDistance("overXYears",D,n):r.formatDistance("almostXYears",D+1,n)}}function te(s,c){return re(s,A(s),c)}const ne=3e3,U=s=>{if(!s)return null;if(s instanceof Date)return s;const c=new Date(s);return Number.isNaN(c.getTime())?null:c};function se({form:s,onLagre:c,autoLagringAktiv:t=!0,sisteLagretInitialt:S,harKiFeil:r=!1,kiSjekket:T=!0}){const[d,n]=e.useState(!1),[l,i]=e.useState(!1),[p,b]=e.useState(null),[a,f]=e.useState(()=>U(S)),[u,D]=e.useState(!1),o=e.useRef(null),R=e.useRef(null),x=e.useRef(!0),g=e.useRef(!1),E=e.useRef(!1),k=e.useRef(!1),X=e.useRef(!0),O=e.useRef(!1),h=e.useRef(null),w=e.useCallback(()=>{h.current!==null&&(clearTimeout(h.current),h.current=null,x.current&&i(!1))},[]),N=r||T===!1,I=e.useCallback(async(m=!1)=>{if(w(),!t&&!m){g.current=!1;return}if(!g.current&&!m||!m&&N)return;if(R.current&&(clearTimeout(R.current),R.current=null),E.current){k.current=!0;return}E.current=!0,x.current&&(n(!0),b(null)),O.current=!1;const j=s.getValues();g.current=!1;try{await c(j),x.current&&(f(new Date),g.current||D(!1))}catch(M){const v=M instanceof Error?M.message:"Kunne ikke lagre endringer";x.current&&(b(v),D(!0)),g.current=!0,O.current=!0}finally{E.current=!1,x.current&&n(!1),!O.current&&(k.current||g.current)?(k.current=!1,R.current=setTimeout(()=>{R.current=null,I(!0)},0)):k.current=!1}},[t,w,s,N,c]);e.useEffect(()=>{const m=U(S);m&&f(j=>j&&j.getTime()>=m.getTime()?j:m)},[S]);const V=e.useCallback((m=ne)=>{t&&g.current&&(E.current||N||(h.current!==null&&clearTimeout(h.current),h.current=setTimeout(()=>{h.current=null,x.current&&i(!1),I()},m),x.current&&i(!0)))},[t,N,I]),P=e.useCallback(()=>{t&&(g.current=!0,x.current&&D(!0),V())},[t,V]);return e.useEffect(()=>{N||t&&g.current&&(E.current||h.current===null&&V())},[t,N,V]),e.useEffect(()=>(x.current=!0,()=>{x.current=!1}),[]),e.useEffect(()=>{if(!t){o.current?.unsubscribe?.(),o.current=null,X.current=!0;return}X.current=!0,o.current?.unsubscribe?.(),o.current=null;const m=s.watch((j,M)=>{if(E.current)return;if(X.current){X.current=!1;return}const v=M?.name;if(s.formState.isDirty||v&&s.getFieldState(v)?.isDirty){if(!M?.type||M.type==="change"){P();return}M.type==="blur"&&V()}});return o.current=m,()=>{o.current?.unsubscribe?.(),o.current=null}},[t,s,P,V]),e.useEffect(()=>{t||(g.current=!1,D(!1),n(!1),i(!1),w())},[t,w]),e.useEffect(()=>{},[u]),e.useEffect(()=>{},[u]),e.useEffect(()=>()=>{o.current?.unsubscribe?.(),o.current=null,w(),R.current&&(clearTimeout(R.current),R.current=null)},[w]),{lagreNaa:e.useCallback(async()=>{g.current=!0,await I(!0)},[I]),lagrer:d,venterP책Lagring:l,feil:p,sisteLagret:a,harUlagredeEndringer:u,skjemaVerdier:s.getValues}}function ae({form:s,onLagre:c,autoLagringAktiv:t=!0,sisteLagretInitialt:S,harKiFeil:r=!1,kiSjekket:T=!0,children:d}){const{lagreNaa:n,lagrer:l,venterP책Lagring:i,feil:p,sisteLagret:b,harUlagredeEndringer:a,skjemaVerdier:f}=se({form:s,onLagre:c,autoLagringAktiv:t,sisteLagretInitialt:S,harKiFeil:r,kiSjekket:T}),u=e.useMemo(()=>r&&a?"Kan ikke lagre (KI-feil)":!T&&a?"Venter p책 KI-sjekk":l||i?"Lagrer...":(!t||!a)&&b?`Lagret for ${te(b,{locale:K,addSuffix:!0})}`:"Ikke lagret",[t,r,a,T,l,b,i]),D=e.useMemo(()=>{if(typeof d=="function")return d({lagreNaa:n,lagrer:l,venterP책Lagring:i,feil:p,sisteLagret:b,harUlagredeEndringer:a,statusTekst:u,skjemaVerdier:f,kiSjekket:T});if(d)return d;if(!t)return y.jsx("span",{className:"inline-flex items-center text-xs text-[var(--ax-text-neutral-subtle)]","aria-live":"polite",children:u});const o=!(l||i)&&!r&&T,R=r?y.jsx(W,{title:"KI-feil"}):l||i?y.jsx(H,{size:"xsmall",title:"Lagrer"}):y.jsx(Z,{});return y.jsx("div",{className:"flex items-center gap-2 text-xs","aria-live":"polite",children:y.jsx(B,{icon:R,size:"xsmall",variant:"tertiary",onClick:n,disabled:!o,children:u})})},[t,d,p,a,r,n,l,b,i,f,u,T]);return y.jsx(y.Fragment,{children:D})}ae.__docgenInfo={description:"",methods:[],displayName:"AutoLagre",props:{form:{required:!0,tsType:{name:"UseFormReturn",elements:[{name:"TSkjemaVerdier"}],raw:"UseFormReturn<TSkjemaVerdier>"},description:""},onLagre:{required:!0,tsType:{name:"signature",type:"function",raw:"(verdier: TSkjemaVerdier) => Promise<void>",signature:{arguments:[{type:{name:"TSkjemaVerdier"},name:"verdier"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},autoLagringAktiv:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},sisteLagretInitialt:{required:!1,tsType:{name:"union",raw:"Date | string | null",elements:[{name:"Date"},{name:"string"},{name:"null"}]},description:""},harKiFeil:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},kiSjekket:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},children:{required:!1,tsType:{name:"union",raw:`| React.ReactNode
| ((state: AutoLagreRenderState<TSkjemaVerdier>) => React.ReactNode)`,elements:[{name:"ReactReactNode",raw:"React.ReactNode"},{name:"unknown"}]},description:""}}};export{ae as A};
