import{t as S,a as j}from"./utils-DLUuzV9x.js";import{o as M,av as $,h5 as L,hB as x,ak as H,T as m,h2 as w,hC as E,h4 as P,r as C,hA as J,w as U,hD as V,hi as D}from"./iframe-DxsVXlKp.js";import{o as X}from"./mutations-B9GyulbB.js";const F=M({tittel:m().min(1,"Tittel kan ikke være tom"),htmlContent:m().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:m().nullable().optional(),opprettetAvPersonBeskrivelse:m().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:m().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),R=x,K=t=>`${L.internUrl}/${t}/innlegg`,Z=(t,r)=>`${L.internUrl}/${t}/innlegg/${r}`,q=async(t,r)=>{F.parse(r);const s=await H(K(t),r);return R.parse(s)},z=async(t,r,s)=>{F.parse(s);const e=await $(Z(t,r),s);return R.parse(e)},G=()=>{try{return!1}catch{return!1}},B=t=>{const r=V(t?.hendelser);return r===D.INVITERE||r===D.FULLFØRE},O=(t,r)=>r?!1:B(t)&&G(),N=(t,r,s,e)=>t||r&&!e?!1:s;function _(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e,mutate:h}=E(t),{getValues:k,trigger:l,formState:i}=P(),c=C.useCallback(o=>{const n=k(),g=S(n.fraDato??null,n.fraTid)??e?.fraTid??null,a=S(n.tilDato??n.fraDato??null,n.tilTid)??e?.tilTid??null,u=S(n.svarfristDato??null,n.svarfristTid)??e?.svarfrist??null,p=typeof n.tittel=="string"?n.tittel.trim():"",v=!!i?.errors?.tittel,I=!!n.tittelKiFeil,d=!!n?.tittelKiSjekket,A=!!(p.length>0||e?.tittel&&e.tittel.trim().length>0);let f=N(v,I,A,o);return!B(e)&&!o&&(f=f&&d&&!I),{...f&&{tittel:p.length>0?p:e?.tittel},beskrivelse:n.beskrivelse??e?.beskrivelse??null,fraTid:g,tilTid:a,svarfrist:u,gateadresse:n.gateadresse??e?.gateadresse??null,postnummer:n.postnummer??e?.postnummer??null,poststed:n.poststed??e?.poststed??null}},[k,e,i]);return{save:C.useCallback(async(o,n)=>{if(!t||O(e,n))return;const g=!o||o.length===0;let a=!0;if(!n&&(a=await l(g?void 0:o,{shouldFocus:!1}),!a)||i?.errors?.root?.type==="manualPeriod")return;const u=c(n);try{r("rekrutteringstreff"),await X(t,u),h()}finally{s("rekrutteringstreff")}},[c,t,l,e,h,i?.errors,r,s])}}function tt(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=w(),{data:e}=E(t),{data:h,mutate:k}=J(t),l=h?.[0],{getValues:i,trigger:c,setValue:b,formState:o}=P();return{save:C.useCallback(async(g,a)=>{if(!t||O(e,a)||g&&g.length&&!a&&!await c(g,{shouldFocus:!1}))return;const u=i(),p=!!o?.errors?.htmlContent,v=!!u?.htmlContentKiFeil,I=!!u?.htmlContentKiSjekket,d=(u.htmlContent??"").toString(),A=d.trim().length>0;let f=N(p,v,A,a);if(!B(e)&&!a&&(f=f&&I&&!v),!!f)try{const T=l?.opprettetAvPersonNavn||l?.opprettetAvPersonNavident||"Markedskontakt",y={htmlContent:d,tittel:"Om treffet",opprettetAvPersonNavn:T,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:j(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),l?.id?await z(t,l.id,y):await q(t,y),k(),b("htmlContent",d,{shouldDirty:!1})}catch(T){new U({message:"Lagring av innlegg feilet.",error:T})}finally{s("innlegg")}},[i,l,k,t,r,s,b,e,c,o?.errors])}}export{G as a,_ as b,B as e,tt as u};
