import{u as L,O as J,ax as E,r as h,ch as R,ci as O,cj as r,ck as M,cl as U,j as e,d as u,A,B as j,L as _,f as q}from"./iframe-BKDoWgHq.js";import{U as P}from"./umamiEvents-D8PysN3T.js";import{S as $}from"./ArrowForward-BGREE0xR.js";import{M as S}from"./Modal-DT3kgKxc.js";import{A as d}from"./Accordion-DqJqH_-X.js";import{T as n}from"./Table-l0e9-Uid.js";import{S as G}from"./Select-C7s19rSj.js";const Q="_sendSmsModal_me9a7_1",W="_velgMal_me9a7_5",X="_kontortidAdvarsel_me9a7_18",f={sendSmsModal:Q,velgMal:W,kontortidAdvarsel:X},Y=a=>{const{visVarsel:t}=L(),{fjernAllMarkering:C,markerteKandidater:l}=a,{track:w}=J(),{stillingsData:o}=E(),m=o?.stillingsinfo?.stillingskategori,D=o.stilling.uuid,[F,i]=h.useState(!1),{data:x={}}=R(m==="FORMIDLING"?null:o.stilling.uuid),T=O(),[K,p]=h.useState(!1),c=l.filter(s=>s.fodselsnr&&x[s.fodselsnr]),g=l.filter(s=>!(s.fodselsnr&&x[s.fodselsnr])),N=l.some(s=>s.fodselsnr===null),[v,z]=h.useState(m===M.Jobbmesse?r.Jobbarrangement:r.VurdertSomAktuell),{data:b}=U(),k=l.map(s=>s.fodselsnr),H=async()=>{if(p(!0),k.length===0){t({tekst:"Ingen kandidater valgt",type:"warning"});return}try{await T({mal:v,fnr:k.filter(s=>s!==null),stillingId:D}),w(P.Stilling.send_beskjed_til_kandidat,{antall:k.length}),t({tekst:"Beskjed er sendt",type:"success"}),C(),i(!1)}catch(s){new q({message:"Klarte ikke å sende SMS:",error:s}),t({tekst:s instanceof Error?`Feil ved sending: ${s.message}`:"Det skjedde en uventet feil ved sending av beskjed",type:"error"})}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(u,{disabled:l.length===0,onClick:()=>i(!0),size:a.sidebar?"small":"medium",variant:a.sidebar?"secondary":"tertiary",icon:e.jsx($,{title:"Del stilling"}),children:"Del stillingen"}),e.jsxs(S,{open:F,className:f.sendSmsModal,onClose:()=>i(!1),"aria-label":`Del stillingen med ${l.length} kandidater`,header:{heading:"Del stillingen"},children:[e.jsxs(S.Body,{children:[(c.length>0||N)&&e.jsx(A,{variant:"warning",size:"small",className:"my-4",children:"Ikke alle kandidatene vil motta beskjeden"}),e.jsxs("div",{className:"send-sms-modal__innhold",children:[e.jsxs(j,{children:["Det vil bli sendt beskjed til"," ",e.jsx("b",{children:g.length})," ",g.length===1?"kandidat":"kandidater"]}),e.jsx(j,{size:"small",children:"Telefonnummerene/e-postene blir hentet fra Kontakt- og reservasjonsregisteret."}),e.jsx(d,{size:"small",headingSize:"xsmall",className:"my-4",children:e.jsxs(d.Item,{children:[e.jsx(d.Header,{children:"Vis kandidater"}),e.jsx(d.Content,{children:e.jsxs(n,{size:"small",children:[e.jsx(n.Header,{children:e.jsxs(n.Row,{children:[e.jsx(n.HeaderCell,{scope:"col",children:"Navn"}),e.jsx(n.HeaderCell,{scope:"col",children:"Fødselsnr."}),e.jsx(n.HeaderCell,{scope:"col",children:"Kan sende beskjed"})]})}),e.jsx(n.Body,{children:l?.map(({fornavn:s,etternavn:I,fodselsnr:y},V)=>e.jsxs(n.Row,{children:[e.jsxs(n.HeaderCell,{scope:"row",children:[s," ",I]}),e.jsx(n.DataCell,{children:y}),e.jsx(n.DataCell,{children:c.some(B=>B.fodselsnr===y)?"Nei":"Ja"})]},V))})]})})]})}),e.jsx(A,{variant:"info",className:f.kontortidAdvarsel,children:e.jsx(_,{size:"small",children:"SMS sendes ut mellom 09:00 og 17:15 hver dag. Det kan oppstå forsinkelser."})}),m!==M.Jobbmesse&&e.jsxs(G,{className:f.velgMal,label:"Velg hva som skal vises i beskjeden",onChange:s=>{z(s.target.value)},children:[e.jsx("option",{value:r.VurdertSomAktuell,children:"Send stilling til en aktuell kandidat"}),e.jsx("option",{value:r.FunnetPassendeStilling,children:"Oppfordre kandidat til å søke på stilling"})]}),e.jsx(_,{htmlFor:"forhåndsvisning",children:"Meldingen som vil bli sendt til kandidatene"}),e.jsx("div",{id:"forhåndsvisning",className:"p-4",children:e.jsx(j,{children:e.jsxs("span",{children:[b?Z(v,b):"Klarte ikke å hente meldingsmaler"," "]})})})]})]}),e.jsxs(S.Footer,{children:[e.jsx(u,{disabled:c.length===l.length||g.length===0,variant:"primary",loading:K,onClick:H,children:"Send beskjed"}),e.jsx(u,{variant:"secondary",onClick:()=>i(!1),children:"Avbryt"})]})]})]})},Z=(a,t)=>{if(a===r.VurdertSomAktuell)return t.vurdertSomAktuell?.smsTekst;if(a===r.FunnetPassendeStilling)return t.passendeStilling?.smsTekst;if(a===r.Jobbarrangement)return t.passendeJobbarrangement?.smsTekst};Y.__docgenInfo={description:"",methods:[],displayName:"SendSmsModal",props:{markerteKandidater:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"kandidaterSchema"}],raw:"z.infer<typeof kandidaterSchema>"}],raw:"KandidatListeKandidatDTO[]"},description:""},fjernAllMarkering:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},sidebar:{required:!1,tsType:{name:"boolean"},description:""}}};export{Y as S};
