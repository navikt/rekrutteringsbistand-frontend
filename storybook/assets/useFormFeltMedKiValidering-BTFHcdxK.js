import{e as z,a as O}from"./useRekrutteringstreffValidering-BcL3kY1e.js";import{b5 as W,bG as q,b7 as J,bB as Q,bH as X,bI as Y,r as a,h as j}from"./iframe-B7Dvl8Jj.js";const D=s=>s==null?"":String(s).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function ee({feltType:s,fieldName:e,savedValue:w,saveCallback:V,onUpdated:c,requireHasCheckedToShow:x=!1}){const{rekrutteringstreffId:R}=W(),{data:A}=q(R),{control:F,setValue:t,getValues:K,trigger:L}=J(),{setLagret:i,isLoading:H}=Q(R,s),S=X({control:F,name:e}),d=z(A)&&O(),{trigger:E,data:r,reset:$,error:l,isMutating:M}=Y(R),[u,C]=a.useState(null),[f,h]=a.useState(!1),[I,k]=a.useState(!1);a.useEffect(()=>{k(!1),h(!1),C(null),$(),t(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[S,$,e,t]);const T=!!r&&!l&&r?.bryterRetningslinjer&&!f;a.useEffect(()=>{const n=!!r&&!l&&!!r?.bryterRetningslinjer&&!f;t(`${e}KiFeil`,n,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[r,l,f,e,t]);const y=a.useCallback(async n=>{try{await V([e],n)}catch(g){new j({message:`Lagring av ${s} feilet.`,error:g})}finally{c?.()}},[V,e,s,c]),m=a.useCallback(async()=>{if(!await L(e))return;const g=K(e),v=(typeof g=="string"?g:String(g??"")).trim(),G=D(v);if(G){if(w!==void 0){const o=D(w);if(G===o)return}try{const o=await E({feltType:s,tekst:v});k(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const b=o?.loggId??r?.loggId??null;if(C(b),!(o?.bryterRetningslinjer??r?.bryterRetningslinjer)&&(await y(!0),b&&i))try{await i({id:b,lagret:!0})}catch(P){new j({message:`Feil ved oppdatering av /lagret for logg ${b}.`,error:P})}}catch(o){new j({message:"Validation failed:",error:o}),k(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[L,e,K,E,s,d,y,i,r,t,w]),B=a.useCallback(async()=>{if(d){h(!0),k(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),t(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),c?.();return}if(h(!0),await y(!0),u&&i)try{await i({id:u,lagret:!0})}catch(n){new j({message:`Feil ved oppdatering av /lagret for logg ${u}.`,error:n})}},[d,y,u,i,e,t,c]),p=!!r&&!l&&!!r?.bryterRetningslinjer;return{analyse:r,analyseError:l,validating:M,kiErrorBorder:T,harGodkjentKiFeil:f,setHarGodkjentKiFeil:h,loggId:u,hasChecked:I,showAnalysis:x?I&&p:p,erRedigeringAvPublisertTreff:d,validerMedKiOgLagreVedGodkjenning:m,onGodkjennKiFeil:B,watchedValue:S,control:F,setValue:t,getValues:K,kiLoggLoading:H}}export{ee as u};
