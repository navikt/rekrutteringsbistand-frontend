import{t as b,a as O}from"./utils-BDmGT35d.js";import{o as N,av as M,h5 as L,hB as $,ak as x,T as d,h2 as D,hC as F,h4 as S,r as A,hA as H,w as J,hD as U,hi as C}from"./iframe-DLBscwX4.js";import{o as V}from"./mutations-Dm7ABHZX.js";const w=N({tittel:d().min(1,"Tittel kan ikke være tom"),htmlContent:d().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:d().nullable().optional(),opprettetAvPersonBeskrivelse:d().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:d().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),B=$,X=t=>`${L.internUrl}/${t}/innlegg`,j=(t,n)=>`${L.internUrl}/${t}/innlegg/${n}`,Z=async(t,n)=>{w.parse(n);const s=await x(X(t),n);return B.parse(s)},q=async(t,n,s)=>{w.parse(s);const e=await M(j(t,n),s);return B.parse(e)},z=()=>{try{return!1}catch{return!1}},G=t=>{const n=U(t?.hendelser);return n===C.INVITERE||n===C.FULLFØRE},E=(t,n)=>n?!1:G(t)&&z(),P=(t,n,s,e)=>t||n&&!e?!1:s;function Y(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=D(),{data:e,mutate:m}=F(t),{getValues:f,trigger:o,formState:i}=S(),c=A.useCallback(a=>{const r=f(),g=b(r.fraDato??null,r.fraTid)??e?.fraTid??null,l=b(r.tilDato??r.fraDato??null,r.tilTid)??e?.tilTid??null,u=b(r.svarfristDato??null,r.svarfristTid)??e?.svarfrist??null,k=typeof r.tittel=="string"?r.tittel.trim():"",I=!!i?.errors?.tittel,p=!!r.tittelKiFeil,T=!!(k.length>0||e?.tittel&&e.tittel.trim().length>0);return{...P(I,p,T,a)&&{tittel:k.length>0?k:e?.tittel},beskrivelse:r.beskrivelse??e?.beskrivelse??null,fraTid:g,tilTid:l,svarfrist:u,gateadresse:r.gateadresse??e?.gateadresse??null,postnummer:r.postnummer??e?.postnummer??null,poststed:r.poststed??e?.poststed??null}},[f,e,i]);return{save:A.useCallback(async(a,r)=>{if(!t||E(e,r))return;const g=!a||a.length===0;let l=!0;if(!r&&(l=await o(g?void 0:a,{shouldFocus:!1}),!l)||i?.errors?.root?.type==="manualPeriod")return;const u=c(r);try{n("rekrutteringstreff"),await V(t,u),m()}finally{s("rekrutteringstreff")}},[c,t,o,e,m,i?.errors,n,s])}}function _(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=D(),{data:e}=F(t),{data:m,mutate:f}=H(t),o=m?.[0],{getValues:i,trigger:c,setValue:v,formState:a}=S();return{save:A.useCallback(async(g,l)=>{if(!t||E(e,l)||g&&g.length&&!l&&!await c(g,{shouldFocus:!1}))return;const u=i(),k=!!a?.errors?.htmlContent,I=!!u?.htmlContentKiFeil,p=(u.htmlContent??"").toString(),T=p.trim().length>0;if(P(k,I,T,l))try{const h=o?.opprettetAvPersonNavn||o?.opprettetAvPersonNavident||"Markedskontakt",y={htmlContent:p,tittel:"Om treffet",opprettetAvPersonNavn:h,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:O(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};n("innlegg"),o?.id?await q(t,o.id,y):await Z(t,y),f(),v("htmlContent",p,{shouldDirty:!1})}catch(h){new J({message:"Lagring av innlegg feilet.",error:h})}finally{s("innlegg")}},[i,o,f,t,n,s,v,e,c,a?.errors])}}export{z as a,Y as b,G as e,_ as u};
