import{b5 as p,bD as C,b7 as b,r as f,bE as w,bF as A,h as K,bG as T,j as e,B as R,C as V}from"./iframe-B7Dvl8Jj.js";import{f as N}from"./index-BCd29kl7.js";import{u as D,s as P}from"./useRekrutteringstreffValidering-BcL3kY1e.js";import{K as B}from"./KiAnalyseIntro-C1IOZiuu.js";import{K as M}from"./KiAnalysePanel-CnrL8cFz.js";import{u as O}from"./useFormFeltMedKiValidering-BTFHcdxK.js";import{R as H}from"./RikTekstEditor-CVxZCYLk.js";import{S as G}from"./Skeleton-B24mRMay.js";function _(){const{rekrutteringstreffId:t,startLagring:s,stoppLagring:a}=p(),{data:i,mutate:r}=C(t),n=i?.[0],{getValues:l,setValue:g}=b();return{lagre:f.useCallback(async()=>{if(!t)return;const o=(l().htmlContent??"").toString();if(o.trim().length!==0)try{const d=n?.opprettetAvPersonNavn||n?.opprettetAvPersonNavident||"Markedskontakt",c={htmlContent:o,tittel:"Om treffet",opprettetAvPersonNavn:d,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:N(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};s("innlegg"),n?.id?await w(t,n.id,c):await A(t,c),r(),g("htmlContent",o,{shouldDirty:!1})}catch(d){new K({message:"Lagring av innlegg feilet.",error:d})}finally{a("innlegg")}},[l,n,r,t,s,a,g])}}function X(){const{rekrutteringstreffId:t}=p(),{data:s}=T(t),{getValues:a,trigger:i,formState:r}=b(),{lagre:n}=_(),{harInnleggFeil:l,innleggKiFeil:g,innleggKiSjekket:m}=D();return{autosave:f.useCallback(async o=>{!t||P(s)||o&&o.length&&!await i(o,{shouldFocus:!1})||!((a().htmlContent??"").toString().trim().length>0)||l||m&&g||await n()},[t,s,i,r,a,n,l,g,m])}}const q="rediger-innlegg-htmlcontent-form",j=({onUpdated:t})=>{const{rekrutteringstreffId:s}=p(),{data:a,isLoading:i}=C(s),r=a?.[0],n=r?r.htmlContent??null:void 0,{autosave:l}=X(),[g,m]=f.useState(Date.now()),{analyse:h,analyseError:o,validating:d,kiErrorBorder:c,harGodkjentKiFeil:k,showAnalysis:v,erRedigeringAvPublisertTreff:x,validerMedKiOgLagreVedGodkjenning:F,onGodkjennKiFeil:S,control:L,setValue:y,kiLoggLoading:I}=O({feltType:"innlegg",fieldName:"htmlContent",savedValue:n,saveCallback:l,onUpdated:t,requireHasCheckedToShow:!0});return f.useEffect(()=>{const u=r?.htmlContent??"";y("htmlContent",u,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!1}),m(Date.now())},[y,r?.htmlContent]),e.jsx(e.Fragment,{children:e.jsxs("section",{className:"space-y-3",children:[e.jsx(B,{title:"Introduksjon"}),(i||I)&&e.jsx(G,{variant:"text"}),!i&&!I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:e.jsx(R,{size:"small",textColor:"subtle",children:"Fortell jobbsøkeren om treffet: de unike fordelene, mulighetene, og oppgavene som de vil møte. For eksempel arbeidsgivere, forventninger, læring- og karrieremuligheter."})}),e.jsx("div",{className:`border rounded-lg ${c?"border-red-500":"border-gray-300"}`,onBlur:u=>{const E=u.currentTarget;setTimeout(async()=>{E.contains(document.activeElement)||await F()},0)},children:e.jsx(V,{name:"htmlContent",control:L,render:({field:u})=>e.jsx(H,{id:q,tekst:u.value??"",onChange:u.onChange},g)})}),e.jsx(M,{validating:d,analyse:h,analyseError:o,harGodkjentKiFeil:k,showAnalysis:v,erRedigeringAvPublisertTreff:x,onGodkjennKiFeil:S,ariaLabel:"Analyse av innlegg"})]})]})})};j.displayName="InnleggForm";j.__docgenInfo={description:"",methods:[],displayName:"InnleggForm",props:{onUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{j as I};
