import{t as A,a as N}from"./utils-ly0Hd9sO.js";import{o as M,av as $,h5 as w,hB as x,ak as H,T as I,h2 as L,hC as P,h4 as E,r as S,hA as J,w as U,hD as V,hi as D}from"./iframe-BUQyu22L.js";import{o as X}from"./mutations-h2kfY-OX.js";const F=M({tittel:I().min(1,"Tittel kan ikke være tom"),htmlContent:I().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:I().nullable().optional(),opprettetAvPersonBeskrivelse:I().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:I().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),O=x,K=t=>`${w.internUrl}/${t}/innlegg`,Z=(t,r)=>`${w.internUrl}/${t}/innlegg/${r}`,q=async(t,r)=>{F.parse(r);const s=await H(K(t),r);return O.parse(s)},z=async(t,r,s)=>{F.parse(s);const e=await $(Z(t,r),s);return O.parse(e)},G=()=>{try{return!1}catch{return!1}},C=t=>{const r=V(t?.hendelser);return r===D.INVITERE||r===D.FULLFØRE},R=(t,r)=>r?!1:C(t)&&G(),j=(t,r,s,e)=>t||r&&!e?!1:s;function _(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=L(),{data:e,mutate:T}=P(t),{getValues:v,trigger:a,formState:i}=E(),d=S.useCallback(l=>{const n=v(),f=A(n.fraDato??null,n.fraTid)??e?.fraTid??null,o=A(n.tilDato??n.fraDato??null,n.tilTid)??e?.tilTid??null,g=A(n.svarfristDato??null,n.svarfristTid)??e?.svarfrist??null,c=typeof n.tittel=="string"?n.tittel.trim():"",m=!!i?.errors?.tittel,k=!!n.tittelKiFeil,h=!!n?.tittelKiSjekket,u=!!(c.length>0||e?.tittel&&e.tittel.trim().length>0);let p=j(m,k,u,l);return!C(e)&&!l&&(p=p&&h&&!k),{...p&&{tittel:c.length>0?c:e?.tittel},beskrivelse:n.beskrivelse??e?.beskrivelse??null,fraTid:f,tilTid:o,svarfrist:g,gateadresse:n.gateadresse??e?.gateadresse??null,postnummer:n.postnummer??e?.postnummer??null,poststed:n.poststed??e?.poststed??null}},[v,e,i]);return{save:S.useCallback(async(l,n)=>{if(!t||R(e,n))return;const f=!l||l.length===0;let o,g=!0;if(!n&&(g=await a(f?void 0:l,{shouldFocus:!1}),!g)){const m=i?.errors||{},k=Object.keys(m).filter(u=>u!=="root");if(k.length>0&&k.every(u=>u==="tittel")){if(o=d(n),Object.prototype.hasOwnProperty.call(o,"tittel"))return}else return}if(i?.errors?.root?.type==="manualPeriod")return;const c=o??d(n);try{r("rekrutteringstreff"),await X(t,c),T()}finally{s("rekrutteringstreff")}},[d,t,a,e,T,i?.errors,r,s])}}function tt(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:s}=L(),{data:e}=P(t),{data:T,mutate:v}=J(t),a=T?.[0],{getValues:i,trigger:d,setValue:y,formState:l}=E();return{save:S.useCallback(async(f,o)=>{if(!t||R(e,o)||f&&f.length&&!o&&!await d(f,{shouldFocus:!1}))return;const g=i(),c=!!l?.errors?.htmlContent,m=!!g?.htmlContentKiFeil,k=!!g?.htmlContentKiSjekket,h=(g.htmlContent??"").toString(),u=h.trim().length>0;let p=j(c,m,u,o);if(!C(e)&&!o&&(p=p&&k&&!m),!!p)try{const b=a?.opprettetAvPersonNavn||a?.opprettetAvPersonNavident||"Markedskontakt",B={htmlContent:h,tittel:"Om treffet",opprettetAvPersonNavn:b,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:N(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),a?.id?await z(t,a.id,B):await q(t,B),v(),y("htmlContent",h,{shouldDirty:!1})}catch(b){new U({message:"Lagring av innlegg feilet.",error:b})}finally{s("innlegg")}},[i,a,v,t,r,s,y,e,d,l?.errors])}}export{G as a,_ as b,C as e,tt as u};
