import{a_ as h,by as L,b0 as p,r as d,bz as w,bA as B,w as D,bB as F,bC as P,bD as R,bl as C}from"./iframe-BSwZn_oI.js";import{f as j}from"./index-Cfe2iOPl.js";import{t as I}from"./utils-D-fSliSE.js";function E(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:o}=h(),{data:n,mutate:i}=L(t),s=n?.[0],{getValues:a,setValue:u}=p();return{lagre:d.useCallback(async()=>{if(!t)return;const l=(a().htmlContent??"").toString();if(l.trim().length!==0)try{const g=s?.opprettetAvPersonNavn||s?.opprettetAvPersonNavident||"Markedskontakt",f={htmlContent:l,tittel:"Om treffet",opprettetAvPersonNavn:g,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:j(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};e("innlegg"),s?.id?await w(t,s.id,f):await B(t,f),i(),u("htmlContent",l,{shouldDirty:!1})}catch(g){new D({message:"Lagring av innlegg feilet.",error:g})}finally{o("innlegg")}},[a,s,i,t,e,o,u]),innlegg:s}}function M(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:o}=h(),{data:n,mutate:i}=F(t),{getValues:s}=p(),a=d.useCallback(()=>{const r=s(),c=I(r.fraDato??null,r.fraTid)??n?.fraTid??null,l=I(r.tilDato??r.fraDato??null,r.tilTid)??n?.tilTid??null,g=I(r.svarfristDato??null,r.svarfristTid)??n?.svarfrist??null,f=typeof r.tittel=="string"?r.tittel.trim():"";return{tittel:f.length>0?f:n?.tittel??"Treff uten navn",beskrivelse:r.beskrivelse??n?.beskrivelse??null,fraTid:c,tilTid:l,svarfrist:g,gateadresse:r.gateadresse??n?.gateadresse??null,postnummer:r.postnummer??n?.postnummer??null,poststed:r.poststed??n?.poststed??null}},[s,n]);return{lagre:d.useCallback(async()=>{if(!t)return;const r=a();try{e("rekrutteringstreff"),await P(t,r),i()}finally{o("rekrutteringstreff")}},[a,t,i,e,o]),buildDto:a}}const O=()=>{try{return!1}catch{return!1}},N=t=>{const e=R(t?.hendelser);return e===C.INVITERE||e===C.FULLFÃ˜RE};function K(){const{watch:t,formState:e}=p(),o=t("tittelKiFeil")??!1,n=t("htmlContentKiFeil")??!1,i=!!o||!!n,s=!!(e.errors&&Object.keys(e.errors).some(g=>g!=="root")),a=i||s,u=!!e?.errors?.tittel,r=!!e?.errors?.htmlContent,c=!!t("tittelKiSjekket"),l=!!t("htmlContentKiSjekket");return{harFeil:a,harKiFeil:i,harAndreSkjemafeil:s,tittelKiFeil:o,innleggKiFeil:n,harTittelFeil:u,harInnleggFeil:r,tittelKiSjekket:c,innleggKiSjekket:l}}const A=(t,e,o,n)=>t||!e?!1:!n||o;function z(){const{rekrutteringstreffId:t}=h(),{data:e}=F(t),{getValues:o,trigger:n,formState:i}=p(),{lagre:s,buildDto:a}=M(),{tittelKiFeil:u,tittelKiSjekket:r}=K(),c=d.useCallback(async(f,m)=>{if(!t||!await n(f&&f.length>0?f:void 0,{shouldFocus:!1}))return;if(i?.errors?.root?.type==="manualPeriod"){const v=a();if((v?.fraTid??null)!==(e?.fraTid??null)||(v?.tilTid??null)!==(e?.tilTid??null))return}const y=o(),k=typeof y.tittel=="string"?y.tittel.trim():"",S=k.length>0&&k!==(e?.tittel??"");A(m??!1,S,u,r)||await s()},[t,e,a,n,i,o,s,r,u]),l=d.useCallback(async(f,m)=>{},[]);return{autosave:d.useMemo(()=>V(e)?l:c,[e,l,c])}}function J(){const{rekrutteringstreffId:t}=h(),{data:e}=F(t),{getValues:o,trigger:n,formState:i}=p(),{lagre:s,innlegg:a}=E(),{harInnleggFeil:u,innleggKiFeil:r,innleggKiSjekket:c}=K(),l=d.useCallback(async(m,b)=>{if(!t||m&&m.length&&!await n(m,{shouldFocus:!1}))return;const k=(o().htmlContent??"").toString();if(!(k.trim().length>0)||u)return;const v=a?.htmlContent??"",T=k.trim().length>0&&k!==v;A(b??!1,T,r,c)||await s()},[t,e,n,i,o,s,a,u,r,c]),g=d.useCallback(async(m,b)=>{},[]);return{autosave:d.useMemo(()=>V(e)?g:l,[e,g,l])}}const V=t=>N(t)&&O();export{O as a,z as b,N as e,J as u};
