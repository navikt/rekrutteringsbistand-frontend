import{e as z,a as J}from"./useAutosave-CBiDM4pp.js";import{b5 as O,bG as W,b7 as q,bB as Q,bJ as X,bK as Y,r as a,h as K}from"./iframe-DbFLZ0zb.js";const I=s=>s==null?"":String(s).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function N({feltType:s,fieldName:e,savedValue:j,saveCallback:F,onUpdated:c}){const{rekrutteringstreffId:w}=O(),{data:T}=W(w),{control:R,setValue:t,getValues:V,trigger:L}=q(),{setLagret:i,isLoading:x}=Q(w,s),S=X({control:R,name:e}),d=z(T)&&J(),{trigger:$,data:r,reset:E,error:n,isMutating:A}=Y(w),[u,C]=a.useState(null),[f,h]=a.useState(!1),[p,k]=a.useState(!1);a.useEffect(()=>{k(!1),h(!1),C(null),E(),t(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[S,E,e,t]);const M=!!r&&!n&&r?.bryterRetningslinjer&&!f;a.useEffect(()=>{const l=!!r&&!n&&!!r?.bryterRetningslinjer&&!f;t(`${e}KiFeil`,l,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[r,n,f,e,t]);const y=a.useCallback(async l=>{try{await F([e],l)}catch(g){new K({message:`Lagring av ${s} feilet.`,error:g})}finally{c?.()}},[F,e,s,c]),H=a.useCallback(async()=>{if(!await L(e))return;const g=V(e),v=(typeof g=="string"?g:String(g??"")).trim(),D=I(v);if(D){if(j!==void 0){const o=I(j);if(D===o)return}try{const o=await $({feltType:s,tekst:v});k(!0);const b=o?.loggId??r?.loggId??null;C(b);const G=o?.bryterRetningslinjer??r?.bryterRetningslinjer;if(t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),t(`${e}KiFeil`,!!G,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),!G&&(await y(!0),b&&i))try{await i({id:b,lagret:!0})}catch(m){new K({message:`Feil ved oppdatering av /lagret for logg ${b}.`,error:m})}}catch(o){new K({message:"Validation failed:",error:o}),k(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[L,e,V,$,s,d,y,i,r,t,j]),B=a.useCallback(async()=>{if(d){h(!0),k(!0),t(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),t(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),c?.();return}if(h(!0),await y(!0),u&&i)try{await i({id:u,lagret:!0})}catch(l){new K({message:`Feil ved oppdatering av /lagret for logg ${u}.`,error:l})}},[d,y,u,i,e,t,c]),P=!!r&&!n&&!!r?.bryterRetningslinjer;return{analyse:r,analyseError:n,validating:A,kiErrorBorder:M,harGodkjentKiFeil:f,setHarGodkjentKiFeil:h,loggId:u,hasChecked:p,showAnalysis:p&&P,erRedigeringAvPublisertTreff:d,validerMedKiOgLagreVedGodkjenning:H,onGodkjennKiFeil:B,watchedValue:S,control:R,setValue:t,getValues:V,kiLoggLoading:x}}export{N as u};
