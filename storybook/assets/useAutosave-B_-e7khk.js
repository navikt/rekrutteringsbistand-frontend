import{t as I,a as B}from"./utils-BxquJbzv.js";import{o as R,av as O,h5 as L,hB as N,ak as M,T as d,h2 as C,hC as D,h4 as F,r as T,hA as $,w as x,hD as H,hi as A}from"./iframe-taO6KEVb.js";import{o as J}from"./mutations-D3TVdK8w.js";const S=R({tittel:d().min(1,"Tittel kan ikke være tom"),htmlContent:d().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:d().nullable().optional(),opprettetAvPersonBeskrivelse:d().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:d().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),w=N,U=t=>`${L.internUrl}/${t}/innlegg`,X=(t,e)=>`${L.internUrl}/${t}/innlegg/${e}`,V=async(t,e)=>{S.parse(e);const s=await M(U(t),e);return w.parse(s)},j=async(t,e,s)=>{S.parse(s);const r=await O(X(t,e),s);return w.parse(r)},Z=()=>{try{return!1}catch{return!1}},q=t=>{const e=H(t?.hendelser);return e===A.INVITERE||e===A.FULLFØRE},E=(t,e)=>e?!1:q(t)&&Z(),P=(t,e,s)=>(!t||!!s)&&e;function Q(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:s}=C(),{data:r,mutate:m}=D(t),{getValues:k,trigger:a,formState:i}=F(),f=T.useCallback(o=>{const n=k(),g=I(n.fraDato??null,n.fraTid)??r?.fraTid??null,l=I(n.tilDato??n.fraDato??null,n.tilTid)??r?.tilTid??null,p=I(n.svarfristDato??null,n.svarfristTid)??r?.svarfrist??null,u=typeof n.tittel=="string"?n.tittel.trim():"",h=!!i?.errors?.tittel,b=!!(u.length>0||r?.tittel&&r.tittel.trim().length>0);return{...P(h,b,o?.force)&&{tittel:u.length>0?u:r?.tittel},beskrivelse:n.beskrivelse??r?.beskrivelse??null,fraTid:g,tilTid:l,svarfrist:p,gateadresse:n.gateadresse??r?.gateadresse??null,postnummer:n.postnummer??r?.postnummer??null,poststed:n.poststed??r?.poststed??null}},[k,r,i]);return{save:T.useCallback(async(o,n)=>{if(!t||E(r,n))return;const g=!o||o.length===0;let l=!0;if(!n&&(l=await a(g?void 0:o,{shouldFocus:!1}),!l)||i?.errors?.root?.type==="manualPeriod")return;const p=f({force:n});try{e("rekrutteringstreff"),await J(t,p),m()}finally{s("rekrutteringstreff")}},[f,t,a,r,m,i?.errors,e,s])}}function W(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:s}=C(),{data:r}=D(t),{data:m,mutate:k}=$(t),a=m?.[0],{getValues:i,trigger:f,setValue:v,formState:o}=F();return{save:T.useCallback(async(g,l)=>{if(!t||E(r,l)||g&&g.length&&!l&&!await f(g,{shouldFocus:!1}))return;const p=!!o?.errors?.htmlContent,u=(i("htmlContent")??"").toString(),h=u.trim().length>0;if(P(p,h,l))try{const c=a?.opprettetAvPersonNavn||a?.opprettetAvPersonNavident||"Markedskontakt",y={htmlContent:u,tittel:"Om treffet",opprettetAvPersonNavn:c,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:B(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};e("innlegg"),a?.id?await j(t,a.id,y):await V(t,y),k(),v("htmlContent",u,{shouldDirty:!1})}catch(c){new x({message:"Lagring av innlegg feilet.",error:c})}finally{s("innlegg")}},[i,a,k,t,e,s,v,r,f,o?.errors])}}export{Z as a,Q as b,q as e,W as u};
