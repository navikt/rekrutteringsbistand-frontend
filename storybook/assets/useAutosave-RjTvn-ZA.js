import{t as y,a as j}from"./utils-v2fEqnp5.js";import{o as V,av as x,h5 as L,hB as U,ak as $,T as I,h2 as w,hC as B,h4 as O,r as E,hA as H,w as J,hD as X,hi as F}from"./iframe-DTHA2nxD.js";import{o as q}from"./mutations-WZ6vJyDd.js";const M=V({tittel:I().min(1,"Tittel kan ikke være tom"),htmlContent:I().min(1,"Innhold kan ikke være tomt"),opprettetAvPersonNavn:I().nullable().optional(),opprettetAvPersonBeskrivelse:I().min(1,"OpprettetAvPersonBeskrivelse kan ikke være tomt"),sendesTilJobbsokerTidspunkt:I().min(1,"SendesTilJobbsokerTidspunkt kan ikke være tomt")}),K=U,Z=t=>`${L.internUrl}/${t}/innlegg`,_=(t,n)=>`${L.internUrl}/${t}/innlegg/${n}`,z=async(t,n)=>{M.parse(n);const s=await $(Z(t),n);return K.parse(s)},G=async(t,n,s)=>{M.parse(s);const e=await x(_(t,n),s);return K.parse(e)},Q="Treff uten navn",C=()=>{if(typeof document>"u")return!1;const t=document.activeElement;if(!t)return!1;const n=t;return n.tagName==="INPUT"&&(n.name==="tittel"||n.getAttribute("name")==="tittel")},D=()=>{if(typeof document>"u")return;const t=document.querySelector('input[name="tittel"]');t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"}))},W=()=>{try{return!1}catch{return!1}},A=t=>{const n=X(t?.hendelser);return n===F.INVITERE||n===F.FULLFØRE},N=(t,n)=>n?!1:A(t)&&W(),R=(t,n,s,e)=>t||n&&!e?!1:s;function nt(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=w(),{data:e,mutate:b}=B(t),{getValues:p,trigger:d,formState:c}=O(),m=E.useCallback(g=>{const r=p(),l=y(r.fraDato??null,r.fraTid)??e?.fraTid??null,i=y(r.tilDato??r.fraDato??null,r.tilTid)??e?.tilTid??null,h=y(r.svarfristDato??null,r.svarfristTid)??e?.svarfrist??null,a=typeof r.tittel=="string"?r.tittel.trim():"",v=!!c?.errors?.tittel,u=!!r.tittelKiFeil,f=!!r?.tittelKiSjekket,T=!!(a.length>0||e?.tittel&&e.tittel.trim().length>0);let o=R(v,u,T,g);return!A(e)&&!g&&(o=o&&f&&!u),{...o&&{tittel:a.length>0?a:e?.tittel},beskrivelse:r.beskrivelse??e?.beskrivelse??null,fraTid:l,tilTid:i,svarfrist:h,gateadresse:r.gateadresse??e?.gateadresse??null,postnummer:r.postnummer??e?.postnummer??null,poststed:r.poststed??e?.poststed??null}},[p,e,c]);return{save:E.useCallback(async(g,r)=>{if(!t||N(e,r))return;const l=m(r),i=new Set(Object.keys(l??{}));if(!A(e)){const f=(p().tittel??"").trim();if((f.length===0||f===Q)&&!C()){D();return}if(c.errors?.tittelKiFeil&&!r&&!C()){D();return}}const a=g&&g.length>0?g:Array.from(i);if(!i.has("tittel")){const u=a?.indexOf("tittel")??-1;u>=0&&a.splice(u,1)}if(!r&&!await d(a?.length?a:void 0,{shouldFocus:!1})){const f=c?.errors||{},o=Object.keys(f).filter(k=>k!=="root").filter(k=>i.has(k));if(!(o.length===0||o.length===1&&o[0]==="tittel"&&!i.has("tittel")))return}if(c?.errors?.root?.type==="manualPeriod"&&((l?.fraTid??null)!==(e?.fraTid??null)||(l?.tilTid??null)!==(e?.tilTid??null)))return;const v=l??m(r);try{n("rekrutteringstreff"),await q(t,v),b()}finally{s("rekrutteringstreff")}},[m,t,d,e,b,c?.errors,n,s])}}function rt(){const{rekrutteringstreffId:t,startLagring:n,stoppLagring:s}=w(),{data:e}=B(t),{data:b,mutate:p}=H(t),d=b?.[0],{getValues:c,trigger:m,setValue:S,formState:g}=O();return{save:E.useCallback(async(l,i)=>{if(!t||N(e,i)||l&&l.length&&!i&&!await m(l,{shouldFocus:!1}))return;const h=c(),a=!!g?.errors?.htmlContent,v=!!h?.htmlContentKiFeil,u=!!h?.htmlContentKiSjekket,f=(h.htmlContent??"").toString(),T=f.trim().length>0;let o=R(a,v,T,i);if(!A(e)&&!i&&(o=o&&u&&!v),!!o)try{const k=d?.opprettetAvPersonNavn||d?.opprettetAvPersonNavident||"Markedskontakt",P={htmlContent:f,tittel:"Om treffet",opprettetAvPersonNavn:k,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:j(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};n("innlegg"),d?.id?await G(t,d.id,P):await z(t,P),p(),S("htmlContent",f,{shouldDirty:!1})}catch(k){new J({message:"Lagring av innlegg feilet.",error:k})}finally{s("innlegg")}},[c,d,p,t,n,s,S,e,m,g?.errors])}}export{W as a,nt as b,A as e,rt as u};
