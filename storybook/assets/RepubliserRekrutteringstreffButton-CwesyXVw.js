import{r as o,j as e,d as k,M as C,bh as q,E as L,b5 as P,b3 as U,bi as A,bj as J,bk as W,N as Q,B as h}from"./iframe-CkXwiOco.js";import{M as f}from"./Modal-CT8FsD8G.js";import{M as X}from"./MeldingsmalVisning-DzITnSdI.js";import{t as x,f as T}from"./utils-DZOkVEks.js";const Y=({rekrutteringstreffId:s,oppdaterData:t})=>{const[l,r]=o.useState(!1),i=o.useRef(null),a=()=>i.current?.showModal(),c=()=>{l||i.current?.close()},d=async()=>{if(l)return;r(!0);let u=!1;try{await q(s),t(),u=!0}catch(m){new L({message:"Gjenåpning av rekrutteringstreff feilet",error:m})}finally{r(!1),u&&i.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"button",size:"small",variant:"primary",loading:l,onClick:a,children:"Gjenåpne"}),e.jsxs(f,{ref:i,onClose:()=>{l&&i.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(f.Body,{children:e.jsx(C,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(f.Footer,{children:[e.jsx(k,{type:"button",size:"small",loading:l,onClick:()=>void d(),children:"Gjenåpne"}),e.jsx(k,{type:"button",size:"small",variant:"secondary",disabled:l,onClick:c,children:"Avbryt"})]})]})]})};Y.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const g=(s,t,l,r,i)=>{const a=u=>i?i(u):u??"",c=a(l),d=a(r);c!==d&&s.push({etikett:t,gammelVerdi:c,nyVerdi:d})},Z=(s,t,l)=>{const r=[],i=x(s.fraDato,s.fraTid?.trim()||"00:00")??t?.fraTid,a=x(s.tilDato??s.fraDato,s.tilTid?.trim()||"00:00")??t?.tilTid,c=x(s.svarfristDato,s.svarfristTid?.trim()||"00:00")??t?.svarfrist,d=s.tittel?.trim()||t?.tittel||"";return g(r,"Tittel",t?.tittel,d),g(r,"Beskrivelse",t?.beskrivelse,s.beskrivelse??t?.beskrivelse),g(r,"Fra",t?.fraTid,i,T),g(r,"Til",t?.tilTid,a,T),g(r,"Svarfrist",t?.svarfrist,c,T),g(r,"Gateadresse",t?.gateadresse,s.gateadresse??t?.gateadresse),g(r,"Postnummer",t?.postnummer,s.postnummer??t?.postnummer),g(r,"Poststed",t?.poststed,s.poststed??t?.poststed),(l||"")!==(s.htmlContent||"")&&r.push({etikett:"Innlegg",gammelVerdi:"Innhold endret",nyVerdi:"Innhold endret"}),r},$=({treff:s,innleggHtmlFraBackend:t})=>{const l=o.useRef(null),{getValues:r,watch:i,formState:a}=P(),{rekrutteringstreffId:c}=U(),{data:d}=A(),{data:u}=J(c),[m,N]=o.useState([]),[v,V]=o.useState([]),[j,S]=o.useState(!1),w=o.useMemo(()=>u?.some(n=>n.hendelser.some(p=>p.hendelsestype===W.INVITERT)),[u]),y=o.useCallback(()=>{l.current?.close()},[]);o.useEffect(()=>{const n=()=>{const O=r(),_=Z(O,s,t||"");N(_)};n();const p=i(()=>{n()});return()=>p.unsubscribe()},[s,i,r,t]),o.useEffect(()=>{let n=null;return j&&!a.isSubmitting?((!a.errors||Object.keys(a.errors).length===0)&&y(),n=setTimeout(()=>{S(!1)},0)):a.isSubmitting&&!j&&(n=setTimeout(()=>{S(!0)},0)),()=>{n!==null&&clearTimeout(n)}},[a.isSubmitting,a.errors,j,y]);const I=i("tittelKiSjekket")??!1,R=i("htmlContentKiSjekket")??!1,K=i("tittelKiFeil")??!1,z=i("htmlContentKiFeil")??!1,G=K||z,H=!!(a.errors&&Object.keys(a.errors).some(n=>n!=="root")),E=G||H,M=s?.tittel?.trim()==="Treff uten navn",B=m.some(n=>n.etikett==="Tittel"),F=m.some(n=>n.etikett==="Innlegg"),b=o.useMemo(()=>m.length===0||E||!((!B||I)&&(!F||R))||M,[m.length,E,B,F,I,R,M]),D=o.useCallback(()=>{b||(V([...m]),l.current?.showModal())},[m,b]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"button",variant:"primary",size:"small",disabled:b,onClick:D,children:"Publiser på nytt"}),e.jsxs(f,{ref:l,header:{heading:"Følgende endringer vil bli publisert"},children:[e.jsx(f.Body,{children:e.jsxs("div",{className:"space-y-3",children:[v.length===0?e.jsx(C,{children:"Ingen endringer oppdaget."}):e.jsx("div",{className:"space-y-3",children:v.map((n,p)=>e.jsxs("div",{className:"border-b pb-2",children:[e.jsx(Q,{size:"small",children:n.etikett}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{children:"Fra:"}),e.jsx(h,{className:"text-gray-400",children:n.gammelVerdi||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{children:"Til:"}),e.jsx(h,{className:"text-gray-400",children:n.nyVerdi||"—"})]})]},p))}),d&&w&&e.jsx(X,{tittel:"Melding til jobbsøker om endring",smsTekst:d.kandidatInvitertTreffEndret.smsTekst,epostTittel:d.kandidatInvitertTreffEndret.epostTittel,epostHtmlBody:d.kandidatInvitertTreffEndret.epostHtmlBody})]})}),e.jsxs(f.Footer,{children:[e.jsx(k,{type:"submit",form:"rekrutteringstreff-form",variant:"primary",size:"small",disabled:b,loading:a.isSubmitting,children:"Publiser på nytt"}),e.jsx(k,{type:"button",variant:"secondary",size:"small",onClick:y,disabled:a.isSubmitting,children:"Avbryt"})]})]})]})};$.__docgenInfo={description:`Komponent for å republisere et rekrutteringstreff.
Viser en knapp som åpner en modal for bekreftelse av endringer før republisering.`,methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{treff:{required:!0,tsType:{name:"union",raw:"RekrutteringstreffUtenHendelserDTO | null",elements:[{name:"z.infer",elements:[{name:"RekrutteringstreffUtenHendelserSchema"}],raw:`z.infer<
  typeof RekrutteringstreffUtenHendelserSchema
>`},{name:"null"}]},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{Y as G,$ as R};
