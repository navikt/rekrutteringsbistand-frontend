import{j as s,cS as m,cD as v,r as K,x as C,aD as D}from"./iframe-DwwpuTFP.js";import{O as j}from"./OrganisasjonsnummerAlert-Dsxpzlk0.js";import{K as d,a as e}from"./KandidatHendelseTag-BAi-T6SF.js";import{f as S}from"./util--TOvclJc.js";import{f as R}from"./index-B4g5cUh7.js";import{p as V}from"./parseISO-Q4MDVn8O.js";import{i as I}from"./isBefore-CmUWRxsX.js";import{a as F}from"./util-D_fvgQrs.js";const w=t=>{const r=V(t.svarfrist),a=R(r,"UTC","dd.MM.yy"),o=t.svarfrist?I(new Date(t.svarfrist),new Date):!1,n={dato:new Date(t.deltTidspunkt),raw:t};switch(t.tilstand){case m.IKKE_SENDT:case m.PROVER_VARSLING:return{tag:s.jsx(d,{type:e.Spurt_om_å_dele_CV,dato:a}),type:e.Spurt_om_å_dele_CV,tekst:"Prøver varsling",...n};case m.HAR_VARSLET:return{tag:s.jsx(d,{type:e.Spurt_om_å_dele_CV,dato:a}),type:e.Spurt_om_å_dele_CV,dato:new Date(t.deltTidspunkt),tekst:`av ${t.deltAv}`,raw:t};case m.KAN_IKKE_VARSLE:return{tag:s.jsx(d,{type:e.Spurt_om_å_dele_CV_IKKE_DIGITAL,dato:a}),type:e.Spurt_om_å_dele_CV_IKKE_DIGITAL,tekst:"Kandidaten bruker ikke digitale tjenester fra Nav. Du må ringe og registrere svaret i stillingskortet i Aktivitetsplanen.",...n};case m.KAN_IKKE_OPPRETTE:return{tag:s.jsx(d,{type:e.Deling_Av_CV_Feilet,dato:a}),type:e.Deling_Av_CV_Feilet,tekst:"Kan ikke opprette forespørsel",...n};case m.AVBRUTT:return t.deltStatus==="SENDT"&&o?{tag:s.jsx(d,{type:e.Frist_for_deling_av_cv_utløpt,dato:a}),type:e.Frist_for_deling_av_cv_utløpt,tekst:`Frist for deling av CV utløpt ${t.svarfrist&&S({dato:t.svarfrist})}`,...n}:{type:e.Avbrutt_i_aktivitetsplanen,tag:s.jsx(d,{type:e.Avbrutt_i_aktivitetsplanen}),...n};case m.HAR_SVART:return t.svar?.harSvartJa?{tag:s.jsx(d,{type:e.Deling_av_CV_JA,dato:a}),type:e.Deling_av_CV_JA,tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&S({dato:t.svar?.svarTidspunkt})}`,...n}:{type:e.Deling_av_CV_NEI,tag:s.jsx(d,{type:e.Deling_av_CV_NEI,dato:a}),tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&S({dato:t.svar?.svarTidspunkt})}`,...n};default:return{type:null,tag:s.jsx(d,{type:null}),...n}}},b=(t,r=!1,a,o)=>{const n={dato:new Date(t.tidspunkt),raw:t};if(a&&o===0&&a.length>=2&&t.utfall===v.PRESENTERT&&a[1].utfall===v.FATT_JOBBEN)return{type:e.Fjernet_fått_jobben,...n,tag:s.jsx(d,{type:e.Fjernet_fått_jobben}),tekst:""};switch(t.utfall){case v.FATT_JOBBEN:return{type:e.Fått_jobben,...n,tag:s.jsx(d,{type:e.Fått_jobben})};case v.IKKE_PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste===!1&&r?{...n,tag:s.jsx(d,{type:e.CV_slettet_hos_arbeidsgiver}),type:e.CV_slettet_hos_arbeidsgiver,tekst:e.CV_slettet_hos_arbeidsgiver}:{type:null,...n};case v.PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste?{...n,type:e.CV_delt_med_arbeidsgiver,tag:s.jsx(d,{type:e.CV_delt_med_arbeidsgiver})}:{...n,type:null};default:return{...n,type:null,tag:s.jsx(d,{type:null})}}},h=({kandidat:t,forespørselCvForKandidat:r,beskjedForKandidat:a})=>{const o=t.utfallsendringer?.some(i=>i.utfall===v.PRESENTERT&&i.sendtTilArbeidsgiversKandidatliste),n=t.utfallsendringer?.map((i,u)=>b(i,o,t.utfallsendringer,u)),_=r?.map(i=>w(i));let p=null;a!==null&&a?.opprettet&&(p={type:a?.eksternStatus?.includes("FEIL")?e.SMS_FEIL:e.SMS_OK,tag:s.jsx(d,{type:a?.eksternStatus?.includes("FEIL")?e.SMS_FEIL:e.SMS_OK}),tekst:F((a?.eksternFeilmelding||"").replace(/[_-]/g," ")),dato:new Date(a?.opprettet),raw:a});const l=p?[p]:[],c=[..._??[],...n??[]].filter(i=>i.type!==null).sort((i,u)=>(u.dato?.getTime()||0)-(i.dato?.getTime()||0))[0],f=l?l.sort((i,u)=>(u.dato?.getTime()||0)-(i.dato?.getTime()||0))[0]:null;return{utfallsendringer:n,cvHendelser:_,varsler:l,sisteSms:f,sisteHendelse:c}},N=(t,r,a)=>{const o=t.aktørid&&r?r[t.aktørid]:null,n=a&&a[t.fodselsnr??""],_=h({kandidat:t,forespørselCvForKandidat:o,beskjedForKandidat:n});return{...t,kandidatHendelser:_}},E=K.createContext(void 0),L=({children:t,kandidatliste:r,forespurteKandidater:a,beskjeder:o,reFetchKandidatliste:n})=>{const{stillingsData:_,kandidatlisteInfo:p}=D(),[l,c]=K.useState([]),f=p?.kandidatlisteStatus==="LUKKET",y=r?.organisasjonReferanse,i=_?.stilling?.employer?.orgnr,u=!!(y&&i&&y!==i),k=g=>{if(c&&l){const A=l.some(T=>T.fodselsnr===g.fodselsnr)?l.filter(T=>T.fodselsnr!==g.fodselsnr):[...l,g];c(A)}},x=r.kandidater?r.kandidater.map(g=>N(g,a,o)):[];return s.jsxs(E.Provider,{value:{forespurteKandidater:a,beskjeder:o,markerteKandidater:l,setMarkerteKandidater:c,lukketKandidatliste:f,reFetchKandidatliste:n,toggleMarkerKandidat:k,kandidatlisteId:r.kandidatlisteId,usynligeKandidater:r.formidlingerAvUsynligKandidat,kandidater:x,kandidatlisteRawData:r},children:[u&&s.jsx(j,{}),t]})},q=()=>{const t=K.useContext(E);if(t===void 0)throw new C({message:"Context er undefined, må være children av KandidatlisteContextProvider."});return t};L.__docgenInfo={description:"",methods:[],displayName:"KandidatlisteContextProvider",props:{children:{required:!1,tsType:{name:"union",raw:"ReactNode | undefined",elements:[{name:"ReactNode"},{name:"undefined"}]},description:""},kandidatliste:{required:!0,tsType:{name:"z.infer",elements:[{name:"kandidatlisteSchema"}],raw:"z.infer<typeof kandidatlisteSchema>"},description:""},forespurteKandidater:{required:!0,tsType:{name:"z.infer",elements:[{name:"ForespurteOmDelingAvCvSchema"}],raw:`z.infer<
  typeof ForespurteOmDelingAvCvSchema
>`},description:""},beskjeder:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"z.infer",elements:[{name:"SmsSchema"}],raw:"z.infer<typeof SmsSchema>"}],raw:"Record<string, Sms>"},description:""},reFetchKandidatliste:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{L as K,q as u};
