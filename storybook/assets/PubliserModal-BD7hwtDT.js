import{u as q,r,b1 as G,O as Q,b5 as X,av as Y,j as e,d as h,H as D,v as Z,cz as ee,f as se}from"./iframe-CZslivju.js";import{D as M}from"./DatoVelger-Da0qjenr.js";import{p as P}from"./parse-Ct7n3oJ2.js";import{f as m,i as w}from"./format-DMpFMWtq.js";import{p as te}from"./parseISO-B7rV6_4O.js";import{U as ie}from"./umamiEvents-D8PysN3T.js";import{M as b}from"./Modal-CUJSlshC.js";import{B as re}from"./Box-DaZSnmM8.js";import{C as le}from"./Checkbox-BVf788ps.js";import{T as f}from"./ToggleGroup-DgZq6u7v.js";import{T as I}from"./TextField-BO9p5NR-.js";const ne=s=>s.replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})(?!:)/,"$1:00").replace(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\.(\d{3})\d+(.*)$/,"$1.$2$3"),O=s=>{if(!s)return null;if(/^\d{2}\.\d{2}\.\d{4}$/.test(s)){const o=P(s,"dd.MM.yyyy",new Date);return w(o)?m(o,"yyyy-MM-dd'T'00:00:00"):null}const l=te(ne(s));return w(l)?m(l,"yyyy-MM-dd'T'HH:mm:ss"):null},oe=s=>{const l=O(s.stilling?.published),o=O(s.stilling?.expires);return{...s,stilling:{...s.stilling,properties:{...s.stilling.properties,tags:typeof s.stilling?.properties?.tags=="string"?s.stilling?.properties?.tags:JSON.stringify(s.stilling?.properties?.tags??[]),workday:typeof s.stilling?.properties?.workday=="string"?s.stilling?.properties?.workday:JSON.stringify(s.stilling?.properties?.workday??[]),workhours:typeof s.stilling?.properties?.workhours=="string"?s.stilling?.properties?.workhours:JSON.stringify(s.stilling?.properties?.workhours??[])},published:l,expires:o}}};function ae({disabled:s}){const{brukerData:l,valgtNavKontor:o}=q(),p=r.useRef(null),{watch:a,setValue:n,getValues:y}=G(),{track:T}=Q(),C=X(),E=a("stilling.privacy"),L=a("stilling.published"),H=a("stilling.expires"),A=a("stilling.properties.applicationemail"),k=a("stilling.properties.applicationurl"),[V,v]=r.useState(!1),_=Y(y().stilling.uuid),x=t=>{if(t)try{return m(new Date(t),"dd.MM.yyyy")}catch{return}},[u,$]=r.useState(x(L)),[c,z]=r.useState(x(H)),[g,B]=r.useState(E==="SHOW_ALL"),F=k?"url":"email",[d,R]=r.useState(F),[j,U]=r.useState(A??""),[S,J]=r.useState(k??""),N=t=>{if(!t)return null;const i=P(t,"dd.MM.yyyy",new Date);return m(i,"yyyy-MM-dd'T'HH:mm:ss")},K=async()=>{v(!0);try{n("stilling.published",N(u),{shouldDirty:!0}),n("stilling.expires",N(c),{shouldDirty:!0}),n("stilling.privacy",g?"SHOW_ALL":"INTERNAL_NOT_SHOWN",{shouldDirty:!0}),g&&(d==="email"?(n("stilling.properties.applicationemail",j||null,{shouldDirty:!0}),n("stilling.properties.applicationurl",null,{shouldDirty:!0})):(n("stilling.properties.applicationurl",S||null,{shouldDirty:!0}),n("stilling.properties.applicationemail",null,{shouldDirty:!0})));const t=oe(y()),i={...t,stillingsinfo:{...t.stillingsinfo},stilling:{...t.stilling,status:"ACTIVE",administration:{...t.stilling.administration,status:"DONE"},firstPublished:!0}};T(ie.Stilling.ny_stilling_info,{yrkestittel:i.stilling.categoryList?.[0]?.name,sektor:i.stilling.properties?.sector,ansettelsesform:i.stilling.properties?.engagementtype,arbeidstidsordning:i.stilling?.properties?.jobarrangement,omfangIProsent:i.stilling.properties?.jobpercentage,arbeidssted:i.stilling.locationList});try{await ee(i,{eierNavident:l.ident,eierNavn:l.navn,eierNavKontorEnhetId:o?.navKontor})}catch(W){alert("Feil ved opprettelse av stilling"),new se({message:"Feil ved opprettelse av stilling",error:W})}p.current?.close(),_.mutate(),C.push(`/stilling/${y().stilling.uuid}`)}catch{alert("Uventet feil ved publisering")}finally{v(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"small",disabled:s,onClick:()=>p.current?.showModal(),children:"Publiser"}),e.jsxs(b,{ref:p,header:{heading:"Publiser stillingsoppdraget"},children:[e.jsxs(b.Body,{children:[e.jsxs(re.New,{background:"neutral-soft",padding:"6",className:"mb-8",children:[e.jsx(D,{size:"small",className:"mb-2",children:"Dette skjer når du publiserer oppdraget"}),e.jsxs("ul",{className:"list-disc pl-5 text-sm mb-4",children:[e.jsx("li",{children:"Stillingsoppdraget blir synlig for Nav-ansatte i rekrutteringsbistand."}),e.jsx("li",{children:"Ansatte hos arbeidsgiveren på Min Side Arbeidsgiver på nav.no (med Altinn-tilgang)."}),e.jsx("li",{children:"Jobbsøkere som får stillingen delt i aktivitetsplanen."})]}),e.jsx(Z,{size:"small",children:"Ikke alt må være helt perfekt! Du kan når som helst endre eller avpublisere oppdraget."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(M,{disablePastDates:!0,label:"Publiseringsdato",valgtDato:u,tilDato:c,setDato:t=>$(t)}),e.jsx(M,{disablePastDates:!0,label:"Siste visningsdato",valgtDato:c,fraDato:u,setDato:t=>z(t)})]}),e.jsx(le,{checked:g,onChange:t=>B(t.target.checked),children:"Publiser stillingsoppdraget offentlig på arbeidsplassen.no også"}),g&&e.jsxs("div",{children:[e.jsx(D,{size:"small",className:"mb-4",children:"Hvordan skal jobbsøker søke?"}),e.jsxs(f,{fill:!0,defaultValue:d,onChange:t=>R(t),children:[e.jsx(f.Item,{value:"email",label:"E-post"}),e.jsx(f.Item,{value:"url",label:"Søknadsskjema"})]}),d==="email"&&e.jsx("div",{className:"mt-4",children:e.jsx(I,{label:"E-post",value:j,onChange:t=>U(t.target.value)})}),d==="url"&&e.jsx("div",{className:"mt-4",children:e.jsx(I,{label:"Lenke til søknadsskjema",value:S,onChange:t=>J(t.target.value)})})]})]})]}),e.jsxs(b.Footer,{children:[e.jsx(h,{loading:V,type:"button",onClick:K,children:"Publiser oppdraget"}),e.jsx(h,{type:"button",variant:"secondary",onClick:()=>p.current?.close(),children:"Avbryt"})]})]})]})}ae.__docgenInfo={description:"",methods:[],displayName:"PubliserModal",props:{disabled:{required:!0,tsType:{name:"boolean"},description:""}}};export{ae as P,oe as m};
