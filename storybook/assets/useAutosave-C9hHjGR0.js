import{b2 as h,bJ as D,b4 as d,r as m,bK as w,bL as B,D as P,bM as T,b7 as C,bN as V,b8 as S}from"./iframe-C1ovTrJQ.js";import{f as j}from"./index-CKttYGEK.js";import{t as I}from"./utils-IaHeB-aP.js";function M(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:o}=h(),{data:l,mutate:n}=D(t),s=l?.[0],{getValues:a,setValue:f}=d();return{lagre:m.useCallback(async()=>{if(!t)return;const i=(a().htmlContent??"").toString();if(i.trim().length!==0)try{const c=s?.opprettetAvPersonNavn||s?.opprettetAvPersonNavident||"Markedskontakt",u={htmlContent:i,tittel:"Om treffet",opprettetAvPersonNavn:c,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:j(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};r("innlegg"),s?.id?await w(t,s.id,u):await B(t,u),n(),f("htmlContent",i,{shouldDirty:!1})}catch(c){new P({message:"Lagring av innlegg feilet.",error:c})}finally{o("innlegg")}},[a,s,n,t,r,o,f]),innlegg:s}}function O(){const{rekrutteringstreffId:t,startLagring:r,stoppLagring:o}=h(),{mutate:l}=T(t),{treff:n}=C(),{getValues:s}=d(),a=m.useCallback(()=>{const e=s(),g=I(e.fraDato??null,e.fraTid)??n?.fraTid??null,i=I(e.tilDato??e.fraDato??null,e.tilTid)??n?.tilTid??null,c=I(e.svarfristDato??null,e.svarfristTid)??n?.svarfrist??null,u=typeof e.tittel=="string"?e.tittel.trim():"";return{tittel:u.length>0?u:n?.tittel??"Treff uten navn",beskrivelse:e.beskrivelse??n?.beskrivelse??null,fraTid:g,tilTid:i,svarfrist:c,gateadresse:e.gateadresse??n?.gateadresse??null,postnummer:e.postnummer??n?.postnummer??null,poststed:e.poststed??n?.poststed??null,kommune:e.kommune??n?.kommune??null,kommunenummer:e.kommunenummer??n?.kommunenummer??null,fylke:e.fylke??n?.fylke??null,fylkesnummer:e.fylkesnummer??n?.fylkesnummer??null}},[s,n]);return{lagre:m.useCallback(async()=>{if(!t)return;const e=a();try{r("rekrutteringstreff"),await V(t,e),l()}finally{o("rekrutteringstreff")}},[a,t,l,r,o]),byggRekrutteringstreffDto:a}}const E=()=>{try{return!1}catch{return!1}},N=t=>t===S.PUBLISERT||t===S.FULLFÃ˜RT;function F(){const{watch:t,formState:r}=d(),o=t("tittelKiFeil")??!1,l=t("htmlContentKiFeil")??!1,n=!!o||!!l,s=!!(r.errors&&Object.keys(r.errors).some(c=>c!=="root")),a=n||s,f=!!r?.errors?.tittel,e=!!r?.errors?.htmlContent,g=!!t("tittelKiSjekket"),i=!!t("htmlContentKiSjekket");return{harFeil:a,harKiFeil:n,harAndreSkjemafeil:s,tittelKiFeil:o,innleggKiFeil:l,harTittelFeil:f,harInnleggFeil:e,tittelKiSjekket:g,innleggKiSjekket:i}}const K=(t,r,o,l)=>t||!r?!1:!l||o;function J(){const{rekrutteringstreffId:t}=h(),{treff:r}=C(),{getValues:o,trigger:l,formState:n}=d(),{lagre:s,byggRekrutteringstreffDto:a}=O(),{tittelKiFeil:f,tittelKiSjekket:e}=F(),g=m.useCallback(async(u,p)=>{if(!t||!await l(u&&u.length>0?u:void 0,{shouldFocus:!1}))return;if(n?.errors?.root?.type==="manualPeriod"){const v=a();if((v?.fraTid??null)!==(r?.fraTid??null)||(v?.tilTid??null)!==(r?.tilTid??null))return}const k=o(),y=typeof k.tittel=="string"?k.tittel.trim():"",b=y.length>0&&y!==(r?.tittel??"");K(p??!1,b,f,e)||await s()},[t,r,a,l,n,o,s,e,f]),i=m.useCallback(async()=>{},[]);return{autosave:m.useMemo(()=>L(r)?i:g,[r,i,g])}}function U(){const{rekrutteringstreffId:t}=h(),{data:r}=T(t),{getValues:o,trigger:l}=d(),{lagre:n,innlegg:s}=M(),{harInnleggFeil:a,innleggKiFeil:f,innleggKiSjekket:e}=F(),g=m.useCallback(async(u,p)=>{if(!t||u&&u.length&&!await l(u,{shouldFocus:!1}))return;const k=(o().htmlContent??"").toString();if(!(k.trim().length>0)||a)return;const b=s?.htmlContent??"",v=k.trim().length>0&&k!==b;K(p??!1,v,f,e)||await n()},[t,l,o,n,s,a,f,e]),i=m.useCallback(async()=>{},[]);return{autosave:m.useMemo(()=>L(r)?i:g,[r,i,g])}}const L=t=>N(t?.status)&&E();export{E as a,J as b,N as e,U as u};
