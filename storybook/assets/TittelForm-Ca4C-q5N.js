import{bj as M,bX as S,bZ as V,r as y,j as e,H as D,C as N,B as _,bl as G,A as I,b_ as P,d as Y,aI as z,aO as H}from"./iframe-CRS9-BOb.js";import{b as R}from"./useAutosave-DQ2NL4TU.js";import{T as k}from"./TextField-CQTEAwj1.js";import{T as X,S as q}from"./TidspunktForm-DVIaPRUX.js";import{B as x}from"./Box-ju1jJ9nB.js";import{K as W}from"./KiAnalyseIntro-0PYaek7-.js";import{K as Z}from"./KiAnalysePanel-BsDxkzNB.js";import{u as $}from"./useFormFeltMedKiValidering-BFjuiqlg.js";import{S as J}from"./Skeleton-L4g9UQun.js";const t={GATEADRESSE:"gateadresse",POSTNUMMER:"postnummer",POSTSTED:"poststed",FYLKE:"fylke",FYLKESNUMMER:"fylkesnummer",KOMMUNE:"kommune",KOMMUNENUMMER:"kommunenummer"},O=({control:n})=>{const{setValue:s,clearErrors:m,setError:h,trigger:E}=M(),{autosave:d}=R(),l=S({control:n,name:t.POSTNUMMER}),{data:i,isLoading:c}=V(l||"");return y.useEffect(()=>{if(!l||l.length!==4||c)return;const r={shouldDirty:!0,shouldValidate:!0};i?.korrigertNavnBy?(s(t.POSTSTED,i.korrigertNavnBy,r),s(t.KOMMUNE,i.kommune.korrigertNavn,r),s(t.KOMMUNENUMMER,i.kommune.kommunenummer,r),s(t.FYLKE,i.fylke.korrigertNavn,r),s(t.FYLKESNUMMER,i.fylke.fylkesnummer,r),m(t.POSTSTED)):(s(t.POSTSTED,"",r),s(t.KOMMUNE,"",r),s(t.KOMMUNENUMMER,"",r),s(t.FYLKE,"",r),s(t.FYLKESNUMMER,"",r),h(t.POSTSTED,{type:"manual",message:"Ukjent poststed"}))},[l,c,i,s,h,m]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{level:"3",size:"small",children:"Sted"}),e.jsx(N,{name:t.GATEADRESSE,control:n,render:({field:r,fieldState:g})=>e.jsx(k,{...r,value:r.value??"",label:"Gateadresse",error:g.error?.message,maxLength:100,onBlur:()=>{r.onBlur(),d([t.GATEADRESSE])}})}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(N,{name:t.POSTNUMMER,control:n,render:({field:r,fieldState:g})=>e.jsx(k,{...r,value:r.value??"",label:"Postnummer",htmlSize:12,error:g.error?.message,onChange:T=>{const f=T.target.value.replace(/\D/g,"");m([t.POSTNUMMER,t.POSTSTED]),s(t.POSTSTED,"",{shouldDirty:!1,shouldValidate:!0}),f.length<=4&&r.onChange(f),f.length===4&&E([t.POSTNUMMER])},onBlur:()=>{r.onBlur(),d([t.POSTNUMMER,t.POSTSTED])}})}),e.jsx(_,{className:`mt-3 pt-8 ${S({control:n,name:t.POSTSTED})?"":"aksel-error-message"}`,children:S({control:n,name:t.POSTSTED})||(l&&l.length===4&&!c?"Ukjent poststed":"")})]})]})};O.__docgenInfo={description:"",methods:[],displayName:"StedForm"};const Q=()=>{const{control:n}=M();return e.jsxs("div",{className:"space-y-8",children:[e.jsx(D,{level:"2",size:"medium",children:"Praktiske forhold"}),e.jsx(x.New,{background:"neutral-moderate",borderRadius:"xlarge",padding:"3",children:e.jsx(X,{control:n})}),e.jsx(x.New,{background:"neutral-moderate",borderRadius:"xlarge",padding:"3",children:e.jsx(q,{control:n})}),e.jsx(x.New,{background:"neutral-moderate",borderRadius:"xlarge",padding:"3",children:e.jsx(O,{control:n})})]})};Q.__docgenInfo={description:"",methods:[],displayName:"PraktiskeForhold"};const ee="Treff uten navn",K=({onUpdated:n})=>{const{treff:s}=G(),m=s?s.tittel??null:void 0,{clearErrors:h,formState:{isSubmitting:E}}=M(),d=y.useRef(null),{autosave:l}=R(),i=y.useCallback(async(o,u)=>{try{await l(o,u)}catch(a){new I({message:"Lagring av tittel feilet.",error:a})}finally{n?.()}},[l,n]),{analyse:c,analyseError:r,validating:g,kiErrorBorder:T,harGodkjentKiFeil:f,showAnalysis:L,erRedigeringAvPublisertTreff:U,validerMedKiOgLagreVedGodkjenning:j,onGodkjennKiFeil:A,watchedValue:p,control:B,setValue:F,kiLoggLoading:b}=$({feltType:"tittel",fieldName:"tittel",savedValue:m,saveCallback:i,onUpdated:n}),w=P-(typeof p=="string"?p.length:0),C=()=>{F("tittel","",{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),d.current?.focus()};return e.jsxs("section",{className:"space-y-3",children:[b&&e.jsx(J,{variant:"text"}),!b&&e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Navn på treffet"}),e.jsxs("div",{className:"relative w-full",onBlur:o=>{const u=o.currentTarget;setTimeout(async()=>{!u.contains(document.activeElement)&&!E&&await j()},0)},children:[p&&e.jsx(Y,{type:"button",onClick:C,"aria-label":"Tøm tittel feltet",variant:"tertiary",size:"small",className:"absolute top-[2rem] right-2 h-8 -translate-y-1/2 p-1",title:"Tøm feltet",children:e.jsx(z,{"aria-hidden":!0,fontSize:"1.25rem"})}),e.jsx("div",{className:"flex items-start",children:e.jsx(N,{control:B,name:"tittel",render:({field:o,fieldState:u})=>e.jsx(k,{...o,value:o.value??"",ref:a=>{o.ref(a),d.current=a},label:"Navn på treffet",hideLabel:!0,maxLength:P,className:"w-full pt-2",error:u.error?.message||(T?"Brudd på retningslinjer":void 0),"aria-invalid":!!(u.error||T),autoComplete:"off",autoCorrect:"off",spellCheck:!1,onChange:a=>{o.onChange(a),a.target.value.trim().length>0&&h("tittel")},onBlur:()=>{o.onBlur()},onFocus:()=>{const a=o.value;if(!a||typeof a!="string")return;a.trim()===ee&&F("tittel","",{shouldValidate:!1,shouldDirty:!1,shouldTouch:!1})},onKeyDown:a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),(async()=>{const v=a.currentTarget;await j(),v?.blur()})())}})})})]}),e.jsxs(H,{className:"text-gray-400",children:[w," tegn igjen"]}),e.jsx(Z,{validating:g,analyse:c,analyseError:r,harGodkjentKiFeil:f,showAnalysis:L,erRedigeringAvPublisertTreff:U,onGodkjennKiFeil:A,ariaLabel:"Analyse av tittel"})]})]})};K.displayName="TittelForm";K.__docgenInfo={description:"",methods:[],displayName:"TittelForm",props:{onUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{Q as P,O as S,K as T};
