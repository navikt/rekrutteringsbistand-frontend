import{be as h,bP as L,bg as p,r as d,bQ as R,bR as w,x as P,bS as S,bT as B,bU as D,bC as C}from"./iframe-BqqySmLp.js";import{f as j}from"./index-CveF8mzD.js";import{t as I}from"./utils-CSHrK6jL.js";function E(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:o}=h(),{data:n,mutate:i}=L(t),s=n?.[0],{getValues:a,setValue:u}=p();return{lagre:d.useCallback(async()=>{if(!t)return;const l=(a().htmlContent??"").toString();if(l.trim().length!==0)try{const g=s?.opprettetAvPersonNavn||s?.opprettetAvPersonNavident||"Markedskontakt",f={htmlContent:l,tittel:"Om treffet",opprettetAvPersonNavn:g,opprettetAvPersonBeskrivelse:"Markedskontakt",sendesTilJobbsokerTidspunkt:j(new Date,"Europe/Oslo","yyyy-MM-dd'T'HH:mm:ssXXX")};e("innlegg"),s?.id?await R(t,s.id,f):await w(t,f),i(),u("htmlContent",l,{shouldDirty:!1})}catch(g){new P({message:"Lagring av innlegg feilet.",error:g})}finally{o("innlegg")}},[a,s,i,t,e,o,u]),innlegg:s}}function M(){const{rekrutteringstreffId:t,startLagring:e,stoppLagring:o}=h(),{data:n,mutate:i}=S(t),{getValues:s}=p(),a=d.useCallback(()=>{const r=s(),c=I(r.fraDato??null,r.fraTid)??n?.fraTid??null,l=I(r.tilDato??r.fraDato??null,r.tilTid)??n?.tilTid??null,g=I(r.svarfristDato??null,r.svarfristTid)??n?.svarfrist??null,f=typeof r.tittel=="string"?r.tittel.trim():"";return{tittel:f.length>0?f:n?.tittel??"Treff uten navn",beskrivelse:r.beskrivelse??n?.beskrivelse??null,fraTid:c,tilTid:l,svarfrist:g,gateadresse:r.gateadresse??n?.gateadresse??null,postnummer:r.postnummer??n?.postnummer??null,poststed:r.poststed??n?.poststed??null}},[s,n]);return{lagre:d.useCallback(async()=>{if(!t)return;const r=a();try{e("rekrutteringstreff"),await B(t,r),i()}finally{o("rekrutteringstreff")}},[a,t,i,e,o]),byggRekrutteringstreffDto:a}}const O=()=>{try{return!1}catch{return!1}},x=t=>{const e=D(t?.hendelser);return e===C.INVITERE||e===C.FULLFÃ˜RE};function K(){const{watch:t,formState:e}=p(),o=t("tittelKiFeil")??!1,n=t("htmlContentKiFeil")??!1,i=!!o||!!n,s=!!(e.errors&&Object.keys(e.errors).some(g=>g!=="root")),a=i||s,u=!!e?.errors?.tittel,r=!!e?.errors?.htmlContent,c=!!t("tittelKiSjekket"),l=!!t("htmlContentKiSjekket");return{harFeil:a,harKiFeil:i,harAndreSkjemafeil:s,tittelKiFeil:o,innleggKiFeil:n,harTittelFeil:u,harInnleggFeil:r,tittelKiSjekket:c,innleggKiSjekket:l}}const A=(t,e,o,n)=>t||!e?!1:!n||o;function U(){const{rekrutteringstreffId:t}=h(),{data:e}=S(t),{getValues:o,trigger:n,formState:i}=p(),{lagre:s,byggRekrutteringstreffDto:a}=M(),{tittelKiFeil:u,tittelKiSjekket:r}=K(),c=d.useCallback(async(f,k)=>{if(!t||!await n(f&&f.length>0?f:void 0,{shouldFocus:!1}))return;if(i?.errors?.root?.type==="manualPeriod"){const v=a();if((v?.fraTid??null)!==(e?.fraTid??null)||(v?.tilTid??null)!==(e?.tilTid??null))return}const y=o(),m=typeof y.tittel=="string"?y.tittel.trim():"",T=m.length>0&&m!==(e?.tittel??"");A(k??!1,T,u,r)||await s()},[t,e,a,n,i,o,s,r,u]),l=d.useCallback(async(f,k)=>{},[]);return{autosave:d.useMemo(()=>V(e)?l:c,[e,l,c])}}function J(){const{rekrutteringstreffId:t}=h(),{data:e}=S(t),{getValues:o,trigger:n,formState:i}=p(),{lagre:s,innlegg:a}=E(),{harInnleggFeil:u,innleggKiFeil:r,innleggKiSjekket:c}=K(),l=d.useCallback(async(k,b)=>{if(!t||k&&k.length&&!await n(k,{shouldFocus:!1}))return;const m=(o().htmlContent??"").toString();if(!(m.trim().length>0)||u)return;const v=a?.htmlContent??"",F=m.trim().length>0&&m!==v;A(b??!1,F,r,c)||await s()},[t,e,n,i,o,s,a,u,r,c]),g=d.useCallback(async(k,b)=>{},[]);return{autosave:d.useMemo(()=>V(e)?g:l,[e,g,l])}}const V=t=>x(t)&&O();export{O as a,U as b,x as e,J as u};
