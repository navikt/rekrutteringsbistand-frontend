import{r as c,j as e,d as m,F as V,br as L,x as D,bg as _,L as q,B as k}from"./iframe-DwwpuTFP.js";import{M as p}from"./Modal-CKTckRfk.js";import{t as P,f as A}from"./utils-D5QFWBze.js";const J=({rekrutteringstreffId:t,oppdaterData:s})=>{const[a,n]=c.useState(!1),r=c.useRef(null),i=()=>r.current?.showModal(),o=()=>{a||r.current?.close()},d=async()=>{if(a)return;n(!0);let u=!1;try{await L(t),s(),u=!0}catch(h){new D({message:"Gjenåpning av rekrutteringstreff feilet",error:h})}finally{n(!1),u&&r.current?.close()}};return e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"button",size:"small",variant:"primary",loading:a,onClick:i,children:"Gjenåpne"}),e.jsxs(p,{ref:r,onClose:()=>{a&&r.current?.showModal()},header:{heading:"Gjenåpne rekrutteringstreffet?"},children:[e.jsx(p.Body,{children:e.jsx(V,{children:"Treffet blir aktivt igjen, og du kan gjøre endringer eller sende nye invitasjoner. Er du sikker på at du vil fortsette?"})}),e.jsxs(p.Footer,{children:[e.jsx(m,{type:"button",size:"small",loading:a,onClick:()=>void d(),children:"Gjenåpne"}),e.jsx(m,{type:"button",size:"small",variant:"secondary",disabled:a,onClick:o,children:"Avbryt"})]})]})]})};J.__docgenInfo={description:"",methods:[],displayName:"GjenapneRekrutteringstreffButton",props:{rekrutteringstreffId:{required:!0,tsType:{name:"string"},description:""},oppdaterData:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const y=(t,s)=>{if(!t)return null;const a=s?.trim()||"00:00";return P(t,a)},x=t=>t?A(t):"",g=(t,s,a,n,r)=>{const i=u=>r?r(u):u??"",o=i(a),d=i(n);o!==d&&t.push({etikett:s,gammelVerdi:o,nyVerdi:d})},H=(t,s,a)=>{const n=[],r=y(t.fraDato,t.fraTid)??s?.fraTid,i=y(t.tilDato??t.fraDato,t.tilTid)??s?.tilTid,o=y(t.svarfristDato,t.svarfristTid)??s?.svarfrist,d=t.tittel?.trim()||s?.tittel||"";return g(n,"Tittel",s?.tittel,d),g(n,"Beskrivelse",s?.beskrivelse,t.beskrivelse??s?.beskrivelse),g(n,"Fra",s?.fraTid,r,x),g(n,"Til",s?.tilTid,i,x),g(n,"Svarfrist",s?.svarfrist,o,x),g(n,"Gateadresse",s?.gateadresse,t.gateadresse??s?.gateadresse),g(n,"Postnummer",s?.postnummer,t.postnummer??s?.postnummer),g(n,"Poststed",s?.poststed,t.poststed??s?.poststed),(a||"")!==(t.htmlContent||"")&&n.push({etikett:"Innlegg",gammelVerdi:"Innhold endret",nyVerdi:"Innhold endret"}),n},U=({treff:t,innleggHtmlFraBackend:s})=>{const a=c.useRef(null),{getValues:n,watch:r,formState:i}=_(),[o,d]=c.useState([]),[u,h]=c.useState([]),[j,v]=c.useState(!1);c.useEffect(()=>{if(!t){d([]);return}const l=()=>{const z=n(),B=H(z,t,s||"");d(M=>JSON.stringify(M)===JSON.stringify(B)?M:B)};l();const f=r(()=>{l()});return()=>f.unsubscribe()},[t,r,n,s]),c.useEffect(()=>{j&&!i.isSubmitting?((!i.errors||Object.keys(i.errors).length===0)&&N(),v(!1)):i.isSubmitting&&!j&&v(!0)},[i.isSubmitting,i.errors,j]);const S=r("tittelKiSjekket")??!1,T=r("htmlContentKiSjekket")??!1,C=r("tittelKiFeil")??!1,K=r("htmlContentKiFeil")??!1,w=C||K,G=!!(i.errors&&Object.keys(i.errors).some(l=>l!=="root")),I=w||G,F=t?.tittel?.trim()==="Treff uten navn",R=o.some(l=>l.etikett==="Tittel"),E=o.some(l=>l.etikett==="Innlegg"),b=c.useMemo(()=>o.length===0||I||!((!R||S)&&(!E||T))||F,[o.length,I,R,E,S,T,F]),O=()=>{b||(h([...o]),a.current?.showModal())},N=()=>a.current?.close();return e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"button",variant:"primary",size:"small",disabled:b,onClick:O,children:"Publiser på nytt"}),e.jsxs(p,{ref:a,header:{heading:"Følgende endringer vil bli publisert"},children:[e.jsx(p.Body,{children:e.jsxs("div",{className:"space-y-3",children:[u.length===0?e.jsx(V,{children:"Ingen endringer oppdaget."}):e.jsx("div",{className:"space-y-3",children:u.map((l,f)=>e.jsxs("div",{className:"border-b pb-2",children:[e.jsx(q,{size:"small",children:l.etikett}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Fra:"}),e.jsx(k,{className:"text-gray-400",children:l.gammelVerdi||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{children:"Til:"}),e.jsx(k,{className:"text-gray-400",children:l.nyVerdi||"—"})]})]},f))}),e.jsx(k,{className:"text-gray-600",children:"Inviterte deltakere vil ikke bli informert om endringene på nytt av republiseringen"})]})}),e.jsxs(p.Footer,{children:[e.jsx(m,{type:"submit",form:"rekrutteringstreff-form",variant:"primary",size:"small",disabled:b,loading:i.isSubmitting,children:"Publiser på nytt"}),e.jsx(m,{type:"button",variant:"secondary",size:"small",onClick:N,disabled:i.isSubmitting,children:"Avbryt"})]})]})]})};U.__docgenInfo={description:`Komponent for å republisere et rekrutteringstreff.
Viser en knapp som åpner en modal for bekreftelse av endringer før republisering.`,methods:[],displayName:"RepubliserRekrutteringstreffButton",props:{treff:{required:!0,tsType:{name:"any"},description:""},innleggHtmlFraBackend:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};export{J as G,U as R};
