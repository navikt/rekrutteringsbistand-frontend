import{e as B,a as O}from"./useRekrutteringstreffValidering-C19MGaG_.js";import{h5 as J,o as G,ak as Q,T as w,U as X,h2 as Y,hC as Z,h4 as _,hD as U,r as a,w as p}from"./iframe-2oXcNiqk.js";import{a as N,u as ee}from"./useKiLogg-BrHyAcvz.js";const te=(t=":id")=>`${J.internUrl}/${t}/ki/valider`,re=G({feltType:w(),tekst:w()}),se=G({loggId:w(),bryterRetningslinjer:X(),begrunnelse:w()}),ae=async(t,{arg:e})=>{const u=e.tekst.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),f={...e,tekst:u};re.parse(e);const n=await Q(t,f);return se.parse(n)},ne=t=>N(te(t??":id"),ae),A=t=>t==null?"":String(t).replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();function ce({feltType:t,fieldName:e,savedValue:u,saveCallback:f,onUpdated:n,requireHasCheckedToShow:T=!1}){const{rekrutteringstreffId:K}=Y(),{data:M}=Z(K),{control:F,setValue:r,getValues:V,trigger:S}=_(),{setLagret:i,isLoading:x}=ee(K,t),$=U({control:F,name:e}),h=B(M)&&O(),{trigger:E,data:s,reset:L,error:g,isMutating:H}=ne(K),[c,v]=a.useState(null),[k,y]=a.useState(!1),[C,R]=a.useState(!1);a.useEffect(()=>{R(!1),y(!1),v(null),L(),r(`${e}KiSjekket`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[$,L,e,r]);const P=!!s&&!g&&s?.bryterRetningslinjer&&!k;a.useEffect(()=>{const o=!!s&&!g&&!!s?.bryterRetningslinjer&&!k;r(`${e}KiFeil`,o,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[s,g,k,e,r]);const b=a.useCallback(async o=>{try{await f([e],o)}catch(d){new p({message:`Lagring av ${t} feilet.`,error:d})}finally{n?.()}},[f,e,t,n]),W=a.useCallback(async()=>{if(!await S(e))return;const d=V(e),m=(typeof d=="string"?d:String(d??"")).trim(),D=A(m);if(D){if(u!==void 0){const l=A(u);if(D===l)return}try{const l=await E({feltType:t,tekst:m});R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1});const j=l?.loggId??s?.loggId??null;if(v(j),!(l?.bryterRetningslinjer??s?.bryterRetningslinjer)&&(await b(),j&&i))try{await i({id:j,lagret:!0})}catch(z){new p({message:`Feil ved oppdatering av /lagret for logg ${j}.`,error:z})}}catch(l){new p({message:"Validation failed:",error:l}),R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})}}},[S,e,V,E,t,h,b,i,s,r,u]),q=a.useCallback(async()=>{if(h){y(!0),R(!0),r(`${e}KiSjekket`,!0,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),r(`${e}KiFeil`,!1,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1}),n?.();return}if(y(!0),await b(!0),c&&i)try{await i({id:c,lagret:!0})}catch(o){new p({message:`Feil ved oppdatering av /lagret for logg ${c}.`,error:o})}},[h,b,c,i,e,r,n]),I=!!s&&!g&&!!s?.bryterRetningslinjer;return{analyse:s,analyseError:g,validating:H,kiErrorBorder:P,harGodkjentKiFeil:k,setHarGodkjentKiFeil:y,loggId:c,hasChecked:C,showAnalysis:T?C&&I:I,erRedigeringAvPublisertTreff:h,validerMedKiOgLagreVedGodkjenning:W,onGodkjennKiFeil:q,watchedValue:$,control:F,setValue:r,getValues:V,kiLoggLoading:x}}export{ce as u};
