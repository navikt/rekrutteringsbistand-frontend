import{h4 as D,hE as y,r as x,j as e,H as N,aP as j,B as w,hb as _,e as G,Y as I,a0 as z}from"./iframe-XlTllAuX.js";import{b as O}from"./useAutosave-Dk-BOYyy.js";import{u as H}from"./usePamPostdata-CYLmmOE2.js";import{T as P}from"./TextField-DHbqj0uk.js";import{T as X,S as q}from"./TidspunktForm-M5iMqb_h.js";import{K as W}from"./KiAnalyse-DQANoru0.js";import{K as Y}from"./KiAnalysePanel-BGQULcgV.js";import{u as $}from"./useFormFeltMedKiValidering-CRM0cqRZ.js";import{M}from"./mutations-DA1fSo6A.js";import{S as J}from"./Skeleton-B47AKrKa.js";const r={GATEADRESSE:"gateadresse",POSTNUMMER:"postnummer",POSTSTED:"poststed"},A=({control:s})=>{const{setValue:o,clearErrors:i,setError:g,trigger:E}=D(),{save:p}=O(),a=y({control:s,name:r.POSTNUMMER}),{data:m,isLoading:d}=H(a||"");return x.useEffect(()=>{!a||a.length!==4||d||(m?.korrigertNavnBy?(o(r.POSTSTED,m.korrigertNavnBy,{shouldDirty:!0,shouldValidate:!0}),i(r.POSTSTED)):(o(r.POSTSTED,"",{shouldDirty:!0,shouldValidate:!0}),g(r.POSTSTED,{type:"manual",message:"Ukjent poststed"})))},[a,d,m,o,g,i]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(N,{level:"3",size:"small",children:"Sted"}),e.jsx(j,{name:r.GATEADRESSE,control:s,render:({field:n,fieldState:u})=>e.jsx(P,{...n,value:n.value??"",label:"Gateadresse",error:u.error?.message,onBlur:()=>{n.onBlur(),p([r.GATEADRESSE])}})}),e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(j,{name:r.POSTNUMMER,control:s,render:({field:n,fieldState:u})=>e.jsx(P,{...n,value:n.value??"",label:"Postnummer",htmlSize:12,error:u.error?.message,onChange:v=>{const c=v.target.value.replace(/\D/g,"");i([r.POSTNUMMER,r.POSTSTED]),o(r.POSTSTED,"",{shouldDirty:!1,shouldValidate:!0}),c.length<=4&&n.onChange(c),c.length===4&&E([r.POSTNUMMER])},onBlur:()=>{n.onBlur(),p([r.POSTNUMMER,r.POSTSTED])}})}),e.jsx(w,{className:`pt-8 ${y({control:s,name:r.POSTSTED})?"":"aksel-error-message"}`,children:y({control:s,name:r.POSTSTED})||(a&&a.length===4&&!d?"Ukjent poststed":"")})]})]})};A.__docgenInfo={description:"",methods:[],displayName:"StedForm"};const Q=()=>{const{control:s}=D();return e.jsxs("div",{className:"space-y-8",children:[e.jsx(N,{level:"2",size:"medium",children:"Praktiske forhold"}),e.jsx(X,{control:s}),e.jsx(q,{control:s}),e.jsx(A,{control:s})]})};Q.__docgenInfo={description:"",methods:[],displayName:"PraktiskeForhold"};const b="Treff uten navn",R=({onUpdated:s})=>{const{treff:o,harPublisert:i}=_(),g=o?o.tittel??null:void 0,{clearErrors:E,formState:{isSubmitting:p}}=D(),a=x.useRef(null),{save:m}=O(),{analyse:d,analyseError:n,validating:u,kiErrorBorder:v,harGodkjentKiFeil:c,showAnalysis:B,erRedigeringAvPublisertTreff:V,runValidationAndMaybeSave:k,onGodkjennKiFeil:C,watchedValue:f,control:K,setValue:F,kiLoggLoading:S}=$({feltType:"tittel",fieldName:"tittel",savedValue:g,saveCallback:m,onUpdated:s}),L=M-(typeof f=="string"?f.length:0),U=()=>{F("tittel","",{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),a.current?.focus()};return x.useEffect(()=>{if(!o||S)return;const l=!i,h=(f??"").trim(),t=h.length===0||h===b;if(l&&t&&a.current){const T=setTimeout(()=>{a.current?.focus()},100);return()=>clearTimeout(T)}},[o,S,f,i]),e.jsxs("section",{className:"space-y-3",children:[S&&e.jsx(J,{variant:"text"}),!S&&e.jsxs(e.Fragment,{children:[e.jsx(N,{level:"2",size:"medium",children:"Navn på treffet"}),e.jsxs("div",{className:"relative w-full",children:[f&&e.jsx(G,{type:"button",onClick:U,"aria-label":"Tøm tittel feltet",variant:"tertiary",size:"small",className:"absolute right-2 top-[2rem] -translate-y-1/2 h-8 p-1",title:"Tøm feltet",children:e.jsx(I,{"aria-hidden":!0,fontSize:"1.25rem"})}),e.jsx("div",{className:"flex items-start",children:e.jsx(j,{control:K,name:"tittel",render:({field:l,fieldState:h})=>e.jsx(P,{...l,value:l.value??"",ref:t=>{l.ref(t),a.current=t},label:"Navn på treffet",hideLabel:!0,maxLength:M,className:"w-full pt-2",error:h.error?.message||(v?"Brudd på retningslinjer":void 0),"aria-invalid":!!(h.error||v),autoComplete:"off",autoCorrect:"off",spellCheck:!1,onChange:t=>{l.onChange(t),t.target.value.trim().length>0&&E("tittel")},onBlur:async()=>{l.onBlur(),setTimeout(async()=>{!u&&!p&&await k()},0)},onFocus:()=>{const t=l.value;if(!t||typeof t!="string")return;t.trim()===b&&F("tittel","",{shouldValidate:!1,shouldDirty:!1,shouldTouch:!1})},onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),(async()=>{const T=t.currentTarget;await k(),T?.blur()})())}})})})]}),e.jsxs(z,{className:"text-gray-400",children:[L," tegn igjen"]}),e.jsx(W,{}),e.jsx(Y,{validating:u,analyse:d,analyseError:n,harGodkjentKiFeil:c,showAnalysis:B,erRedigeringAvPublisertTreff:V,onGodkjennKiFeil:C,ariaLabel:"Analyse av tittel"})]})]})};R.displayName="TittelForm";R.__docgenInfo={description:"",methods:[],displayName:"TittelForm",props:{onUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{Q as P,A as S,R as T};
