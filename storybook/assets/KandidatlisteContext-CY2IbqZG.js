import{j as i,cx as m,ci as v,r as K,w as j,am as R}from"./iframe-Bc22TiGf.js";import{O as V}from"./OrganisasjonsnummerAlert-8lOqGaPL.js";import{K as o,a as n}from"./KandidatHendelseTag-dJX1T5Fo.js";import{f}from"./util-BfnnAcuM.js";import{n as F,m as D}from"./format-B7kw_Wnx.js";import{a as I}from"./util-CJ_fx-i-.js";function h(t,e,s){const[a,r]=F(s?.in,t,e),l=E(a,r),_=Math.abs(D(a,r));a.setDate(a.getDate()-l*_);const u=+(E(a,r)===-l),c=l*(_-u);return c===0?0:c}function E(t,e){const s=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return s<0?-1:s>0?1:s}const w=t=>{const e=f({dato:t.svarfrist,visning:"tall"}),s=t.svarfrist?h(new Date(t.svarfrist),new Date):null,a={dato:new Date(t.deltTidspunkt),raw:t};switch(t.tilstand){case m.IKKE_SENDT:case m.PROVER_VARSLING:return{tag:i.jsx(o,{type:n.Spurt_om_å_dele_CV,dato:e}),type:n.Spurt_om_å_dele_CV,tekst:"Prøver varsling",...a};case m.HAR_VARSLET:return{tag:i.jsx(o,{type:n.Spurt_om_å_dele_CV,dato:e}),type:n.Spurt_om_å_dele_CV,dato:new Date(t.deltTidspunkt),tekst:`av ${t.deltAv}`,raw:t};case m.KAN_IKKE_VARSLE:return{tag:i.jsx(o,{type:n.Spurt_om_å_dele_CV_IKKE_DIGITAL,dato:e}),type:n.Spurt_om_å_dele_CV_IKKE_DIGITAL,tekst:"Kandidaten bruker ikke digitale tjenester fra Nav. Du må ringe og registrere svaret i stillingskortet i Aktivitetsplanen.",...a};case m.KAN_IKKE_OPPRETTE:return{tag:i.jsx(o,{type:n.Deling_Av_CV_Feilet,dato:e}),type:n.Deling_Av_CV_Feilet,tekst:"Kan ikke opprette forespørsel",...a};case m.AVBRUTT:return t.deltStatus==="SENDT"&&s!==null&&s<0?{tag:i.jsx(o,{type:n.Frist_for_deling_av_cv_utløpt,dato:e}),type:n.Frist_for_deling_av_cv_utløpt,tekst:`Frist for deling av CV utløpt ${t.svarfrist&&f({dato:t.svarfrist})}`,...a}:{type:n.Avbrutt_i_aktivitetsplanen,tag:i.jsx(o,{type:n.Avbrutt_i_aktivitetsplanen}),...a};case m.HAR_SVART:return t.svar?.harSvartJa?{tag:i.jsx(o,{type:n.Deling_av_CV_JA,dato:e}),type:n.Deling_av_CV_JA,tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&f({dato:t.svar?.svarTidspunkt})}`,...a}:{type:n.Deling_av_CV_NEI,tag:i.jsx(o,{type:n.Deling_av_CV_NEI,dato:e}),tekst:`${t.svar?.svartAv.ident&&`svart av ${t.svar?.svartAv.ident}`} ${t.svar?.svarTidspunkt&&f({dato:t.svar?.svarTidspunkt})}`,...a};default:return{type:null,tag:i.jsx(o,{type:null}),...a}}},b=(t,e=!1,s,a)=>{const r={dato:new Date(t.tidspunkt),raw:t};if(s&&a===0&&s.length>=2&&t.utfall===v.PRESENTERT&&s[1].utfall===v.FATT_JOBBEN)return{type:n.Fjernet_fått_jobben,...r,tag:i.jsx(o,{type:n.Fjernet_fått_jobben}),tekst:""};switch(t.utfall){case v.FATT_JOBBEN:return{type:n.Fått_jobben,...r,tag:i.jsx(o,{type:n.Fått_jobben})};case v.IKKE_PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste===!1&&e?{...r,tag:i.jsx(o,{type:n.CV_slettet_hos_arbeidsgiver}),type:n.CV_slettet_hos_arbeidsgiver,tekst:n.CV_slettet_hos_arbeidsgiver}:{type:null,...r};case v.PRESENTERT:return t.sendtTilArbeidsgiversKandidatliste?{...r,type:n.CV_delt_med_arbeidsgiver,tag:i.jsx(o,{type:n.CV_delt_med_arbeidsgiver})}:{...r,type:null};default:return{...r,type:null,tag:i.jsx(o,{type:null})}}},N=({kandidat:t,forespørselCvForKandidat:e,beskjedForKandidat:s})=>{const a=t.utfallsendringer?.some(d=>d.utfall===v.PRESENTERT&&d.sendtTilArbeidsgiversKandidatliste),r=t.utfallsendringer?.map((d,g)=>b(d,a,t.utfallsendringer,g)),l=e?.map(d=>w(d));let _=null;s!==null&&s?.opprettet&&(_={type:s?.eksternStatus?.includes("FEIL")?n.SMS_FEIL:n.SMS_OK,tag:i.jsx(o,{type:s?.eksternStatus?.includes("FEIL")?n.SMS_FEIL:n.SMS_OK}),tekst:I((s?.eksternFeilmelding||"").replace(/[_-]/g," ")),dato:new Date(s?.opprettet),raw:s});const u=_?[_]:[],c=[...l??[],...r??[]].filter(d=>d.type!==null).sort((d,g)=>(g.dato?.getTime()||0)-(d.dato?.getTime()||0))[0],y=u?u.sort((d,g)=>(g.dato?.getTime()||0)-(d.dato?.getTime()||0))[0]:null;return{utfallsendringer:r,cvHendelser:l,varsler:u,sisteSms:y,sisteHendelse:c}},L=(t,e,s)=>{const a=t.aktørid&&e?e[t.aktørid]:null,r=s&&s[t.fodselsnr??""],l=N({kandidat:t,forespørselCvForKandidat:a,beskjedForKandidat:r});return{...t,kandidatHendelser:l}},k=K.createContext(void 0),M=({children:t,kandidatliste:e,forespurteKandidater:s,beskjeder:a,reFetchKandidatliste:r})=>{const{stillingsData:l,kandidatlisteInfo:_}=R(),[u,c]=K.useState([]),y=_?.kandidatlisteStatus==="LUKKET",T=e?.organisasjonReferanse,d=l?.stilling?.employer?.orgnr,g=!!(T&&d&&T!==d),A=p=>{if(c&&u){const C=u.some(S=>S.fodselsnr===p.fodselsnr)?u.filter(S=>S.fodselsnr!==p.fodselsnr):[...u,p];c(C)}},x=e.kandidater?e.kandidater.map(p=>L(p,s,a)):[];return i.jsxs(k.Provider,{value:{forespurteKandidater:s,beskjeder:a,markerteKandidater:u,setMarkerteKandidater:c,lukketKandidatliste:y,reFetchKandidatliste:r,toggleMarkerKandidat:A,kandidatlisteId:e.kandidatlisteId,usynligeKandidater:e.formidlingerAvUsynligKandidat,kandidater:x,kandidatlisteRawData:e},children:[g&&i.jsx(V,{}),t]})},J=()=>{const t=K.useContext(k);if(t===void 0)throw new j({message:"Context er undefined, må være children av KandidatlisteContextProvider."});return t};M.__docgenInfo={description:"",methods:[],displayName:"KandidatlisteContextProvider",props:{children:{required:!1,tsType:{name:"union",raw:"ReactNode | undefined",elements:[{name:"ReactNode"},{name:"undefined"}]},description:""},kandidatliste:{required:!0,tsType:{name:"z.infer",elements:[{name:"kandidatlisteSchema"}],raw:"z.infer<typeof kandidatlisteSchema>"},description:""},forespurteKandidater:{required:!0,tsType:{name:"z.infer",elements:[{name:"ForespurteOmDelingAvCvSchema"}],raw:`z.infer<
  typeof ForespurteOmDelingAvCvSchema
>`},description:""},beskjeder:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"z.infer",elements:[{name:"SmsSchema"}],raw:"z.infer<typeof SmsSchema>"}],raw:"Record<string, Sms>"},description:""},reFetchKandidatliste:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{M as K,J as u};
