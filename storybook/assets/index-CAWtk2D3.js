import{r as S,$ as Y,a0 as G,a1 as Z,a2 as K,a3 as w,a4 as _,a5 as H,a6 as k}from"./iframe-DkqQV0Vp.js";function N(e,t,r){try{return e(t)}catch(u){return k("[nuqs] Error while parsing value `%s`: %O"+(r?" (for key `%s`)":""),t,u,r),null}}function g(e){function t(r){if(typeof r>"u")return null;let u="";if(Array.isArray(r)){if(r[0]===void 0)return null;u=r[0]}return typeof r=="string"&&(u=r),N(e.parse,u)}return{eq:(r,u)=>r===u,...e,parseServerSide:t,withDefault(r){return{...this,defaultValue:r,parseServerSide(u){return t(u)??r}}},withOptions(r){return{...this,...r}}}}const ne=g({parse:e=>e,serialize:String}),ue=g({parse:e=>{const t=parseInt(e);return t==t?t:null},serialize:e=>""+Math.round(e)});g({parse:e=>{const t=parseInt(e);return t==t?t-1:null},serialize:e=>""+Math.round(e+1)});g({parse:e=>{const t=parseInt(e,16);return t==t?t:null},serialize:e=>{const t=Math.round(e).toString(16);return(t.length&1?"0":"")+t}});g({parse:e=>{const t=parseFloat(e);return t==t?t:null},serialize:String});g({parse:e=>e==="true",serialize:String});function F(e,t){return e.valueOf()===t.valueOf()}g({parse:e=>{const t=parseInt(e);return t==t?new Date(t):null},serialize:e=>""+e.valueOf(),eq:F});g({parse:e=>{const t=new Date(e);return t.valueOf()==t.valueOf()?t:null},serialize:e=>e.toISOString(),eq:F});g({parse:e=>{const t=new Date(e.slice(0,10));return t.valueOf()==t.valueOf()?t:null},serialize:e=>e.toISOString().slice(0,10),eq:F});function le(e,t=","){const r=e.eq??((l,n)=>l===n),u=encodeURIComponent(t);return g({parse:l=>l===""?[]:l.split(t).map((n,m)=>N(e.parse,n.replaceAll(u,t),`[${m}]`)).filter(n=>n!=null),serialize:l=>l.map(n=>(e.serialize?e.serialize(n):String(n)).replaceAll(t,u)).join(t),eq(l,n){return l===n?!0:l.length!==n.length?!1:l.every((m,q)=>r(m,n[q]))}})}const Q=_(),ee={};function te(e,t={}){const r=S.useId(),u=Y(),{history:l="replace",scroll:n=u?.scroll??!1,shallow:m=u?.shallow??!0,throttleMs:q=G.timeMs,limitUrlUpdates:a=u?.limitUrlUpdates,clearOnDefault:p=u?.clearOnDefault??!0,startTransition:d,urlKeys:j=ee}=t,i=Object.keys(e).join(","),c=S.useMemo(()=>Object.fromEntries(Object.keys(e).map(s=>[s,j[s]??s])),[i,JSON.stringify(j)]),v=Z(Object.values(c)),U=v.searchParams,z=S.useRef({}),C=S.useMemo(()=>Object.fromEntries(Object.keys(e).map(s=>[s,e[s].defaultValue??null])),[Object.values(e).map(({defaultValue:s})=>s).join(",")]),D=K.useQueuedQueries(Object.values(c)),[M,V]=S.useState(()=>{const s=U??new URLSearchParams;return L(e,j,s,D).state}),b=S.useRef(M);if(w("[nuq+ %s `%s`] render - state: %O, iSP: %s",r,i,M,U),Object.keys(z.current).join("&")!==Object.values(c).join("&")){const{state:s,hasChanged:f}=L(e,j,U,D,z.current,b.current);f&&(w("[nuq+ %s `%s`] State changed: %O",r,i,{state:s,initialSearchParams:U,queuedQueries:D,queryRef:z.current,stateRef:b.current}),b.current=s,V(s)),z.current=Object.fromEntries(Object.values(c).map(o=>[o,U?.get(o)??null]))}S.useEffect(()=>{const{state:s,hasChanged:f}=L(e,j,U,D,z.current,b.current);f&&(w("[nuq+ %s `%s`] State changed: %O",r,i,{state:s,initialSearchParams:U,queuedQueries:D,queryRef:z.current,stateRef:b.current}),b.current=s,V(s))},[Object.values(c).map(s=>`${s}=${U?.get(s)}`).join("&"),JSON.stringify(D)]),S.useEffect(()=>{function s(o){w("[nuq+ %s `%s`] updateInternalState %O",r,i,o),b.current=o,V(o)}const f=Object.keys(e).reduce((o,O)=>(o[O]=({state:A,query:P})=>{const{defaultValue:E}=e[O],T=c[O];b.current={...b.current,[O]:A??E??null},z.current[T]=P,w("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). Resolved: %O",r,i,T,A,E,b.current),s(b.current)},o),{});for(const o of Object.keys(e)){const O=c[o];w("[nuq+ %s `%s`] Subscribing to sync for `%s`",r,O,i),Q.on(O,f[o])}return()=>{for(const o of Object.keys(e)){const O=c[o];w("[nuq+ %s `%s`] Unsubscribing to sync for `%s`",r,O,i),Q.off(O,f[o])}}},[i,c]);const X=S.useCallback((s,f={})=>{const o=Object.fromEntries(Object.keys(e).map(R=>[R,null])),O=typeof s=="function"?s(W(b.current,C))??o:s??o;w("[nuq+ %s `%s`] setState: %O",r,i,O);let A,P=0;const E=[];for(let[R,y]of Object.entries(O)){const h=e[R],$=c[R];if(!h)continue;(f.clearOnDefault??h.clearOnDefault??p)&&y!==null&&h.defaultValue!==void 0&&(h.eq??((I,x)=>I===x))(y,h.defaultValue)&&(y=null);const J=y===null?null:(h.serialize??String)(y);Q.emit($,{state:y,query:J});const B={key:$,query:J,options:{history:f.history??h.history??l,shallow:f.shallow??h.shallow??m,scroll:f.scroll??h.scroll??n,startTransition:f.startTransition??h.startTransition??d}};if(f?.limitUrlUpdates?.method==="debounce"||a?.method==="debounce"||h.limitUrlUpdates?.method==="debounce"){const I=f?.limitUrlUpdates?.timeMs??a?.timeMs??h.limitUrlUpdates?.timeMs??G.timeMs,x=K.push(B,I,v);P<I&&(A=x,P=I)}else{const I=f?.limitUrlUpdates?.timeMs??h?.limitUrlUpdates?.timeMs??a?.timeMs??f.throttleMs??h.throttleMs??q;E.push(K.abort($)),H.push(B,I)}}const T=E.reduce((R,y)=>y(R),H.flush(v));return A??T},[i,l,m,n,q,a?.method,a?.timeMs,d,c,v.updateUrl,v.getSearchParamsSnapshot,v.rateLimitFactor,C]);return[S.useMemo(()=>W(M,C),[M,C]),X]}function L(e,t,r,u,l,n){let m=!1;const q=Object.keys(e).reduce((a,p)=>{const d=t?.[p]??p,{parse:j}=e[p],i=u[d],c=i===void 0?r?.get(d)??null:i;if(l&&n&&(l[d]??null)===c)return a[p]=n[p]??null,a;m=!0;const v=c===null?null:N(j,c,p);return a[p]=v??null,l&&(l[d]=c),a},{});if(!m){const a=Object.keys(e),p=Object.keys(n??{});m=a.length!==p.length||a.some(d=>!p.includes(d))}return{state:q,hasChanged:m}}function W(e,t){return Object.fromEntries(Object.keys(e).map(r=>[r,e[r]??t[r]??null]))}function oe(e,t={}){const{parse:r=d=>d,serialize:u,eq:l,defaultValue:n,...m}=t,[{[e]:q},a]=te({[e]:{parse:r,serialize:u,eq:l,defaultValue:n}},m),p=S.useCallback((d,j={})=>a(i=>({[e]:typeof d=="function"?d(i[e]):d}),j),[e,a]);return[q,p]}export{le as a,ne as b,ue as p,oe as u};
